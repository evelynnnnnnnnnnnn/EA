{"version":3,"file":"chat-dialog.bundle.js","sources":["../src/classes/scroll-manager.js","../src/classes/pull-watch-manager.js","../src/classes/visible-messages-manager.js","../src/components/pinned/pinned-message.js","../src/components/pinned/pinned-messages.js","../src/components/quote-button.js","../src/components/scroll-button.js","../src/chat-dialog.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { Animation } from 'im.v2.lib.animation';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Dialog.ScrollManager';\nconst SCROLLING_THRESHOLD = 1500;\nconst POSITION_THRESHOLD = 40;\nconst SCROLLED_UP_THRESHOLD = 400;\nconst FLOATING_DATE_OFFSET = 52;\n\nexport class ScrollManager extends EventEmitter\n{\n\tcontainer: HTMLElement;\n\tisScrolling: boolean = false;\n\tcurrentScroll: number = 0;\n\tlastScroll: number = 0;\n\tchatIsScrolledUp: boolean = false;\n\tscrollButtonClicked: boolean = false;\n\n\tstatic events = {\n\t\tonScrollTriggerUp: 'onScrollTriggerUp',\n\t\tonScrollTriggerDown: 'onScrollTriggerDown',\n\t\tonScrollThresholdPass: 'onScrollThresholdPass',\n\t};\n\n\tconstructor(): ScrollManager\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\t}\n\n\tsetContainer(container: HTMLElement)\n\t{\n\t\tthis.container = container;\n\t}\n\n\tonScroll(event: Event)\n\t{\n\t\t// if (this.isScrolling || !event.target || this.currentScroll === event.target.scrollTop)\n\t\tif (this.isScrolling || !event.target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentScroll = event.target.scrollTop;\n\t\tconst isScrollingDown = this.lastScroll < this.currentScroll;\n\t\tconst isScrollingUp = !isScrollingDown;\n\t\tif (isScrollingUp)\n\t\t{\n\t\t\tthis.scrollButtonClicked = false;\n\t\t}\n\n\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\t\tif (isScrollingDown && this.lastScroll > 0 && leftSpaceBottom < SCROLLING_THRESHOLD)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollTriggerDown);\n\t\t}\n\t\telse if (isScrollingUp && this.currentScroll <= SCROLLING_THRESHOLD)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollTriggerUp);\n\t\t}\n\n\t\tthis.lastScroll = this.currentScroll;\n\n\t\tthis.checkIfChatIsScrolledUp();\n\t}\n\n\tcheckIfChatIsScrolledUp()\n\t{\n\t\tconst availableScrollHeight = this.container.scrollHeight - this.container.clientHeight;\n\t\tconst newFlag = this.currentScroll + SCROLLED_UP_THRESHOLD < availableScrollHeight;\n\t\tif (newFlag !== this.chatIsScrolledUp)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollThresholdPass, newFlag);\n\t\t}\n\t\tthis.chatIsScrolledUp = newFlag;\n\t}\n\n\tscrollToBottom()\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: scroll to bottom');\n\t\tthis.forceScrollTo(this.container.scrollHeight - this.container.clientHeight);\n\t}\n\n\tanimatedScrollToBottom()\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: animated scroll to bottom');\n\t\tthis.animatedScrollTo(this.container.scrollHeight - this.container.clientHeight);\n\t}\n\n\tscrollToMessage(messageId: number, params: { withDateOffset: boolean } = {})\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: scroll to message - ', messageId);\n\t\tconst { withDateOffset = true } = params;\n\t\tconst offset = withDateOffset ? -FLOATING_DATE_OFFSET : -10;\n\n\t\tconst element = this.getDomElementById(messageId);\n\t\tif (!element)\n\t\t{\n\t\t\tLogger.warn('Dialog: ScrollManager: message not found - ', messageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst position = element.offsetTop + offset;\n\t\tthis.forceScrollTo(position);\n\t}\n\n\tanimatedScrollToMessage(messageId: number, params: { withDateOffset: boolean } = {}): Promise\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: animated scroll to message - ', messageId);\n\t\tconst { withDateOffset = true } = params;\n\t\tconst offset = withDateOffset ? -FLOATING_DATE_OFFSET : -10;\n\n\t\tconst element = this.getDomElementById(messageId);\n\t\tif (!element)\n\t\t{\n\t\t\tLogger.warn('Dialog: ScrollManager: message not found - ', messageId);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst position = element.offsetTop + offset;\n\n\t\treturn this.animatedScrollTo(position);\n\t}\n\n\tforceScrollTo(position: number)\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Force scroll to - ', position);\n\t\tthis.cancelAnimatedScroll();\n\t\tthis.container.scroll({ top: position, behavior: 'instant' });\n\t}\n\n\tadjustScrollOnHistoryAddition(oldContainerHeight: number)\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Adjusting scroll after history addition');\n\t\tconst newContainerHeight = this.container.scrollHeight - this.container.clientHeight;\n\t\tconst newScrollPosition = this.container.scrollTop + newContainerHeight - oldContainerHeight;\n\t\tthis.forceScrollTo(newScrollPosition);\n\t}\n\n\tanimatedScrollTo(position: number): Promise\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Animated scroll to - ', position);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tAnimation.start({\n\t\t\t\tstart: this.container.scrollTop,\n\t\t\t\tend: position,\n\t\t\t\telement: this.container,\n\t\t\t\telementProperty: 'scrollTop',\n\t\t\t\tcallback: () => {\n\t\t\t\t\tthis.checkIfChatIsScrolledUp();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tcancelAnimatedScroll()\n\t{\n\t\tif (!this.isScrolling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnimation.cancel();\n\t\tthis.isScrolling = false;\n\t}\n\n\tisAtTheTop(): boolean\n\t{\n\t\treturn this.container.scrollTop === 0;\n\t}\n\n\tisAtTheBottom(): boolean\n\t{\n\t\treturn this.container.scrollTop + this.container.clientHeight >= this.container.scrollHeight;\n\t}\n\n\tisAroundBottom(): boolean\n\t{\n\t\treturn this.container.scrollHeight - this.container.scrollTop - this.container.clientHeight < POSITION_THRESHOLD;\n\t}\n\n\tgetDomElementById(id: number | string): ?HTMLElement\n\t{\n\t\treturn this.container.querySelector(`[data-id=\"${id}\"]`);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserRole, RestMethod, ChatType } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { PULL as Pull } from 'pull.client';\n\nconst MESSAGES_TAG_PREFIX = 'IM_PUBLIC_';\nconst COMMENTS_TAG_PREFIX = 'IM_PUBLIC_COMMENT_';\n\nexport class PullWatchManager\n{\n\t#dialog: ImModelChat;\n\t#pullClient: Pull;\n\n\tconstructor(dialogId: string)\n\t{\n\t\tthis.#dialog = Core.getStore().getters['chats/get'](dialogId, true);\n\t\tthis.#pullClient = Core.getPullClient();\n\t}\n\n\tsubscribe()\n\t{\n\t\tif (this.#isChannel())\n\t\t{\n\t\t\tthis.#subscribeChannel();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isCommentsChat() || !this.#isGuest())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#subscribeOpenChat();\n\t}\n\n\tunsubscribe()\n\t{\n\t\tthis.#pullClient.clearWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t\tthis.#pullClient.clearWatch(`${COMMENTS_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#subscribeChannel()\n\t{\n\t\tthis.#requestWatchStart();\n\t\tthis.#pullClient.extendWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t\tthis.#pullClient.extendWatch(`${COMMENTS_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#subscribeOpenChat()\n\t{\n\t\tthis.#requestWatchStart();\n\t\tthis.#pullClient.extendWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#requestWatchStart()\n\t{\n\t\trunAction(RestMethod.imV2ChatExtendPullWatch, {\n\t\t\tdata: {\n\t\t\t\tdialogId: this.#dialog.dialogId,\n\t\t\t},\n\t\t});\n\t}\n\n\t#isGuest(): boolean\n\t{\n\t\treturn this.#dialog?.role === UserRole.guest && this.#dialog?.dialogId !== 'settings';\n\t}\n\n\t#isChannel(): boolean\n\t{\n\t\treturn [ChatType.openChannel, ChatType.channel].includes(this.#dialog?.type);\n\t}\n\n\t#isCommentsChat(): boolean\n\t{\n\t\treturn this.#dialog?.type === ChatType.comment;\n\t}\n}\n","export class VisibleMessagesManager\n{\n\t#visibleMessages: Set = new Set();\n\n\tsetMessageAsVisible(messageId: number): void\n\t{\n\t\tthis.#visibleMessages.add(messageId);\n\t}\n\n\tsetMessageAsNotVisible(messageId: number): void\n\t{\n\t\tthis.#visibleMessages.delete(messageId);\n\t}\n\n\tgetFirstMessageId(): number\n\t{\n\t\tif (this.#visibleMessages.size === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst [firstVisibleMessage] = [...this.#visibleMessages].sort((a, b) => a - b);\n\n\t\treturn firstVisibleMessage;\n\t}\n}\n","import {Parser} from 'im.v2.lib.parser';\n\nimport type {ImModelUser, ImModelMessage} from 'im.v2.model';\n\n// @vue/component\nexport const PinnedMessage = {\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true\n\t\t}\n\t},\n\tdata()\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tinternalMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Parser.purifyMessage(this.internalMessage);\n\t\t},\n\t\tauthorId(): number\n\t\t{\n\t\t\treturn this.internalMessage.authorId;\n\t\t},\n\t\tauthor(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.authorId);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pinned_item\">\n\t\t\t<span v-if=\"author\" class=\"bx-im-dialog-chat__pinned_item_user\">{{ author.name }}:</span> {{ text }}\n\t\t</div>\n\t`\n};","import { ChatType, ChatActionType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { PinnedMessage } from './pinned-message';\n\nimport '../../css/pinned-messages.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const PinnedMessages = {\n\tname: 'PinnedMessages',\n\tcomponents: { PinnedMessage },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tmessages: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['messageClick', 'messageUnpin'],\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tfirstMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.messagesToShow[0];\n\t\t},\n\t\tmessagesToShow(): ImModelMessage[]\n\t\t{\n\t\t\treturn this.messages.slice(-1);\n\t\t},\n\t\tcanUnpin(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformAction(ChatActionType.pinMessage, this.dialogId);\n\t\t},\n\t\tshowUnpin(): boolean\n\t\t{\n\t\t\treturn !this.isCommentChat && this.canUnpin;\n\t\t},\n\t\tisCommentChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.comment;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div @click=\"$emit('messageClick', firstMessage.id)\" class=\"bx-im-dialog-chat__pinned_container\">\n\t\t\t<div class=\"bx-im-dialog-chat__pinned_title\">{{ loc('IM_DIALOG_CHAT_PINNED_TITLE') }}</div>\n\t\t\t<PinnedMessage\n\t\t\t\tv-for=\"message in messagesToShow\"\n\t\t\t\t:message=\"message\"\n\t\t\t\t:key=\"message.id\"\n\t\t\t/>\n\t\t\t<div v-if=\"showUnpin\" @click.stop=\"$emit('messageUnpin', firstMessage.id)\" class=\"bx-im-dialog-chat__pinned_unpin\"></div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\n\nimport { Quote } from 'im.v2.lib.quote';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MessengerSlider } from 'im.v2.lib.slider';\n\nimport '../css/quote-button.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelMessage } from 'im.v2.model';\n\nconst CONTAINER_HEIGHT = 44;\nconst CONTAINER_WIDTH = 60;\nconst CONTAINER_OFFSET = 10;\nconst slider = MessengerSlider.getInstance().getCurrent();\nconst sliderRect = slider?.layout.container.getBoundingClientRect();\nconst offsetY = sliderRect?.top ?? 0;\n\nconst MESSAGE_TEXT_NODE_CLASS = '.bx-im-message-default-content__text';\n\n// @vue/component\nexport const QuoteButton = {\n\tname: 'QuoteButton',\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\ttext: '',\n\t\t\tmessage: null,\n\t\t\tmouseX: 0,\n\t\t\tmouseY: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcontainerStyle(): {top: string, left: string, width: string, height: string}\n\t\t{\n\t\t\treturn {\n\t\t\t\ttop: `${this.mouseY - CONTAINER_HEIGHT - CONTAINER_OFFSET - offsetY}px`,\n\t\t\t\tleft: `${this.mouseX - CONTAINER_WIDTH / 2}px`,\n\t\t\t\twidth: `${CONTAINER_WIDTH}px`,\n\t\t\t\theight: `${CONTAINER_HEIGHT}px`,\n\t\t\t};\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tEvent.bind(window, 'mousedown', this.onMouseDown);\n\t},\n\tmethods:\n\t{\n\t\tonMessageMouseUp(message: ImModelMessage, event: MouseEvent)\n\t\t{\n\t\t\tif (event.button === 2)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.prepareSelectedText();\n\t\t\tthis.message = message;\n\t\t\tthis.mouseX = event.clientX;\n\t\t\tthis.mouseY = event.clientY;\n\t\t},\n\t\tonMouseDown(event: MouseEvent)\n\t\t{\n\t\t\tconst container = this.$refs.container;\n\t\t\tif (!container || container.contains(event.target))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tprepareSelectedText(): string\n\t\t{\n\t\t\tif (Utils.browser.isFirefox())\n\t\t\t{\n\t\t\t\tthis.text = window.getSelection().toString();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst range = window.getSelection().getRangeAt(0);\n\t\t\tconst rangeContents = range.cloneContents();\n\t\t\tlet nodesToIterate = rangeContents.childNodes;\n\n\t\t\tconst messageNode = rangeContents.querySelector(MESSAGE_TEXT_NODE_CLASS);\n\t\t\tif (messageNode)\n\t\t\t{\n\t\t\t\tnodesToIterate = messageNode.childNodes;\n\t\t\t}\n\n\t\t\tfor (const node of nodesToIterate)\n\t\t\t{\n\t\t\t\tif (this.isImage(node))\n\t\t\t\t{\n\t\t\t\t\tthis.text += node.getAttribute('data-code') ?? node.getAttribute('alt');\n\t\t\t\t}\n\t\t\t\telse if (this.isLineBreak(node))\n\t\t\t\t{\n\t\t\t\t\tthis.text += '\\n';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.text += node.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tisImage(node: HTMLElement): boolean\n\t\t{\n\t\t\tif (!(node instanceof HTMLElement))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn node.tagName.toLowerCase() === 'img';\n\t\t},\n\t\tisLineBreak(node: HTMLElement): boolean\n\t\t{\n\t\t\treturn node.nodeName.toLowerCase() === 'br';\n\t\t},\n\t\tisText(node: HTMLElement): boolean\n\t\t{\n\t\t\treturn node.nodeName === '#text';\n\t\t},\n\t\tisMessageTextNode(node: HTMLElement): boolean\n\t\t{\n\t\t\tif (!(node instanceof HTMLElement))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst textNode = node.matches(MESSAGE_TEXT_NODE_CLASS);\n\n\t\t\treturn Boolean(textNode);\n\t\t},\n\t\textractTextFromMessageNode(node: HTMLElement): string\n\t\t{\n\t\t\tconst textNode = node.querySelector(MESSAGE_TEXT_NODE_CLASS);\n\t\t\tif (!textNode)\n\t\t\t{\n\t\t\t\treturn node.textContent;\n\t\t\t}\n\n\t\t\treturn textNode.textContent;\n\t\t},\n\t\tonQuoteClick()\n\t\t{\n\t\t\tQuote.sendQuoteEvent(this.message, this.text, this.dialogId);\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"container\" @click=\"onQuoteClick\" :style=\"containerStyle\" class=\"bx-im-dialog-chat__quote-button\">\n\t\t\t<div class=\"bx-im-dialog-chat__quote-icon\"></div>\n\t\t\t<div class=\"bx-im-dialog-chat__quote-icon --hover\"></div>\n\t\t</div>\n\t`,\n};\n","import type { ImModelChat } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const ScrollButton = {\n\tname: 'ScrollButton',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\tif (this.dialog.counter === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.dialog.counter > 99)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn String(this.dialog.counter);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__scroll-button\">\n\t\t\t<div v-if=\"dialog.counter\" class=\"bx-im-dialog-chat__scroll-button_counter\">\n\t\t\t\t{{ formattedCounter }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime, Event, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { PopupManager } from 'main.popup';\nimport { PullStatus } from 'pull.vue3.status';\n\nimport { MessageList } from 'im.v2.component.message-list';\nimport { ForwardPopup } from 'im.v2.component.entity-selector';\nimport { Logger } from 'im.v2.lib.logger';\nimport { CallManager } from 'im.v2.lib.call';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { MessageService, ChatService } from 'im.v2.provider.service';\nimport {\n\tDialogBlockType as BlockType,\n\tEventType,\n\tPopupType,\n\tDialogScrollThreshold,\n\tUserRole,\n\tChatActionType,\n} from 'im.v2.const';\n\nimport { ScrollManager } from './classes/scroll-manager';\nimport { PullWatchManager } from './classes/pull-watch-manager';\nimport { VisibleMessagesManager } from './classes/visible-messages-manager';\nimport { PinnedMessages } from './components/pinned/pinned-messages';\nimport { QuoteButton } from './components/quote-button';\nimport { ScrollButton } from './components/scroll-button';\n\nimport './css/chat-dialog.css';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelMessage, ImModelChat, ImModelLayout } from 'im.v2.model';\nimport type { ScrollToBottomEvent } from 'im.v2.const';\n\nexport { PinnedMessages } from './components/pinned/pinned-messages';\n\n// @vue/component\nexport const ChatDialog = {\n\tname: 'ChatDialog',\n\tcomponents: {\n\t\tMessageList,\n\t\tPinnedMessages,\n\t\tQuoteButton,\n\t\tScrollButton,\n\t\tPullStatus,\n\t\tForwardPopup,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsaveScrollOnExit: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tresetOnExit: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tforwardPopup: {\n\t\t\t\tshow: false,\n\t\t\t\tmessageId: 0,\n\t\t\t},\n\t\t\tcontextMode: {\n\t\t\t\tactive: false,\n\t\t\t\tmessageIsLoaded: false,\n\t\t\t},\n\t\t\tisScrolledUp: false,\n\t\t\twindowFocused: false,\n\t\t\tshowQuoteButton: false,\n\t\t\tmessagesToRead: new Set(),\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tmessageCollection(): ImModelMessage[]\n\t\t{\n\t\t\treturn this.$store.getters['messages/getByChatId'](this.dialog.chatId);\n\t\t},\n\t\tpinnedMessages(): ImModelMessage[]\n\t\t{\n\t\t\treturn this.$store.getters['messages/pin/getPinned'](this.dialog.chatId);\n\t\t},\n\t\tisOpened(): boolean\n\t\t{\n\t\t\tconst openedDialogId = this.$store.getters['application/getLayout'].entityId;\n\n\t\t\treturn this.dialogId === openedDialogId;\n\t\t},\n\t\tisGuest(): boolean\n\t\t{\n\t\t\treturn this.dialog.role === UserRole.guest;\n\t\t},\n\t\tdebouncedScrollHandler(): Function\n\t\t{\n\t\t\tconst SCROLLING_DEBOUNCE_DELAY = 200;\n\n\t\t\treturn Runtime.debounce(this.getScrollManager().onScroll, SCROLLING_DEBOUNCE_DELAY, this.getScrollManager());\n\t\t},\n\t\tdebouncedReadHandler(): Function\n\t\t{\n\t\t\treturn Runtime.debounce(this.readVisibleMessages, 50, this);\n\t\t},\n\t\tmessageListComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn MessageList;\n\t\t},\n\t\tshowScrollButton(): boolean\n\t\t{\n\t\t\treturn this.isScrolledUp || this.dialog.hasNextPage;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogInited(newValue, oldValue)\n\t\t{\n\t\t\tif (!newValue || oldValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// first opening\n\t\t\tthis.getPullWatchManager().subscribe();\n\t\t\tthis.onChatInited();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('Dialog: Chat created', this.dialogId);\n\t\tthis.initContextMode();\n\t},\n\tmounted()\n\t{\n\t\tthis.getScrollManager().setContainer(this.getContainer());\n\t\tif (this.dialogInited)\n\t\t{\n\t\t\t// second+ opening\n\t\t\tthis.getPullWatchManager().subscribe();\n\t\t\tthis.onChatInited();\n\t\t}\n\t\t// there are P&P messages\n\t\telse if (!this.dialogInited && this.messageCollection.length > 0)\n\t\t{\n\t\t\tthis.scrollOnStart();\n\t\t}\n\n\t\tthis.windowFocused = document.hasFocus();\n\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t\tif (this.dialogInited)\n\t\t{\n\t\t\tthis.saveScrollPosition();\n\t\t\tthis.handleMessagesOnExit();\n\t\t}\n\t\tthis.getPullWatchManager().unsubscribe();\n\t\tthis.closeDialogPopups();\n\t\tthis.forwardPopup.show = false;\n\t},\n\tmethods:\n\t{\n\t\treadVisibleMessages()\n\t\t{\n\t\t\tif (!this.dialogInited || !this.windowFocused || this.hasVisibleCall())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\t\t\tif (!permissionManager.canPerformAction(ChatActionType.readMessage, this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst messagesToRead: number[] = [...this.messagesToRead];\n\t\t\tmessagesToRead.forEach((messageId) => {\n\t\t\t\tthis.getChatService().readMessage(this.dialog.chatId, messageId);\n\t\t\t\tthis.messagesToRead.delete(messageId);\n\t\t\t});\n\t\t},\n\t\tasync scrollOnStart()\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\t// we loaded chat with context\n\t\t\tif (this.contextMode.active && this.contextMode.messageIsLoaded)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().scrollToMessage(this.layout.contextId);\n\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\tthis.highlightMessage(this.layout.contextId);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// chat was loaded before\n\t\t\tif (this.contextMode.active && !this.contextMode.messageIsLoaded)\n\t\t\t{\n\t\t\t\tthis.goToMessageContext(this.layout.contextId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// marked message\n\t\t\tif (this.dialog.markedId)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().scrollToMessage(BlockType.newMessages);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// saved position\n\t\t\tif (this.dialog.savedPositionMessageId && !this.isGuest)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: saved scroll position, scrolling to', this.dialog.savedPositionMessageId);\n\t\t\t\tthis.getScrollManager().scrollToMessage(this.dialog.savedPositionMessageId, { withDateOffset: false });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst lastReadId = this.$store.getters['chats/getLastReadId'](this.dialogId);\n\t\t\tconst isLastMessageId = lastReadId === this.dialog.lastMessageId;\n\t\t\t// unread messages and read messages before them\n\t\t\tif (lastReadId > 0 && !isLastMessageId)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: scroll to \"New messages\" mark, lastReadId -', lastReadId, 'lastMessageId', this.dialog.lastMessageId);\n\t\t\t\tthis.getScrollManager().scrollToMessage(BlockType.newMessages);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// new chat, unread messages without read messages before them\n\t\t\tconst hasUnread = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\tif (lastReadId === 0 || hasUnread)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: dont scroll, hasUnread -', hasUnread, 'lastReadId', lastReadId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// no unread messages\n\t\t\tthis.getScrollManager().scrollToBottom();\n\t\t},\n\t\tshowLoadingBar(): void\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.showLoadingBar, { dialogId: this.dialogId });\n\t\t},\n\t\thideLoadingBar(): void\n\t\t{\n\t\t\tEventEmitter.emit(EventType.dialog.hideLoadingBar, { dialogId: this.dialogId });\n\t\t},\n\t\tasync goToMessageContext(messageId: number): void\n\t\t{\n\t\t\tconst hasMessage = this.$store.getters['messages/hasMessage']({\n\t\t\t\tchatId: this.dialog.chatId,\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t\tif (hasMessage)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we have this message, scrolling to it', messageId);\n\n\t\t\t\tawait this.getScrollManager().animatedScrollToMessage(messageId);\n\t\t\t\tthis.highlightMessage(messageId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadContext(messageId)\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tLogger.error('goToMessageContext error', error);\n\t\t\t\t});\n\t\t\tawait this.$nextTick();\n\t\t\tthis.hideLoadingBar();\n\t\t\tthis.getScrollManager().scrollToMessage(messageId);\n\t\t\tawait this.$nextTick();\n\t\t\tthis.highlightMessage(messageId);\n\t\t},\n\t\thighlightMessage(messageId: number)\n\t\t{\n\t\t\tconst HIGHLIGHT_CLASS = 'bx-im-dialog-chat__highlighted-message';\n\t\t\tconst HIGHLIGHT_DURATION = 2000;\n\n\t\t\tconst message = this.getScrollManager().getDomElementById(messageId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.addClass(message, HIGHLIGHT_CLASS);\n\t\t\tsetTimeout(() => {\n\t\t\t\tDom.removeClass(message, HIGHLIGHT_CLASS);\n\t\t\t}, HIGHLIGHT_DURATION);\n\t\t},\n\t\tsaveScrollPosition()\n\t\t{\n\t\t\tif (!this.saveScrollOnExit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet savedPositionMessageId = this.getVisibleMessagesManager().getFirstMessageId();\n\t\t\tif (this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\tsavedPositionMessageId = 0;\n\t\t\t}\n\t\t\tthis.$store.dispatch('chats/update', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tfields: { savedPositionMessageId },\n\t\t\t});\n\t\t},\n\t\thandleMessagesOnExit()\n\t\t{\n\t\t\tif (this.resetOnExit)\n\t\t\t{\n\t\t\t\tthis.getChatService().resetChat(this.dialogId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst LOAD_MESSAGE_ON_EXIT_DELAY = 200;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tvoid this.getMessageService().reloadMessageList();\n\t\t\t}, LOAD_MESSAGE_ON_EXIT_DELAY);\n\t\t},\n\t\t/* region Event handlers */\n\t\tonChatInited()\n\t\t{\n\t\t\tthis.scrollOnStart();\n\t\t\tthis.readVisibleMessages();\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.getChatService().clearDialogMark(this.dialogId);\n\t\t\t});\n\n\t\t\tEventEmitter.emit(EventType.dialog.onDialogInited, { dialogId: this.dialogId });\n\t\t},\n\t\tasync onScrollTriggerUp()\n\t\t{\n\t\t\tif (!this.dialogInited || !this.getContainer())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll triggered UP');\n\t\t\tconst container = this.getContainer();\n\t\t\tconst oldHeight = container.scrollHeight - container.clientHeight;\n\n\t\t\t// Insert messages if there are some\n\t\t\tif (this.getMessageService().hasPreparedHistoryMessages())\n\t\t\t{\n\t\t\t\tawait this.getMessageService().drawPreparedHistoryMessages();\n\t\t\t\tthis.getScrollManager().adjustScrollOnHistoryAddition(oldHeight);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// check if already loading or no more history\n\t\t\tif (this.getMessageService().isLoading() || !this.dialog.hasPrevPage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load messages and save them\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadHistory();\n\t\t\tthis.hideLoadingBar();\n\t\t\t// Messages loaded and we are at the top\n\t\t\tif (this.getScrollManager().isAtTheTop())\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we are at the top after history request, inserting messages');\n\t\t\t\tawait this.getMessageService().drawPreparedHistoryMessages();\n\t\t\t\tthis.getScrollManager().adjustScrollOnHistoryAddition(oldHeight);\n\t\t\t}\n\t\t},\n\t\tasync onScrollTriggerDown()\n\t\t{\n\t\t\tif (!this.dialogInited || !this.getContainer())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll triggered DOWN');\n\t\t\t// Insert messages if there are some\n\t\t\tif (this.getMessageService().hasPreparedUnreadMessages())\n\t\t\t{\n\t\t\t\tawait this.getMessageService().drawPreparedUnreadMessages();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// check if already loading or no more history\n\t\t\tif (this.getMessageService().isLoading() || !this.dialog.hasNextPage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load messages and save them\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadUnread();\n\t\t\tthis.hideLoadingBar();\n\t\t\t// Messages loaded and we are at the bottom\n\t\t\tif (this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we are at the bottom after unread request, inserting messages');\n\t\t\t\tawait this.getMessageService().drawPreparedUnreadMessages();\n\t\t\t\tthis.getScrollManager().checkIfChatIsScrolledUp();\n\t\t\t}\n\t\t},\n\t\tasync onScrollToBottom(event: BaseEvent<ScrollToBottomEvent>)\n\t\t{\n\t\t\tconst { chatId, threshold = DialogScrollThreshold.halfScreenUp, animation = true } = event.getData();\n\t\t\tif (this.dialog.chatId !== chatId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.windowFocused || this.hasVisibleCall())\n\t\t\t{\n\t\t\t\tconst firstUnreadId = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\t\tif (firstUnreadId)\n\t\t\t\t{\n\t\t\t\t\tawait this.$nextTick();\n\t\t\t\t\tthis.getScrollManager().scrollToMessage(firstUnreadId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll to bottom', chatId, threshold);\n\t\t\tif (threshold === DialogScrollThreshold.halfScreenUp && this.isScrolledUp)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (threshold === DialogScrollThreshold.nearTheBottom && !this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().animatedScrollToBottom();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getScrollManager().scrollToBottom();\n\t\t},\n\t\tonGoToMessageContext(event: BaseEvent)\n\t\t{\n\t\t\tconst { dialogId, messageId } = event.getData();\n\t\t\tif (this.dialog.dialogId !== dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.goToMessageContext(messageId);\n\t\t},\n\t\tonPinnedMessageClick(messageId: number)\n\t\t{\n\t\t\tthis.goToMessageContext(messageId);\n\t\t},\n\t\tonPinnedMessageUnpin(messageId: number)\n\t\t{\n\t\t\tthis.getMessageService().unpinMessage(this.dialog.chatId, messageId);\n\t\t},\n\t\tonScroll(event: Event)\n\t\t{\n\t\t\tthis.closeDialogPopups();\n\t\t\tthis.debouncedScrollHandler(event);\n\t\t},\n\t\tasync onScrollButtonClick()\n\t\t{\n\t\t\tif (this.getScrollManager().scrollButtonClicked)\n\t\t\t{\n\t\t\t\tvoid this.handleSecondScrollButtonClick();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getScrollManager().scrollButtonClicked = true;\n\t\t\tif (this.dialog.counter === 0)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadInitialMessages();\n\t\t\t\tthis.hideLoadingBar();\n\t\t\t\tthis.getScrollManager().scrollToBottom();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstUnreadId = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\tif (!firstUnreadId)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadInitialMessages();\n\t\t\t\tthis.hideLoadingBar();\n\t\t\t\tawait this.getScrollManager().animatedScrollToMessage(firstUnreadId);\n\t\t\t}\n\n\t\t\tawait this.getScrollManager().animatedScrollToMessage(firstUnreadId);\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleMessages();\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonCallFold()\n\t\t{\n\t\t\tconst callDialogId = CallManager.getInstance().getCurrentCallDialogId();\n\t\t\tif (callDialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.readVisibleMessages();\n\t\t},\n\t\tasync onShowQuoteButton(event: BaseEvent<{ message: ImModelMessage, event: MouseEvent }>)\n\t\t{\n\t\t\tconst { message, event: $event } = event.getData();\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\t\t\tif (!permissionManager.canPerformAction(ChatActionType.send, this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.showQuoteButton = true;\n\t\t\tawait this.$nextTick();\n\t\t\tthis.$refs.quoteButton.onMessageMouseUp(message, $event);\n\t\t},\n\t\tasync handleSecondScrollButtonClick()\n\t\t{\n\t\t\tthis.getScrollManager().scrollButtonClicked = false;\n\t\t\tif (this.dialog.hasNextPage)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadContext(this.dialog.lastMessageId)\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tLogger.error('ChatDialog: scroll to chat end loadContext error', error);\n\t\t\t\t\t});\n\t\t\t\tthis.hideLoadingBar();\n\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.dialog.chatId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.getScrollManager().animatedScrollToMessage(this.dialog.lastMessageId, { withDateOffset: false });\n\t\t},\n\t\tonShowForwardPopup(event: BaseEvent)\n\t\t{\n\t\t\tconst { messageId } = event.getData();\n\t\t\tthis.forwardPopup.messageId = messageId;\n\t\t\tthis.forwardPopup.show = true;\n\t\t},\n\t\tonCloseForwardPopup()\n\t\t{\n\t\t\tthis.forwardPopup.messageId = 0;\n\t\t\tthis.forwardPopup.show = false;\n\t\t},\n\t\tonMessageIsVisible(event: BaseEvent<{ messageId: number, dialogId: string }>)\n\t\t{\n\t\t\tconst { messageId, dialogId } = event.getData();\n\t\t\tif (dialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getVisibleMessagesManager().setMessageAsVisible(messageId);\n\n\t\t\tconst message: ImModelMessage = this.$store.getters['messages/getById'](messageId);\n\t\t\tif (!message.viewed)\n\t\t\t{\n\t\t\t\tthis.messagesToRead.add(messageId);\n\t\t\t\tthis.debouncedReadHandler();\n\t\t\t}\n\t\t},\n\t\tonMessageIsNotVisible(event: BaseEvent<{ messageId: number, dialogId: string }>)\n\t\t{\n\t\t\tconst { messageId, dialogId } = event.getData();\n\t\t\tif (dialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getVisibleMessagesManager().setMessageAsNotVisible(messageId);\n\t\t},\n\t\t/* endregion Event handlers */\n\t\t/* region Init methods */\n\t\tinitContextMode()\n\t\t{\n\t\t\tconst layoutManager = LayoutManager.getInstance();\n\t\t\tif (!layoutManager.isChatContextAvailable(this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMode.active = true;\n\t\t\t// chat was loaded before, we didn't load context specifically\n\t\t\t// if chat wasn't loaded before - we load it with context\n\t\t\tthis.contextMode.messageIsLoaded = !this.dialogInited;\n\t\t},\n\t\tgetMessageService(): MessageService\n\t\t{\n\t\t\tif (!this.messageService)\n\t\t\t{\n\t\t\t\tthis.messageService = new MessageService({ chatId: this.dialog.chatId });\n\t\t\t}\n\n\t\t\treturn this.messageService;\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tgetScrollManager(): ScrollManager\n\t\t{\n\t\t\tif (!this.scrollManager)\n\t\t\t{\n\t\t\t\tthis.scrollManager = new ScrollManager();\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollTriggerUp, this.onScrollTriggerUp);\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollTriggerDown, this.onScrollTriggerDown);\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollThresholdPass, (event: BaseEvent<boolean>) => {\n\t\t\t\t\tthis.isScrolledUp = event.getData();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.scrollManager;\n\t\t},\n\t\tgetPullWatchManager(): PullWatchManager\n\t\t{\n\t\t\tif (!this.pullWatchManager)\n\t\t\t{\n\t\t\t\tthis.pullWatchManager = new PullWatchManager(this.dialogId);\n\t\t\t}\n\n\t\t\treturn this.pullWatchManager;\n\t\t},\n\t\tgetVisibleMessagesManager(): VisibleMessagesManager\n\t\t{\n\t\t\tif (!this.visibleMessagesManager)\n\t\t\t{\n\t\t\t\tthis.visibleMessagesManager = new VisibleMessagesManager();\n\t\t\t}\n\n\t\t\treturn this.visibleMessagesManager;\n\t\t},\n\t\t/* endregion Init methods */\n\t\thasVisibleCall(): boolean\n\t\t{\n\t\t\treturn CallManager.getInstance().hasVisibleCall();\n\t\t},\n\t\tcloseDialogPopups()\n\t\t{\n\t\t\tthis.showQuoteButton = false;\n\t\t\tPopupManager.getPopupById(PopupType.dialogAvatarMenu)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogMessageMenu)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogReactionUsers)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogReadUsers)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.messageBaseFileMenu)?.close();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.subscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t\t\tEventEmitter.subscribe(EventType.call.onFold, this.onCallFold);\n\t\t\tEventEmitter.subscribe(EventType.dialog.showForwardPopup, this.onShowForwardPopup);\n\t\t\tEventEmitter.subscribe(EventType.dialog.showQuoteButton, this.onShowQuoteButton);\n\t\t\tEventEmitter.subscribe(EventType.dialog.onMessageIsVisible, this.onMessageIsVisible);\n\t\t\tEventEmitter.subscribe(EventType.dialog.onMessageIsNotVisible, this.onMessageIsNotVisible);\n\n\t\t\tEvent.bind(window, 'focus', this.onWindowFocus);\n\t\t\tEvent.bind(window, 'blur', this.onWindowBlur);\n\t\t},\n\t\tunsubscribeFromEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t\t\tEventEmitter.unsubscribe(EventType.call.onFold, this.onCallFold);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.showForwardPopup, this.onShowForwardPopup);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.showQuoteButton, this.onShowQuoteButton);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.onMessageIsVisible, this.onMessageIsVisible);\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.onMessageIsNotVisible, this.onMessageIsNotVisible);\n\n\t\t\tEvent.unbind(window, 'focus', this.onWindowFocus);\n\t\t\tEvent.unbind(window, 'blur', this.onWindowBlur);\n\t\t},\n\t\tgetContainer(): ?HTMLElement\n\t\t{\n\t\t\treturn this.$refs.container;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__block bx-im-dialog-chat__scope\">\n\t\t\t<!-- Top -->\n\t\t\t<slot name=\"pinned-panel\">\n\t\t\t\t<PinnedMessages\n\t\t\t\t\tv-if=\"pinnedMessages.length > 0\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:messages=\"pinnedMessages\"\n\t\t\t\t\t@messageClick=\"onPinnedMessageClick\"\n\t\t\t\t\t@messageUnpin=\"onPinnedMessageUnpin\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t\t<PullStatus/>\n\t\t\t<!-- Message list -->\n\t\t\t<div @scroll=\"onScroll\" class=\"bx-im-dialog-chat__scroll-container\" ref=\"container\">\n\t\t\t\t<slot name=\"message-list\">\n\t\t\t\t\t<component :is=\"messageListComponent\" :dialogId=\"dialogId\" />\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<!-- Float buttons -->\n\t\t\t<slot name=\"additional-float-button\"></slot>\n\t\t\t<Transition name=\"float-button-transition\">\n\t\t\t\t<ScrollButton v-if=\"showScrollButton\" :dialogId=\"dialogId\" @click=\"onScrollButtonClick\" />\n\t\t\t</Transition>\n\t\t\t<!-- Absolute elements -->\n\t\t\t<ForwardPopup\n\t\t\t\t:showPopup=\"forwardPopup.show\"\n\t\t\t\t:messageId=\"forwardPopup.messageId\"\n\t\t\t\t@close=\"onCloseForwardPopup\"\n\t\t\t/>\n\t\t\t<Transition name=\"fade-up\">\n\t\t\t\t<QuoteButton\n\t\t\t\t\tv-if=\"showQuoteButton\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t@close=\"showQuoteButton = false\" \n\t\t\t\t\tclass=\"bx-im-message-base__quote-button\"\n\t\t\t\t\tref=\"quoteButton\"\n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t</div>\n\t`,\n};\n"],"names":["EVENT_NAMESPACE","SCROLLING_THRESHOLD","POSITION_THRESHOLD","SCROLLED_UP_THRESHOLD","FLOATING_DATE_OFFSET","ScrollManager","EventEmitter","constructor","isScrolling","currentScroll","lastScroll","chatIsScrolledUp","scrollButtonClicked","setEventNamespace","setContainer","container","onScroll","event","target","scrollTop","isScrollingDown","isScrollingUp","leftSpaceBottom","scrollHeight","clientHeight","emit","events","onScrollTriggerDown","onScrollTriggerUp","checkIfChatIsScrolledUp","availableScrollHeight","newFlag","onScrollThresholdPass","scrollToBottom","Logger","warn","forceScrollTo","animatedScrollToBottom","animatedScrollTo","scrollToMessage","messageId","params","withDateOffset","offset","element","getDomElementById","position","offsetTop","animatedScrollToMessage","Promise","resolve","cancelAnimatedScroll","scroll","top","behavior","adjustScrollOnHistoryAddition","oldContainerHeight","newContainerHeight","newScrollPosition","Animation","start","end","elementProperty","callback","cancel","isAtTheTop","isAtTheBottom","isAroundBottom","id","querySelector","MESSAGES_TAG_PREFIX","COMMENTS_TAG_PREFIX","PullWatchManager","dialogId","Core","getStore","getters","getPullClient","subscribe","unsubscribe","clearWatch","chatId","extendWatch","runAction","RestMethod","imV2ChatExtendPullWatch","data","role","UserRole","guest","ChatType","openChannel","channel","includes","type","comment","VisibleMessagesManager","Set","setMessageAsVisible","add","setMessageAsNotVisible","delete","getFirstMessageId","size","firstVisibleMessage","sort","a","b","PinnedMessage","props","message","Object","required","computed","internalMessage","text","Parser","purifyMessage","authorId","author","$store","template","PinnedMessages","name","components","String","default","messages","Array","emits","dialog","firstMessage","messagesToShow","slice","canUnpin","PermissionManager","getInstance","canPerformAction","ChatActionType","pinMessage","showUnpin","isCommentChat","methods","loc","phraseCode","$Bitrix","Loc","getMessage","CONTAINER_HEIGHT","CONTAINER_WIDTH","CONTAINER_OFFSET","slider","MessengerSlider","getCurrent","sliderRect","layout","getBoundingClientRect","offsetY","MESSAGE_TEXT_NODE_CLASS","QuoteButton","mouseX","mouseY","containerStyle","left","width","height","mounted","Event","bind","window","onMouseDown","onMessageMouseUp","button","prepareSelectedText","clientX","clientY","$refs","contains","$emit","Utils","browser","isFirefox","getSelection","toString","range","getRangeAt","rangeContents","cloneContents","nodesToIterate","childNodes","messageNode","node","isImage","getAttribute","isLineBreak","textContent","HTMLElement","tagName","toLowerCase","nodeName","isText","isMessageTextNode","textNode","matches","Boolean","extractTextFromMessageNode","onQuoteClick","Quote","sendQuoteEvent","ScrollButton","formattedCounter","counter","ChatDialog","MessageList","PullStatus","ForwardPopup","saveScrollOnExit","resetOnExit","forwardPopup","show","contextMode","active","messageIsLoaded","isScrolledUp","windowFocused","showQuoteButton","messagesToRead","dialogInited","inited","messageCollection","pinnedMessages","isOpened","openedDialogId","entityId","isGuest","debouncedScrollHandler","SCROLLING_DEBOUNCE_DELAY","Runtime","debounce","getScrollManager","debouncedReadHandler","readVisibleMessages","messageListComponent","showScrollButton","hasNextPage","watch","newValue","oldValue","getPullWatchManager","onChatInited","created","initContextMode","getContainer","length","scrollOnStart","document","hasFocus","subscribeToEvents","beforeUnmount","unsubscribeFromEvents","saveScrollPosition","handleMessagesOnExit","closeDialogPopups","hasVisibleCall","permissionManager","readMessage","forEach","getChatService","$nextTick","contextId","highlightMessage","goToMessageContext","markedId","BlockType","newMessages","savedPositionMessageId","lastReadId","isLastMessageId","lastMessageId","hasUnread","showLoadingBar","EventType","hideLoadingBar","hasMessage","getMessageService","loadContext","catch","error","HIGHLIGHT_CLASS","HIGHLIGHT_DURATION","Dom","addClass","setTimeout","removeClass","getVisibleMessagesManager","dispatch","fields","resetChat","LOAD_MESSAGE_ON_EXIT_DELAY","reloadMessageList","clearDialogMark","onDialogInited","oldHeight","hasPreparedHistoryMessages","drawPreparedHistoryMessages","isLoading","hasPrevPage","loadHistory","hasPreparedUnreadMessages","drawPreparedUnreadMessages","loadUnread","onScrollToBottom","threshold","DialogScrollThreshold","halfScreenUp","animation","getData","firstUnreadId","nearTheBottom","onGoToMessageContext","onPinnedMessageClick","onPinnedMessageUnpin","unpinMessage","onScrollButtonClick","handleSecondScrollButtonClick","loadInitialMessages","onWindowFocus","onWindowBlur","onCallFold","callDialogId","CallManager","getCurrentCallDialogId","onShowQuoteButton","$event","send","quoteButton","onShowForwardPopup","onCloseForwardPopup","onMessageIsVisible","viewed","onMessageIsNotVisible","layoutManager","LayoutManager","isChatContextAvailable","messageService","MessageService","chatService","ChatService","scrollManager","pullWatchManager","visibleMessagesManager","PopupManager","getPopupById","PopupType","dialogAvatarMenu","close","dialogMessageMenu","dialogReactionUsers","dialogReadUsers","messageBaseFileMenu","call","onFold","showForwardPopup","unbind"],"mappings":"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"}