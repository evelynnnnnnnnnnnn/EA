this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,i,r,o,n,l,c,d,g,u,p,h,v,m,M,b,I,L,f,_,C,P,y,B,F,E,A,x,H,T,S,k,O,D,G,w,N){"use strict";const U={name:"DialogLoader",props:{fullHeight:{type:Boolean,default:true}},data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-dialog-loader__container" :class="{'--full-height': fullHeight}">\n\t\t\t<div class="bx-im-dialog-loader__spinner"></div>\n\t\t\t<div class="bx-im-dialog-loader__text">{{ loc('IM_DIALOG_CHAT_LOADER_TEXT') }}</div>\n\t\t</div>\n\t`};const X=new Set([I.MessageComponent.unsupported,I.MessageComponent.chatCreation,I.MessageComponent.ownChatCreation,I.MessageComponent.conferenceCreation,I.MessageComponent.callInvite,I.MessageComponent.copilotCreation,I.MessageComponent.copilotMessage,I.MessageComponent.supportVote,I.MessageComponent.supportSessionNumber,I.MessageComponent.zoomInvite,I.MessageComponent.copilotAddedUsers,I.MessageComponent.supervisorUpdateFeature,I.MessageComponent.supervisorEnableFeature,I.MessageComponent.sign]);var K=babelHelpers.classPrivateFieldLooseKey("message");var j=babelHelpers.classPrivateFieldLooseKey("store");var R=babelHelpers.classPrivateFieldLooseKey("isServerComponent");var V=babelHelpers.classPrivateFieldLooseKey("hasFiles");var Y=babelHelpers.classPrivateFieldLooseKey("hasText");var $=babelHelpers.classPrivateFieldLooseKey("hasAttach");var q=babelHelpers.classPrivateFieldLooseKey("isEmptyMessage");var z=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var Q=babelHelpers.classPrivateFieldLooseKey("isSystemMessage");var W=babelHelpers.classPrivateFieldLooseKey("isEmojiOnly");var Z=babelHelpers.classPrivateFieldLooseKey("hasSmilesOnly");var J=babelHelpers.classPrivateFieldLooseKey("hasOnlyText");var ee=babelHelpers.classPrivateFieldLooseKey("isForward");class te{constructor(e){Object.defineProperty(this,ee,{value:ue});Object.defineProperty(this,J,{value:ge});Object.defineProperty(this,Z,{value:de});Object.defineProperty(this,W,{value:ce});Object.defineProperty(this,Q,{value:le});Object.defineProperty(this,z,{value:ne});Object.defineProperty(this,q,{value:oe});Object.defineProperty(this,$,{value:re});Object.defineProperty(this,Y,{value:ie});Object.defineProperty(this,V,{value:ae});Object.defineProperty(this,R,{value:se});Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,j,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,K)[K]=e;babelHelpers.classPrivateFieldLooseBase(this,j)[j]=b.Core.getStore()}getName(){if(babelHelpers.classPrivateFieldLooseBase(this,z)[z]()){return I.MessageComponent.deleted}if(babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].componentId}if(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()){return I.MessageComponent.system}if(babelHelpers.classPrivateFieldLooseBase(this,V)[V]()){return I.MessageComponent.file}if(babelHelpers.classPrivateFieldLooseBase(this,W)[W]()||babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()){return I.MessageComponent.smile}return I.MessageComponent.default}}function se(){return X.has(babelHelpers.classPrivateFieldLooseBase(this,K)[K].componentId)}function ae(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].files.length>0}function ie(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].text.length>0}function re(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].attach.length>0}function oe(){return!babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]()&&!babelHelpers.classPrivateFieldLooseBase(this,V)[V]()&&!babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}function ne(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].isDeleted||babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}function le(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K].authorId===0}function ce(){if(babelHelpers.classPrivateFieldLooseBase(this,K)[K].replyId>0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return false}if(!babelHelpers.classPrivateFieldLooseBase(this,J)[J]()){return false}return g.Utils.text.isEmojiOnly(babelHelpers.classPrivateFieldLooseBase(this,K)[K].text)}function de(){var e,t;if(babelHelpers.classPrivateFieldLooseBase(this,K)[K].replyId>0){return false}if(babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]()){return false}if(!babelHelpers.classPrivateFieldLooseBase(this,J)[J]()){return false}const s=a.SmileManager.getInstance();const i=(e=(t=s.smileList)==null?void 0:t.smiles)!=null?e:[];const r=[...i].sort(((e,t)=>t.typing.localeCompare(e.typing)));const o=r.map((e=>g.Utils.text.escapeRegex(e.typing))).join("|");const n=babelHelpers.classPrivateFieldLooseBase(this,K)[K].text.replaceAll(new RegExp(o,"g"),"");const l=n.trim().length===0;const c=new RegExp(`(?:(?:${o})\\s*){4,}`);return l&&!c.test(babelHelpers.classPrivateFieldLooseBase(this,K)[K].text)}function ge(){if(!babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]()){return false}return!babelHelpers.classPrivateFieldLooseBase(this,V)[V]()&&!babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}function ue(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j].getters["messages/isForward"](babelHelpers.classPrivateFieldLooseBase(this,K)[K].id)}class pe extends o.BaseMenu{constructor(){super();this.id="bx-im-avatar-context-menu";this.permissionManager=u.PermissionManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:21}}getMenuItems(){return[this.getMentionItem(),this.getSendItem(),this.getProfileItem(),this.getKickItem()]}getMentionItem(){return{text:m.Loc.getMessage("IM_DIALOG_AVATAR_MENU_MENTION_2"),onclick:()=>{M.EventEmitter.emit(I.EventType.textarea.insertMention,{mentionText:this.context.user.name,mentionReplacement:g.Utils.text.getMentionBbCode(this.context.user.id,this.context.user.name),dialogId:this.context.dialog.dialogId});this.menuInstance.close()}}}getSendItem(){if(this.context.dialog.type===I.ChatType.user){return null}return{text:m.Loc.getMessage("IM_DIALOG_AVATAR_MENU_SEND_MESSAGE"),onclick:()=>{i.Messenger.openChat(this.context.user.id);this.menuInstance.close()}}}getProfileItem(){if(this.isBot()){return null}return{text:m.Loc.getMessage("IM_DIALOG_AVATAR_MENU_OPEN_PROFILE"),href:g.Utils.user.getProfileLink(this.context.user.id),onclick:()=>{this.menuInstance.close()}}}getKickItem(){const e=this.permissionManager.canPerformAction(I.ChatActionType.kick,this.context.dialog.dialogId);if(!e){return null}return{text:m.Loc.getMessage("IM_DIALOG_AVATAR_MENU_KICK"),onclick:async()=>{this.menuInstance.close();const e=await r.showKickUserConfirm();if(e===true){const e=new c.ChatService;e.kickUserFromChat(this.context.dialog.dialogId,this.context.user.id)}}}}isUser(){return this.store.getters["chats/isUser"](this.context.user.id)}isBot(){if(!this.isUser()){return false}const e=this.store.getters["users/get"](this.context.user.id);return e.bot===true}}var he=babelHelpers.classPrivateFieldLooseKey("isOwnMessage");var ve=babelHelpers.classPrivateFieldLooseKey("isDeletedMessage");var me=babelHelpers.classPrivateFieldLooseKey("getMessageFile");var Me=babelHelpers.classPrivateFieldLooseKey("isForwardedMessage");class be extends o.BaseMenu{constructor(){super();Object.defineProperty(this,Me,{value:_e});Object.defineProperty(this,me,{value:fe});Object.defineProperty(this,ve,{value:Le});Object.defineProperty(this,he,{value:Ie});this.id="bx-im-message-context-menu";this.diskService=new c.DiskService;this.marketManager=d.MarketManager.getInstance()}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11}}getMenuItems(){return[this.getReplyItem(),this.getCopyItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getPinItem(),this.getForwardItem(),this.getDelimiter(),this.getMarkItem(),this.getFavoriteItem(),this.getDelimiter(),this.getCreateItem(),this.getDelimiter(),this.getDownloadFileItem(),this.getSaveToDisk(),this.getDelimiter(),this.getEditItem(),this.getDeleteItem()]}getReplyItem(){return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onclick:()=>{M.EventEmitter.emit(I.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getForwardItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()||m.Type.isString(this.context.id)){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),onclick:()=>{M.EventEmitter.emit(I.EventType.dialog.showForwardPopup,{messageId:this.context.id});this.menuInstance.close()}}}getCopyItem(){if(this.context.text.trim().length===0){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onclick:()=>{var e;const t=n.Parser.prepareCopy(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_SUCCESS")})}this.menuInstance.close()}}}getCopyLinkItem(){return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK"),onclick:()=>{var e;const t=g.Utils.text.getMessageLink(this.context.dialogId,this.context.id);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_SUCCESS")})}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length===0){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),onclick:()=>{var e;const t=n.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(t)){BX.UI.Notification.Center.notify({content:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE_SUCCESS")})}this.menuInstance.close()}}}getPinItem(){const e=u.PermissionManager.getInstance().canPerformAction(I.ChatActionType.pinMessage,this.context.dialogId);if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()||!e){return null}const t=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{text:t?m.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):m.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),onclick:()=>{const e=new c.MessageService({chatId:this.context.chatId});if(t){e.unpinMessage(this.context.chatId,this.context.id)}else{e.pinMessage(this.context.chatId,this.context.id)}this.menuInstance.close()}}}getFavoriteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?m.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):m.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{text:t,onclick:()=>{const t=new c.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!babelHelpers.classPrivateFieldLooseBase(this,he)[he]();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),onclick:()=>{const e=new c.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE"),items:[this.getCreateTaskItem(),this.getCreateMeetingItem(),...this.getMarketItems()]}}getCreateTaskItem(){return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK"),onclick:()=>{const e=new l.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING"),onclick:()=>{const e=new l.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he]()||babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()||babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]()){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),onclick:()=>{M.EventEmitter.emit(I.EventType.textarea.editMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getDeleteItem(){if(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()){return null}const e=u.PermissionManager.getInstance();const t=e.canPerformAction(I.ChatActionType.deleteOthersMessage,this.context.dialogId);if(!babelHelpers.classPrivateFieldLooseBase(this,he)[he]()&&!t){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),className:"menu-popup-no-icon bx-im-dialog-chat__message-menu_delete",onclick:()=>{const e=new c.MessageService({chatId:this.context.chatId});void e.deleteMessage(this.context.id);this.menuInstance.close()}}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(I.PlacementType.contextMenu,e);const a=[];if(s.length>0){a.push(this.getDelimiter())}const i={messageId:t,dialogId:e};s.forEach((e=>{a.push({text:e.title,onclick:()=>{d.MarketManager.openSlider(e,i);this.menuInstance.close()}})}));const r=11;return a.slice(0,r)}getDownloadFileItem(){const e=babelHelpers.classPrivateFieldLooseBase(this,me)[me]();if(!e){return null}return{html:g.Utils.file.createDownloadLink(m.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),e.urlDownload,e.name),onclick:function(){this.menuInstance.close()}.bind(this)}}getSaveToDisk(){const e=babelHelpers.classPrivateFieldLooseBase(this,me)[me]();if(!e){return null}return{text:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK"),onclick:function(){void this.diskService.save(e.id).then((()=>{BX.UI.Notification.Center.notify({content:m.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_SUCCESS")})}));this.menuInstance.close()}.bind(this)}}getDelimiter(){return{delimiter:true}}}function Ie(){return this.context.authorId===b.Core.getUserId()}function Le(){return this.context.isDeleted}function fe(){if(this.context.files.length===0){return null}return this.store.getters["files/get"](this.context.files[0])}function _e(){return m.Type.isStringFilled(this.context.forward.id)}var Ce=babelHelpers.classPrivateFieldLooseKey("dialogId");var Pe=babelHelpers.classPrivateFieldLooseKey("observer");var ye=babelHelpers.classPrivateFieldLooseKey("initObserver");var Be=babelHelpers.classPrivateFieldLooseKey("sendVisibleEvent");var Fe=babelHelpers.classPrivateFieldLooseKey("sendNotVisibleEvent");var Ee=babelHelpers.classPrivateFieldLooseKey("getThreshold");var Ae=babelHelpers.classPrivateFieldLooseKey("getMessageIdFromElement");class xe{constructor(e){Object.defineProperty(this,Ae,{value:Oe});Object.defineProperty(this,Ee,{value:ke});Object.defineProperty(this,Fe,{value:Se});Object.defineProperty(this,Be,{value:Te});Object.defineProperty(this,ye,{value:He});Object.defineProperty(this,Ce,{writable:true,value:void 0});Object.defineProperty(this,Pe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=e;babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()}observeMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].observe(e)}unobserveMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].unobserve(e)}}function He(){babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=new IntersectionObserver((e=>{e.forEach((e=>{const t=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](e.target);if(!t||!e.rootBounds){return}const s=e.isIntersecting&&e.intersectionRatio>=.99;const a=e.intersectionRect.height>=e.rootBounds.height/2.2;if(s||a){babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](t)}else{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe](t)}}))}),{threshold:babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()})}function Te(e){M.EventEmitter.emit(I.EventType.dialog.onMessageIsVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]})}function Se(e){M.EventEmitter.emit(I.EventType.dialog.onMessageIsNotVisible,{messageId:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]})}function ke(){const e=Array.from({length:101}).fill(0);return e.map(((e,t)=>t*.01))}function Oe(e){return Number(e.dataset.id)}const De={props:{title:{type:String,required:true}},data(){return{}},template:`\n\t\t<div class="bx-im-message-list-date-group-title__container">\n\t\t\t<div class="bx-im-message-list-date-group-title__text">{{ title }}</div>\n\t\t</div>\n\t`};const Ge={name:"DateGroup",components:{DateGroupTitle:De},props:{item:{type:Object,required:true}},data(){return{}},computed:{BlockType:()=>I.DialogBlockType,dateGroup(){return this.item}},template:`\n\t\t<div class="bx-im-message-list-date-group__container">\n\t\t\t<DateGroupTitle :title="dateGroup.dateTitle" />\n\t\t\t<template v-for="dateGroupItem in dateGroup.items" >\n\t\t\t\t<slot\n\t\t\t\t\tname="dateGroupItem"\n\t\t\t\t\t:dateGroupItem="dateGroupItem"\n\t\t\t\t\t:isMarkedBlock="dateGroupItem.type === BlockType.markedMessages"\n\t\t\t\t\t:isNewMessagesBlock="dateGroupItem.type === BlockType.newMessages"\n\t\t\t\t\t:isAuthorBlock="dateGroupItem.type === BlockType.authorGroup"\n\t\t\t\t></slot>\n\t\t\t</template>\n\t\t</div>\n\t`};const we={name:"AuthorGroup",components:{Avatar:v.Avatar},props:{item:{type:Object,required:true}},emits:["avatarClick"],data(){return{}},computed:{AvatarSize:()=>v.AvatarSize,authorGroup(){return this.item}},methods:{onAvatarClick(e){this.$emit("avatarClick",{dialogId:this.authorGroup.avatar.avatarId,$event:e})}},template:`\n\t\t<div class="bx-im-message-list-author-group__container" :class="'--' + authorGroup.messageType">\n\t\t\t<div v-if="authorGroup.avatar.isNeeded" class="bx-im-message-list-author-group__avatar">\n\t\t\t\t<Avatar\n\t\t\t\t\t:dialogId="authorGroup.avatar.avatarId"\n\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t\t@click="onAvatarClick"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-message-list__content">\n\t\t\t\t<template v-for="(message, index) in authorGroup.messages">\n\t\t\t\t\t<slot name="message" :message="message" :index="index"></slot>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ne={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_NEW_MESSAGES_2') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Ue={data(){return{}},methods:{loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-new-message__container">\n\t\t\t<div class="bx-im-message-list-new-message__text">\n\t\t\t\t{{ loc('IM_DIALOG_CHAT_BLOCK_MARKED_MESSAGES') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const Xe=[m.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_1"),m.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_2"),m.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_3"),m.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_4"),m.Loc.getMessage("IM_MESSAGE_LIST_EMPTY_STATE_DEFAULT_MESSAGE_5")];const Ke={name:"EmptyState",props:{dialogId:{type:String,required:true}},data(){return{}},computed:{defaultMessages:()=>Xe},methods:{onMessageClick(e){M.EventEmitter.emit(I.EventType.textarea.insertText,{text:e,dialogId:this.dialogId})},loc(e){return this.$Bitrix.Loc.getMessage(e)}},template:`\n\t\t<div class="bx-im-message-list-empty-state__container">\n\t\t\t<div class="bx-im-message-list-empty-state__content">\n\t\t\t\t<div class="bx-im-message-list-empty-state__icon"></div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__title">{{ loc('IM_MESSAGE_LIST_EMPTY_STATE_TITLE') }}</div>\n\t\t\t\t<div class="bx-im-message-list-empty-state__action-list">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="(message, index) in defaultMessages"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t@click="onMessageClick(message)"\n\t\t\t\t\t\tclass="bx-im-message-list-empty-state__action-list_item"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ message }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};var je=babelHelpers.classPrivateFieldLooseKey("getAvatarConfig");var Re=babelHelpers.classPrivateFieldLooseKey("getMessageType");var Ve=babelHelpers.classPrivateFieldLooseKey("checkIfAvatarIsNeeded");class Ye{constructor(){Object.defineProperty(this,Ve,{value:ze});Object.defineProperty(this,Re,{value:qe});Object.defineProperty(this,je,{value:$e})}getAuthorBlock(e){return{type:I.DialogBlockType.authorGroup,userId:e.authorId,avatar:babelHelpers.classPrivateFieldLooseBase(this,je)[je](e),messageType:babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e)}}getMarkedBlock(){return{type:I.DialogBlockType.markedMessages}}getNewMessagesBlock(){return{type:I.DialogBlockType.newMessages}}}function $e(e){return{isNeeded:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve](e),avatarId:e.authorId.toString()}}function qe(e){if(!e.authorId){return I.MessageType.system}if(e.authorId===b.Core.getUserId()){return I.MessageType.self}return I.MessageType.opponent}function ze(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e);const s=t===I.MessageType.system;if(s){return false}const a=t===I.MessageType.self;const i=b.Core.getStore().getters["application/settings/get"](I.Settings.appearance.alignment);if(i===I.DialogAlignment.center){return!a}return true}var Qe=babelHelpers.classPrivateFieldLooseKey("blockManager");var We=babelHelpers.classPrivateFieldLooseKey("collection");var Ze=babelHelpers.classPrivateFieldLooseKey("currentDateTitles");var Je=babelHelpers.classPrivateFieldLooseKey("markedIndicatorInserted");var et=babelHelpers.classPrivateFieldLooseKey("lastDateItems");var tt=babelHelpers.classPrivateFieldLooseKey("lastAuthorId");var st=babelHelpers.classPrivateFieldLooseKey("lastAuthorItems");var at=babelHelpers.classPrivateFieldLooseKey("clearLastAuthor");class it{constructor(){Object.defineProperty(this,at,{value:rt});Object.defineProperty(this,Qe,{writable:true,value:void 0});Object.defineProperty(this,We,{writable:true,value:[]});Object.defineProperty(this,Ze,{writable:true,value:new Set});Object.defineProperty(this,Je,{writable:true,value:false});Object.defineProperty(this,et,{writable:true,value:[]});Object.defineProperty(this,tt,{writable:true,value:null});Object.defineProperty(this,st,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=new Ye}get(){return babelHelpers.classPrivateFieldLooseBase(this,We)[We]}hasDateTitle(e){return babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].has(e)}addDateGroup(e){babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].add(e);babelHelpers.classPrivateFieldLooseBase(this,et)[et]=[];babelHelpers.classPrivateFieldLooseBase(this,We)[We].push({dateTitle:e,items:babelHelpers.classPrivateFieldLooseBase(this,et)[et]});babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}addAuthorGroup(e){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=e.authorId;babelHelpers.classPrivateFieldLooseBase(this,st)[st]=[];babelHelpers.classPrivateFieldLooseBase(this,et)[et].push({...babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getAuthorBlock(e),messages:babelHelpers.classPrivateFieldLooseBase(this,st)[st]})}addMessage(e){babelHelpers.classPrivateFieldLooseBase(this,st)[st].push(e)}addMarkedIndicator(){babelHelpers.classPrivateFieldLooseBase(this,et)[et].push(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getMarkedBlock());babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=true;babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}addNewMessagesIndicator(){if(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]){return}babelHelpers.classPrivateFieldLooseBase(this,et)[et].push(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].getNewMessagesBlock());babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}getLastAuthorId(){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]}}function rt(){babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]=null}class ot{constructor(){this.cachedDateGroups={}}getDateTitle(e){const t=10;const s=e.toJSON().slice(0,t);if(this.cachedDateGroups[s]){return this.cachedDateGroups[s]}this.cachedDateGroups[s]=L.DateFormatter.formatByTemplate(e,L.DateTemplate.dateGroup);return this.cachedDateGroups[s]}}var nt=babelHelpers.classPrivateFieldLooseKey("setInitialValues");var lt=babelHelpers.classPrivateFieldLooseKey("handleMarkedMessageId");var ct=babelHelpers.classPrivateFieldLooseKey("getLastReadMessageId");var dt=babelHelpers.classPrivateFieldLooseKey("getDialog");class gt{constructor(e){Object.defineProperty(this,dt,{value:vt});Object.defineProperty(this,ct,{value:ht});Object.defineProperty(this,lt,{value:pt});Object.defineProperty(this,nt,{value:ut});this.firstIteration=true;this.dialogId=e;this.dateManager=new ot}formatMessageCollection(e){const t=new it;babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]();babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]();e.forEach(((s,a)=>{const i=this.dateManager.getDateTitle(s.date);if(!t.hasDateTitle(i)){t.addDateGroup(i)}if(s.id===this.markedMessageId){t.addMarkedIndicator()}if(s.authorId!==t.getLastAuthorId()){t.addAuthorGroup(s)}t.addMessage(s);const r=a===e.length-1;if(!r&&s.id===this.lastReadMessageId){t.addNewMessagesIndicator()}}));const{inited:s}=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();if(s){this.firstIteration=false}return t.get()}formatAuthorGroup(e){const t=new Ye;return{...t.getAuthorBlock(e),messages:[e]}}}function ut(){if(!this.firstIteration){return}const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();this.lastReadMessageId=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]();this.markedMessageId=e}function pt(){const{markedId:e}=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();if(e===this.markedMessageId||e===0){return}this.markedMessageId=e;this.lastReadMessageId=null}function ht(){const{lastMessageId:e}=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]();const t=b.Core.getStore().getters["chats/getLastReadId"](this.dialogId);if(t===e){return 0}return t}function vt(){return b.Core.getStore().getters["chats/get"](this.dialogId)}const mt={DefaultMessage:_.DefaultMessage,FileMessage:f.FileMessage,SmileMessage:B.SmileMessage,CallInviteMessage:C.CallInviteMessage,DeletedMessage:P.DeletedMessage,SystemMessage:F.SystemMessage,UnsupportedMessage:y.UnsupportedMessage,ChatCreationMessage:E.ChatCreationMessage,OwnChatCreationMessage:w.OwnChatCreationMessage,ChatCopilotCreationMessage:A.ChatCopilotCreationMessage,CopilotMessage:x.CopilotMessage,SupportVoteMessage:T.SupportVoteMessage,SupportSessionNumberMessage:S.SupportSessionNumberMessage,ConferenceCreationMessage:k.ConferenceCreationMessage,ZoomInviteMessage:N.ZoomInviteMessage,SupervisorUpdateFeatureMessage:O.SupervisorUpdateFeatureMessage,SupervisorEnableFeatureMessage:D.SupervisorEnableFeatureMessage,ChatCopilotAddedUsersMessage:H.ChatCopilotAddedUsersMessage,SignMessage:G.SignMessage};const Mt={name:"MessageList",directives:{"message-observer":{mounted(e,t){t.instance.observer.observeMessage(e)},beforeUnmount(e,t){t.instance.observer.unobserveMessage(e)}}},components:{DateGroup:Ge,AuthorGroup:we,NewMessagesBlock:Ne,MarkedMessagesBlock:Ue,DialogStatus:v.DialogStatus,DialogLoader:U,EmptyState:Ke,FadeAnimation:s.FadeAnimation,...mt},props:{dialogId:{type:String,required:true},messageMenuClass:{type:Function,default:be}},data(){return{windowFocused:false,messageMenuIsActiveForId:0}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},user(){return this.$store.getters["users/get"](this.dialogId,true)},messageCollection(){return this.$store.getters["messages/getByChatId"](this.dialog.chatId)},isUser(){return this.dialog.type===I.ChatType.user},dialogInited(){return this.dialog.inited},formattedCollection(){if(!this.dialogInited&&this.messageCollection.length===0){return[]}return this.getCollectionManager().formatMessageCollection(this.messageCollection)},noMessages(){return this.formattedCollection.length===0},showDialogStatus(){return this.messageCollection.some((e=>e.id===this.dialog.lastMessageId))},showEmptyState(){return this.dialogInited&&this.noMessages&&this.isUser},statusComponent(){return v.DialogStatus}},created(){this.initContextMenu();this.initCollectionManager();this.initObserverManager()},mounted(){this.subscribeToEvents()},beforeUnmount(){this.unsubscribeFromEvents()},methods:{subscribeToEvents(){M.EventEmitter.subscribe(I.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},unsubscribeFromEvents(){M.EventEmitter.unsubscribe(I.EventType.dialog.onClickMessageContextMenu,this.onMessageContextMenuClick)},insertTextQuote(e){M.EventEmitter.emit(I.EventType.textarea.insertText,{text:t.Quote.prepareQuoteText(e),withNewLine:true,replace:false,dialogId:this.dialogId})},insertMention(e){M.EventEmitter.emit(I.EventType.textarea.insertMention,{mentionText:e.name,mentionReplacement:g.Utils.text.getMentionBbCode(e.id,e.name),dialogId:this.dialogId})},openReplyPanel(e){M.EventEmitter.emit(I.EventType.textarea.replyMessage,{messageId:e,dialogId:this.dialogId})},needToShowAvatarMenuFor(e){if(!e){return false}const t=e.id===b.Core.getUserId();const s=this.isUser&&this.user.bot===true;return!t&&!s},onAvatarClick(e){const t=u.PermissionManager.getInstance();if(!t.canPerformAction(I.ChatActionType.openAvatarMenu,this.dialogId)){return}const{dialogId:s,$event:a}=e;const i=this.$store.getters["users/get"](s);if(!this.needToShowAvatarMenuFor(i)){return}if(g.Utils.key.isAltOrOption(a)){this.insertMention(i);return}this.avatarMenu.openMenu({user:i,dialog:this.dialog},a.currentTarget)},onMessageContextMenuClick(e){const t=u.PermissionManager.getInstance();if(!t.canPerformAction(I.ChatActionType.openMessageMenu,this.dialogId)){return}const{message:s,event:a,dialogId:i}=e.getData();if(i!==this.dialogId){return}if(g.Utils.key.isCombination(a,["Alt+Ctrl"])){this.insertTextQuote(s);return}if(g.Utils.key.isCmdOrCtrl(a)){this.openReplyPanel(s.id);return}const r={dialogId:this.dialogId,...s};this.messageMenu.openMenu(r,a.currentTarget);this.messageMenuIsActiveForId=s.id},async onMessageMouseUp(e,t){await g.Utils.browser.waitForSelectionToUpdate();const s=window.getSelection().toString().trim();if(s.length===0){return}M.EventEmitter.emit(I.EventType.dialog.showQuoteButton,{message:e,event:t})},initObserverManager(){this.observer=new xe(this.dialogId)},initContextMenu(){const e=this.messageMenuClass;this.messageMenu=new e;this.messageMenu.subscribe(be.events.onCloseMenu,(()=>{this.messageMenuIsActiveForId=0}));this.avatarMenu=new pe},getMessageComponentName(e){return new te(e).getName()},initCollectionManager(){this.collectionManager=new gt(this.dialogId)},getCollectionManager(){return this.collectionManager}},template:`\n\t\t<slot v-if="!dialogInited" name="loader">\n\t\t\t<DialogLoader />\n\t\t</slot>\n\t\t<FadeAnimation :duration="200">\n\t\t\t<div v-if="dialogInited" class="bx-im-message-list__container">\n\t\t\t\t<EmptyState v-if="showEmptyState" :dialogId="dialogId" />\n\t\t\t\t<slot name="before-messages" :getMessageComponentName="getMessageComponentName"></slot>\n\t\t\t\t<DateGroup v-for="dateGroup in formattedCollection" :key="dateGroup.dateTitle" :item="dateGroup">\n\t\t\t\t\t\x3c!-- Slot for every date group item --\x3e\n\t\t\t\t\t<template #dateGroupItem="{ dateGroupItem, isMarkedBlock, isNewMessagesBlock, isAuthorBlock }">\n\t\t\t\t\t\t<MarkedMessagesBlock v-if="isMarkedBlock" data-id="newMessages" />\n\t\t\t\t\t\t<NewMessagesBlock v-else-if="isNewMessagesBlock" data-id="newMessages" />\n\t\t\t\t\t\t<AuthorGroup v-else-if="isAuthorBlock" :item="dateGroupItem" @avatarClick="onAvatarClick">\n\t\t\t\t\t\t\t\x3c!-- Slot for every message --\x3e\n\t\t\t\t\t\t\t<template #message="{ message, index }">\n\t\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t\tv-message-observer\n\t\t\t\t\t\t\t\t\t:is="getMessageComponentName(message)"\n\t\t\t\t\t\t\t\t\t:withTitle="index === 0"\n\t\t\t\t\t\t\t\t\t:item="message"\n\t\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t\t:key="message.id"\n\t\t\t\t\t\t\t\t\t:menuIsActiveForId="messageMenuIsActiveForId"\n\t\t\t\t\t\t\t\t\t:data-viewed="message.viewed"\n\t\t\t\t\t\t\t\t\t@mouseup="onMessageMouseUp(message, $event)"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</component>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</AuthorGroup>\n\t\t\t\t\t</template>\n\t\t\t\t</DateGroup>\n\t\t\t\t<component :is="statusComponent" v-if="showDialogStatus" :dialogId="dialogId" />\n\t\t\t</div>\n\t\t</FadeAnimation>\n\t`};e.MessageList=Mt;e.AvatarMenu=pe;e.MessageMenu=be;e.AuthorGroup=we;e.MessageComponents=mt;e.CollectionManager=gt;e.MessageComponentManager=te})(this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Animation,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX,BX.Messenger.v2.Component.Elements,BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message);
//# sourceMappingURL=message-list.bundle.map.js