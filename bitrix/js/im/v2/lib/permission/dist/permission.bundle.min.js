this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,r,a){"use strict";const i={[a.ChatActionType.readMessage]:a.UserRole.member,[a.ChatActionType.setReaction]:a.UserRole.member,[a.ChatActionType.openMessageMenu]:a.UserRole.member,[a.ChatActionType.openAvatarMenu]:a.UserRole.member,[a.ChatActionType.openSidebarMenu]:a.UserRole.member,[a.ChatActionType.followComments]:a.UserRole.member,[a.ChatActionType.openComments]:a.UserRole.guest,[a.ChatActionType.openSidebar]:a.UserRole.guest};const l="default";var o=babelHelpers.classPrivateFieldLooseKey("instance");var n=babelHelpers.classPrivateFieldLooseKey("rolePermissions");var c=babelHelpers.classPrivateFieldLooseKey("chatTypePermissions");var b=babelHelpers.classPrivateFieldLooseKey("actionGroups");var p=babelHelpers.classPrivateFieldLooseKey("actionGroupsDefaultRoles");var v=babelHelpers.classPrivateFieldLooseKey("init");var h=babelHelpers.classPrivateFieldLooseKey("canPerformActionByRole");var u=babelHelpers.classPrivateFieldLooseKey("canPerformActionByChatType");var d=babelHelpers.classPrivateFieldLooseKey("canPerformActionByChatSettings");var P=babelHelpers.classPrivateFieldLooseKey("getGroupByAction");var y=babelHelpers.classPrivateFieldLooseKey("prepareChatTypePermissions");var f=babelHelpers.classPrivateFieldLooseKey("checkMinimalRole");var L=babelHelpers.classPrivateFieldLooseKey("getDialog");class B{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,o)[o]){babelHelpers.classPrivateFieldLooseBase(this,o)[o]=new this}return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}static init(){B.getInstance()}constructor(){Object.defineProperty(this,L,{value:R});Object.defineProperty(this,f,{value:T});Object.defineProperty(this,y,{value:A});Object.defineProperty(this,P,{value:g});Object.defineProperty(this,d,{value:C});Object.defineProperty(this,u,{value:m});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,v,{value:F});Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,c,{writable:true,value:{}});Object.defineProperty(this,b,{writable:true,value:{}});Object.defineProperty(this,p,{writable:true,value:{}});const{permissions:e}=t.Core.getApplicationData();r.Logger.warn("PermissionManager: permission from server",e);babelHelpers.classPrivateFieldLooseBase(this,v)[v](e)}canPerformAction(e,s){return babelHelpers.classPrivateFieldLooseBase(this,h)[h](e,s)&&babelHelpers.classPrivateFieldLooseBase(this,u)[u](e,s)&&babelHelpers.classPrivateFieldLooseBase(this,d)[d](e,s)}getDefaultRolesForActionGroups(e){if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p][e]){return babelHelpers.classPrivateFieldLooseBase(this,p)[p][l]}return babelHelpers.classPrivateFieldLooseBase(this,p)[p][e]}}function F(e){babelHelpers.classPrivateFieldLooseBase(this,n)[n]=i;if(!e){return}const{byChatType:s,actionGroups:t,actionGroupsDefaults:r}=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=babelHelpers.classPrivateFieldLooseBase(this,y)[y](s);babelHelpers.classPrivateFieldLooseBase(this,b)[b]=t;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=r}function H(e,t){const{role:r}=babelHelpers.classPrivateFieldLooseBase(this,L)[L](t);if(s.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,n)[n][e])){return true}const a=babelHelpers.classPrivateFieldLooseBase(this,n)[n][e];return babelHelpers.classPrivateFieldLooseBase(this,f)[f](a,r)}function m(e,r){var i;let o=e;const n=babelHelpers.classPrivateFieldLooseBase(this,L)[L](r);const{role:b,owner:p}=n;let{type:v}=n;if(s.Type.isUndefined(babelHelpers.classPrivateFieldLooseBase(this,c)[c][v])){v=l}if(o===a.ChatActionType.kick){o=a.ChatActionType.leave}const h=p===t.Core.getUserId();if(o===a.ChatActionType.leave&&h){o=a.ChatActionType.leaveOwner}if(s.Type.isUndefined((i=babelHelpers.classPrivateFieldLooseBase(this,c)[c][v])==null?void 0:i[o])){return true}const u=babelHelpers.classPrivateFieldLooseBase(this,c)[c][v][o];return babelHelpers.classPrivateFieldLooseBase(this,f)[f](u,b)}function C(e,s){const{role:t,type:r,permissions:i}=babelHelpers.classPrivateFieldLooseBase(this,L)[L](s);if(r===a.ChatType.user){return true}const l=babelHelpers.classPrivateFieldLooseBase(this,P)[P](e);if(!l){return true}let o=i[l];if(!o){o=a.UserRole.member}return babelHelpers.classPrivateFieldLooseBase(this,f)[f](o,t)}function g(e){const s=Object.entries(babelHelpers.classPrivateFieldLooseBase(this,b)[b]).find((([s,t])=>t.includes(e)));if(!s){return null}const[t]=s;return t}function A(e){const s={...e};s[a.ChatType.user]={[a.ChatActionType.avatar]:a.UserRole.none,[a.ChatActionType.call]:a.UserRole.member,[a.ChatActionType.extend]:a.UserRole.member,[a.ChatActionType.leave]:a.UserRole.none,[a.ChatActionType.leaveOwner]:a.UserRole.none,[a.ChatActionType.mute]:a.UserRole.none,[a.ChatActionType.rename]:a.UserRole.none,[a.ChatActionType.send]:a.UserRole.member};return s}function T(e,s){if(e===a.UserRole.none){return false}const t={};Object.values(a.UserRole).forEach(((e,s)=>{t[e]=s}));return t[s]>=t[e]}function R(e){return t.Core.getStore().getters["chats/get"](e,true)}Object.defineProperty(B,o,{writable:true,value:void 0});e.PermissionManager=B})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=permission.bundle.map.js