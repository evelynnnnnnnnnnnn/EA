{"version":3,"file":"quote.bundle.js","sources":["../src/quote.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { EventType, ChatType } from 'im.v2.const';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelMessage, ImModelUser, ImModelChat } from 'im.v2.model';\n\nconst QUOTE_DELIMITER = '-'.repeat(54);\n\nexport const Quote = {\n\tsendQuoteEvent(message: ImModelMessage, text: string, dialogId: string)\n\t{\n\t\tEventEmitter.emit(EventType.textarea.insertText, {\n\t\t\ttext: this.prepareQuoteText(message, text),\n\t\t\tdialogId,\n\t\t\twithNewLine: true,\n\t\t\treplace: false,\n\t\t});\n\t},\n\tprepareQuoteText(message: ImModelMessage, text: string): string\n\t{\n\t\tlet quoteTitle = Loc.getMessage('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\tif (message.authorId)\n\t\t{\n\t\t\tconst user: ImModelUser = Core.getStore().getters['users/get'](message.authorId);\n\t\t\tquoteTitle = user.name;\n\t\t}\n\n\t\tconst quoteDate = DateFormatter.formatByTemplate(message.date, DateTemplate.notification);\n\n\t\tconst quoteText = Parser.prepareQuote(message, text);\n\n\t\tlet quoteContext = '';\n\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/getByChatId'](message.chatId);\n\t\tif (dialog && dialog.type === ChatType.user)\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}:${Core.getUserId()}/${message.id}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}/${message.id}`;\n\t\t}\n\n\t\treturn `${QUOTE_DELIMITER}\\n`\n\t\t\t+ `${quoteTitle} [${quoteDate}] ${quoteContext}\\n`\n\t\t\t+ `${quoteText}\\n`\n\t\t\t+ `${QUOTE_DELIMITER}\\n`\n\t\t;\n\t},\n};\n"],"names":["QUOTE_DELIMITER","repeat","Quote","sendQuoteEvent","message","text","dialogId","EventEmitter","emit","EventType","textarea","insertText","prepareQuoteText","withNewLine","replace","quoteTitle","Loc","getMessage","authorId","user","Core","getStore","getters","name","quoteDate","DateFormatter","formatByTemplate","date","DateTemplate","notification","quoteText","Parser","prepareQuote","quoteContext","dialog","chatId","type","ChatType","getUserId","id"],"mappings":";;;;;;;CAUA,MAAMA,eAAe,GAAG,GAAG,CAACC,MAAM,CAAC,EAAE,CAAC;AAEtC,OAAaC,KAAK,GAAG;GACpBC,cAAc,CAACC,OAAuB,EAAEC,IAAY,EAAEC,QAAgB,EACtE;KACCC,6BAAY,CAACC,IAAI,CAACC,qBAAS,CAACC,QAAQ,CAACC,UAAU,EAAE;OAChDN,IAAI,EAAE,IAAI,CAACO,gBAAgB,CAACR,OAAO,EAAEC,IAAI,CAAC;OAC1CC,QAAQ;OACRO,WAAW,EAAE,IAAI;OACjBC,OAAO,EAAE;MACT,CAAC;IACF;GACDF,gBAAgB,CAACR,OAAuB,EAAEC,IAAY,EACtD;KACC,IAAIU,UAAU,GAAGC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KACrE,IAAIb,OAAO,CAACc,QAAQ,EACpB;OACC,MAAMC,IAAiB,GAAGC,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAAClB,OAAO,CAACc,QAAQ,CAAC;OAChFH,UAAU,GAAGI,IAAI,CAACI,IAAI;;KAGvB,MAAMC,SAAS,GAAGC,qCAAa,CAACC,gBAAgB,CAACtB,OAAO,CAACuB,IAAI,EAAEC,oCAAY,CAACC,YAAY,CAAC;KAEzF,MAAMC,SAAS,GAAGC,uBAAM,CAACC,YAAY,CAAC5B,OAAO,EAAEC,IAAI,CAAC;KAEpD,IAAI4B,YAAY,GAAG,EAAE;KACrB,MAAMC,MAAmB,GAAGd,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAAClB,OAAO,CAAC+B,MAAM,CAAC;KACxF,IAAID,MAAM,IAAIA,MAAM,CAACE,IAAI,KAAKC,oBAAQ,CAAClB,IAAI,EAC3C;OACCc,YAAY,GAAI,IAAGC,MAAM,CAAC5B,QAAS,IAAGc,2BAAI,CAACkB,SAAS,EAAG,IAAGlC,OAAO,CAACmC,EAAG,EAAC;MACtE,MAED;OACCN,YAAY,GAAI,IAAGC,MAAM,CAAC5B,QAAS,IAAGF,OAAO,CAACmC,EAAG,EAAC;;KAGnD,OAAQ,GAAEvC,eAAgB,IAAG,GACzB,GAAEe,UAAW,KAAIS,SAAU,KAAIS,YAAa,IAAG,GAC/C,GAAEH,SAAU,IAAG,GACf,GAAE9B,eAAgB,IAAG;;CAG3B,CAAC;;;;;;;;"}