this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,i,o,n){"use strict";const r=new Set([o.ChatType.comment]);var l=babelHelpers.classPrivateFieldLooseKey("instance");var c=babelHelpers.classPrivateFieldLooseKey("lastOpenedElement");var d=babelHelpers.classPrivateFieldLooseKey("onGoToMessageContext");var b=babelHelpers.classPrivateFieldLooseKey("onDesktopReload");var y=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");var v=babelHelpers.classPrivateFieldLooseKey("isSameChat");var u=babelHelpers.classPrivateFieldLooseKey("onSameChatReopen");var p=babelHelpers.classPrivateFieldLooseKey("getChat");class g{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,l)[l]){babelHelpers.classPrivateFieldLooseBase(this,l)[l]=new this}return babelHelpers.classPrivateFieldLooseBase(this,l)[l]}static init(){g.getInstance()}constructor(){Object.defineProperty(this,p,{value:B});Object.defineProperty(this,u,{value:f});Object.defineProperty(this,v,{value:P});Object.defineProperty(this,y,{value:m});Object.defineProperty(this,b,{value:h});Object.defineProperty(this,d,{value:L});Object.defineProperty(this,c,{writable:true,value:{}});t.EventEmitter.subscribe(o.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,d)[d].bind(this));t.EventEmitter.subscribe(o.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}async setLayout(e){if(e.entityId){this.setLastOpenedElement(e.name,e.entityId)}if(babelHelpers.classPrivateFieldLooseBase(this,v)[v](e)){babelHelpers.classPrivateFieldLooseBase(this,u)[u](e)}babelHelpers.classPrivateFieldLooseBase(this,y)[y](e);return s.Core.getStore().dispatch("application/setLayout",e)}getLayout(){return s.Core.getStore().getters["application/getLayout"]}saveCurrentLayout(){const e=this.getLayout();i.LocalStorageManager.getInstance().set(o.LocalStorageKey.layoutConfig,{name:e.name,entityId:e.entityId})}restoreLastLayout(){const e=i.LocalStorageManager.getInstance().get(o.LocalStorageKey.layoutConfig);if(!e){return Promise.resolve()}n.Logger.warn("LayoutManager: last layout was restored",e);i.LocalStorageManager.getInstance().remove(o.LocalStorageKey.layoutConfig);return this.setLayout(e)}getLastOpenedElement(e){var t;return(t=babelHelpers.classPrivateFieldLooseBase(this,c)[c][e])!=null?t:null}setLastOpenedElement(e,t){babelHelpers.classPrivateFieldLooseBase(this,c)[c][e]=t}isChatContextAvailable(e){if(!this.getLayout().contextId){return false}const{type:t}=babelHelpers.classPrivateFieldLooseBase(this,p)[p](e);return!r.has(t)}destroy(){t.EventEmitter.unsubscribe(o.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,d)[d]);t.EventEmitter.unsubscribe(o.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,b)[b].bind(this))}}function L(e){const{dialogId:t,messageId:s}=e.getData();if(this.getLayout().entityId===t){return}const{type:a}=babelHelpers.classPrivateFieldLooseBase(this,p)[p](t);if(r.has(a)){return}const i=a===o.ChatType.copilot;void this.setLayout({name:i?o.Layout.copilot.name:o.Layout.chat.name,entityId:t,contextId:s})}function h(){this.saveCurrentLayout()}function m(e){const t=this.getLayout();if(t.name===o.Layout.copilot.name&&t.entityId===""){return}if(e.name===o.Layout.copilot.name&&e.entityId===""){a.Analytics.getInstance().openCopilotTab(e.entityId)}}function P(e){const{name:t,entityId:s}=this.getLayout();const a=t===e.name;const i=s&&s===e.entityId;return a&&i}function f(e){const{entityId:s,contextId:a}=e;const{type:i}=babelHelpers.classPrivateFieldLooseBase(this,p)[p](s);const n=[o.ChatType.openChannel,o.ChatType.channel].includes(i);if(n){t.EventEmitter.emit(o.EventType.dialog.closeComments)}if(a){t.EventEmitter.emit(o.EventType.dialog.goToMessageContext,{messageId:a,dialogId:s})}}function B(e){return s.Core.getStore().getters["chats/get"](e,true)}Object.defineProperty(g,l,{writable:true,value:void 0});e.LayoutManager=g})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=layout.bundle.map.js