this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,i,s,n,a,o,r,l,c,d){"use strict";const u=e=>l.Type.isNumber(e)||l.Type.isString(e);const m=e=>e.toString();const g=e=>Number.parseInt(e,10);const f=e=>o.Utils.date.cast(e,false);const h=/(_[\da-z])/gi;const p=e=>{const t={};Object.entries(e).forEach((([e,i])=>{const s=y(e);if(l.Type.isPlainObject(i)){t[s]=p(i);return}if(l.Type.isArray(i)){t[s]=N(i);return}t[s]=i}));return t};const y=e=>{let t=e;if(t.search(h)!==-1){t=t.toLowerCase()}return l.Text.toCamelCase(t)};const N=e=>e.map((e=>{if(!l.Type.isPlainObject(e)){return e}return p(e)}));const I={im:10};const F=e=>{const t={};const i=b(e);i.forEach((e=>{const i={};e.notices.forEach((e=>{i[e.id]=e}));t[e.id]={id:e.id,label:e.label,items:i}}));return t};const b=e=>[...e].sort(((e,t)=>{var i,s;const n=(i=I[e.id])!=null?i:0;const a=(s=I[t.id])!=null?s:0;return a-n}));const T=[{fieldName:r.Settings.notification.enableSound,targetFieldName:r.Settings.notification.enableSound,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.notification.enableAutoRead,targetFieldName:r.Settings.notification.enableAutoRead,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.notification.mode,targetFieldName:r.Settings.notification.mode,checkFunction:l.Type.isString},{fieldName:r.Settings.notification.enableWeb,targetFieldName:r.Settings.notification.enableWeb,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.notification.enableMail,targetFieldName:r.Settings.notification.enableMail,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.notification.enablePush,targetFieldName:r.Settings.notification.enablePush,checkFunction:l.Type.isBoolean},{fieldName:"notifications",targetFieldName:"notifications",checkFunction:l.Type.isArray,formatFunction:F},{fieldName:r.Settings.message.bigSmiles,targetFieldName:r.Settings.message.bigSmiles,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.appearance.background,targetFieldName:r.Settings.appearance.background,checkFunction:u,formatFunction:g},{fieldName:r.Settings.appearance.alignment,targetFieldName:r.Settings.appearance.alignment,checkFunction:l.Type.isString},{fieldName:r.Settings.recent.showBirthday,targetFieldName:r.Settings.recent.showBirthday,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.recent.showInvited,targetFieldName:r.Settings.recent.showInvited,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.recent.showLastMessage,targetFieldName:r.Settings.recent.showLastMessage,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.hotkey.sendByEnter,targetFieldName:r.Settings.hotkey.sendByEnter,checkFunction:l.Type.isString,formatFunction:e=>e==="1"},{fieldName:r.Settings.hotkey.sendByEnter,targetFieldName:r.Settings.hotkey.sendByEnter,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.desktop.enableRedirect,targetFieldName:r.Settings.desktop.enableRedirect,checkFunction:l.Type.isBoolean},{fieldName:r.Settings.user.status,targetFieldName:r.Settings.user.status,checkFunction:l.Type.isString}];const C=(e,t)=>{const i={};const s=p(e);t.forEach((t=>{const{fieldName:n,targetFieldName:a,checkFunction:o,formatFunction:r}=t;const l=S(s,n);if(!l){return}if(!v(s[l],o)){return}i[a]=P({fieldValue:s[l],formatFunction:r,currentResult:i,rawFields:e})}));return i};const S=(e,t)=>{let i=t;if(l.Type.isStringFilled(i)){i=[i]}for(const t of i){if(!l.Type.isUndefined(e[t])){return t}}return null};const v=(e,t)=>{let i=t;if(l.Type.isUndefined(i)){return true}if(l.Type.isFunction(i)){i=[i]}return i.some((t=>t(e)))};const P=e=>{const{fieldValue:t,formatFunction:i,currentResult:s,rawFields:n}=e;if(l.Type.isUndefined(i)){return t}return i(t,s,n)};class k extends c.BuilderModel{getState(){return{[r.Settings.appearance.background]:1,[r.Settings.appearance.alignment]:r.DialogAlignment.left,[r.Settings.notification.enableSound]:true,[r.Settings.notification.enableAutoRead]:true,[r.Settings.notification.mode]:r.NotificationSettingsMode.simple,[r.Settings.notification.enableWeb]:true,[r.Settings.notification.enableMail]:true,[r.Settings.notification.enablePush]:true,notifications:{},[r.Settings.message.bigSmiles]:true,[r.Settings.recent.showBirthday]:true,[r.Settings.recent.showInvited]:true,[r.Settings.recent.showLastMessage]:true,[r.Settings.desktop.enableRedirect]:true}}getGetters(){return{get:e=>t=>e[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.formatFields(t))},setNotificationOption:(e,t)=>{e.commit("setNotificationOption",t)}}}getMutations(){return{set:(e,t)=>{Object.entries(t).forEach((([t,i])=>{e[t]=i}))},setNotificationOption:(e,t)=>{var i;const{moduleId:s,optionName:n,type:a,value:o}=t;const r=e.notifications[s];if(!(r!=null&&(i=r.items)!=null&&i[n])){return}r.items[n][a]=o}}}formatFields(e){return C(e,T)}}class w extends c.BuilderModel{getName(){return"application"}getNestedModules(){return{settings:k}}getState(){return{layout:{name:r.Layout.chat.name,entityId:"",contextId:0}}}getGetters(){return{getLayout:e=>e.layout,isChatOpen:e=>t=>{const i=[r.Layout.chat.name,r.Layout.copilot.name,r.Layout.channel.name];if(!i.includes(e.layout.name)){return false}return e.layout.entityId===t.toString()},isLinesChatOpen:e=>t=>{if(e.layout.name!==r.Layout.openlines.name){return false}return e.layout.entityId===t.toString()},areNotificationsOpen:e=>e.layout.name===r.Layout.notification.name}}getActions(){return{setLayout:(e,i)=>{const{name:s,entityId:n="",contextId:a=0}=i;if(!l.Type.isStringFilled(s)){return}const o={...e.state.layout};const c={name:this.validateLayout(s),entityId:this.validateLayoutEntityId(s,n),contextId:a};if(o.name===c.name&&o.entityId===c.entityId){return}e.commit("updateLayout",{layout:c});t.EventEmitter.emit(r.EventType.layout.onLayoutChange,{from:o,to:c})}}}getMutations(){return{updateLayout:(e,t)=>{e.layout={...e.layout,...t.layout}}}}validateLayout(e){if(!r.Layout[e]){return r.Layout.chat.name}return e}validateLayoutEntityId(e,t){if(!r.Layout[e]){return""}return t}}const M=e=>{const t=Object.values(r.MessageComponent);if(!t.includes(e)){return r.MessageComponent.unsupported}return e};const L=(e,t,i)=>{if(l.Type.isString(i.system)&&i.system==="Y"){return 0}if(l.Type.isBoolean(i.isSystem)&&i.isSystem===true){return 0}return g(e)};const B=e=>e.map((e=>({...e,block:e.block==="Y",disabled:e.disabled==="Y",vote:e.vote==="Y",wait:e.wait==="Y"})));const E=[{fieldName:["id","temporaryId"],targetFieldName:"id",checkFunction:[l.Type.isNumber,o.Utils.text.isTempMessage]},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:u,formatFunction:g},{fieldName:"date",targetFieldName:"date",checkFunction:[l.Type.isString,l.Type.isDate],formatFunction:o.Utils.date.cast},{fieldName:"text",targetFieldName:"text",checkFunction:u,formatFunction:m},{fieldName:["senderId","authorId"],targetFieldName:"authorId",checkFunction:u,formatFunction:L},{fieldName:"sending",targetFieldName:"sending",checkFunction:l.Type.isBoolean},{fieldName:"unread",targetFieldName:"unread",checkFunction:l.Type.isBoolean},{fieldName:"viewed",targetFieldName:"viewed",checkFunction:l.Type.isBoolean},{fieldName:"viewedByOthers",targetFieldName:"viewedByOthers",checkFunction:l.Type.isBoolean},{fieldName:"error",targetFieldName:"error",checkFunction:l.Type.isBoolean},{fieldName:"componentId",targetFieldName:"componentId",checkFunction:e=>l.Type.isString(e)&&e!=="",formatFunction:M},{fieldName:"componentParams",targetFieldName:"componentParams",checkFunction:l.Type.isPlainObject},{fieldName:["files","fileId"],targetFieldName:"files",checkFunction:l.Type.isArray},{fieldName:"attach",targetFieldName:"attach",checkFunction:[l.Type.isArray,l.Type.isBoolean,l.Type.isString]},{fieldName:"keyboard",targetFieldName:"keyboard",checkFunction:l.Type.isArray,formatFunction:B},{fieldName:"keyboard",targetFieldName:"keyboard",checkFunction:e=>e==="N",formatFunction:()=>[]},{fieldName:"isEdited",targetFieldName:"isEdited",checkFunction:l.Type.isString,formatFunction:e=>e==="Y"},{fieldName:"isEdited",targetFieldName:"isEdited",checkFunction:l.Type.isBoolean},{fieldName:"isDeleted",targetFieldName:"isDeleted",checkFunction:l.Type.isString,formatFunction:e=>e==="Y"},{fieldName:"isDeleted",targetFieldName:"isDeleted",checkFunction:l.Type.isBoolean},{fieldName:"replyId",targetFieldName:"replyId",checkFunction:u,formatFunction:g},{fieldName:"forward",targetFieldName:"forward",checkFunction:l.Type.isPlainObject}];class x extends c.BuilderModel{getState(){return{collection:{}}}getGetters(){return{getPinned:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t]].map((e=>d.Core.getStore().getters["messages/getById"](e)))},isPinned:e=>t=>{const{chatId:i,messageId:s}=t;if(!e.collection[i]){return false}return e.collection[i].has(s)}}}getActions(){return{setPinned:(e,t)=>{const{chatId:i,pinnedMessages:s}=t;if(s.length===0){return}e.commit("setPinned",{chatId:i,pinnedMessageIds:s})},set:(e,t)=>{e.commit("set",t)},add:(e,t)=>{e.commit("add",t)},delete:(e,t)=>{e.commit("delete",t)}}}getMutations(){return{setPinned:(e,t)=>{n.Logger.warn("Messages/pin model: setPinned mutation",t);const{chatId:i,pinnedMessageIds:s}=t;e.collection[i]=new Set(s.reverse())},add:(e,t)=>{n.Logger.warn("Messages/pin model: add pin mutation",t);const{chatId:i,messageId:s}=t;if(!e.collection[i]){e.collection[i]=new Set}e.collection[i].add(s)},delete:(e,t)=>{n.Logger.warn("Messages/pin model: delete pin mutation",t);const{chatId:i,messageId:s}=t;if(!e.collection[i]){return}e.collection[i].delete(s)}}}}const A=Object.freeze({like:"like",kiss:"kiss",laugh:"laugh",wonder:"wonder",cry:"cry",angry:"angry",facepalm:"facepalm"});const U=5;class O extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{reactionCounters:{},reactionUsers:{},ownReactions:new Set}}getGetters(){return{getByMessageId:e=>t=>e.collection[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.prepareSetPayload(t))},setReaction:(e,t)=>{if(!A[t.reaction]){return}if(!e.state.collection[t.messageId]){e.state.collection[t.messageId]=this.getElementState()}e.commit("setReaction",t)},removeReaction:(e,t)=>{if(!e.state.collection[t.messageId]||!A[t.reaction]){return}e.commit("removeReaction",t)}}}getMutations(){return{set:(e,t)=>{t.forEach((t=>{const i={reactionCounters:t.reactionCounters,reactionUsers:t.reactionUsers};const s=e.collection[t.messageId];const n=!!t.ownReactions;if(n){i.ownReactions=t.ownReactions}else{i.ownReactions=s?s.ownReactions:new Set}e.collection[t.messageId]=i}))},setReaction:(e,t)=>{const{messageId:i,userId:s,reaction:n}=t;const a=e.collection[i];if(d.Core.getUserId()===s){this.removeAllCurrentUserReactions(a);a.ownReactions.add(n)}if(!a.reactionCounters[n]){a.reactionCounters[n]=0}const o=a.reactionCounters[n];if(o+1<=U){if(!a.reactionUsers[n]){a.reactionUsers[n]=new Set}a.reactionUsers[n].add(s)}a.reactionCounters[n]++},removeReaction:(e,t)=>{var i;const{messageId:s,userId:n,reaction:a}=t;const o=e.collection[s];if(d.Core.getUserId()===n){o.ownReactions.delete(a)}(i=o.reactionUsers[a])==null?void 0:i.delete(n);o.reactionCounters[a]--;if(o.reactionCounters[a]===0){delete o.reactionCounters[a]}}}}removeAllCurrentUserReactions(e){e.ownReactions.forEach((t=>{var i;(i=e.reactionUsers[t])==null?void 0:i.delete(d.Core.getUserId());e.reactionCounters[t]--;if(e.reactionCounters[t]===0){delete e.reactionCounters[t]}}));e.ownReactions=new Set}prepareSetPayload(e){return e.map((e=>{var t;const i={};Object.entries(e.reactionUsers).forEach((([e,t])=>{i[e]=new Set(t)}));const s={};Object.entries(e.reactionCounters).forEach((([e,t])=>{s[e]=t}));const n={messageId:e.messageId,reactionCounters:s,reactionUsers:i};if(((t=e.ownReactions)==null?void 0:t.length)>0){n.ownReactions=new Set(e.ownReactions)}return n}))}}const j=[{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"lastUserIds",targetFieldName:"lastUserIds",checkFunction:l.Type.isArray},{fieldName:"messageCount",targetFieldName:"messageCount",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber}];const R=3;var H=babelHelpers.classPrivateFieldLooseKey("formatFields");class D extends c.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,H,{value:V})}getState(){return{collection:{}}}getElementState(){return{chatId:0,lastUserIds:[],messageCount:0,messageId:0}}getGetters(){return{getByMessageId:e=>t=>{var i;return(i=e.collection[t])!=null?i:this.getElementState()},getMessageIdByChatId:e=>t=>{const i=Object.values(e.collection);const s=i.find((e=>e.chatId===t));return s==null?void 0:s.messageId}}}getActions(){return{set:(e,t)=>{let i=t;if(!i){return}if(!Array.isArray(i)&&l.Type.isPlainObject(i)){i=[i]}i=i.map((t=>{const i=e.state.collection[t.messageId];if(i){return{...i,...babelHelpers.classPrivateFieldLooseBase(this,H)[H](t)}}return{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,H)[H](t)}}));e.commit("set",i)},setLastUser:(e,t)=>{const{messageId:i,newUserId:s}=t;const n=e.state.collection[i];if(!n||s===0){return}e.commit("setLastUser",t)}}}getMutations(){return{set:(e,t)=>{t.forEach((t=>{e.collection[t.messageId]=t}))},setLastUser:(e,t)=>{const{messageId:i,newUserId:s}=t;const{lastUserIds:n}=e.collection[i];if(n.includes(s)){return}if(n.length<R){n.unshift(s);return}n.pop();n.unshift(s)}}}}function V(e){return a.formatFieldsWithConfig(e,j)}var _=babelHelpers.classPrivateFieldLooseKey("formatFields");var W=babelHelpers.classPrivateFieldLooseKey("needToSwapAuthorId");var G=babelHelpers.classPrivateFieldLooseKey("prepareSwapAuthorId");var K=babelHelpers.classPrivateFieldLooseKey("getMaxMessageId");var X=babelHelpers.classPrivateFieldLooseKey("findLowestMessageId");var z=babelHelpers.classPrivateFieldLooseKey("findMaxMessageId");var Y=babelHelpers.classPrivateFieldLooseKey("findLastOwnMessageId");var $=babelHelpers.classPrivateFieldLooseKey("findFirstUnread");var q=babelHelpers.classPrivateFieldLooseKey("sortCollection");class J extends c.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,q,{value:oe});Object.defineProperty(this,$,{value:ae});Object.defineProperty(this,Y,{value:ne});Object.defineProperty(this,z,{value:se});Object.defineProperty(this,X,{value:ie});Object.defineProperty(this,K,{value:te});Object.defineProperty(this,G,{value:ee});Object.defineProperty(this,W,{value:Z});Object.defineProperty(this,_,{value:Q})}getName(){return"messages"}getNestedModules(){return{pin:x,reactions:O,comments:D}}getState(){return{collection:{},chatCollection:{}}}getElementState(){return{id:0,chatId:0,authorId:0,replyId:0,date:new Date,text:"",files:[],attach:[],keyboard:[],unread:false,viewed:true,viewedByOthers:false,sending:false,error:false,componentId:r.MessageComponent.default,componentParams:{},forward:{id:"",userId:0},isEdited:false,isDeleted:false}}getGetters(){return{getByChatId:e=>t=>{if(!e.chatCollection[t]){return[]}return[...e.chatCollection[t]].map((t=>e.collection[t])).sort(babelHelpers.classPrivateFieldLooseBase(this,q)[q])},getById:e=>t=>e.collection[t],getByIdList:e=>t=>{const i=[];t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}}));return i},hasMessage:e=>({chatId:t,messageId:i})=>{if(!e.chatCollection[t]){return false}return e.chatCollection[t].has(i)},isForward:e=>t=>{const i=e.collection[t];if(!i){return false}return l.Type.isStringFilled(i.forward.id)},isInChatCollection:e=>t=>{var i;const{messageId:s}=t;const n=e.collection[s];if(!n){return false}const{chatId:a}=n;return(i=e.chatCollection[a])==null?void 0:i.has(s)},getFirstId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,X)[X](e,t)},getLastId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,z)[z](e,t)},getLastOwnMessageId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e,t)},getFirstUnread:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,$)[$](e,t)},getChatUnreadMessages:e=>t=>{if(!e.chatCollection[t]){return[]}const i=[...e.chatCollection[t]].map((t=>e.collection[t]));return i.filter((e=>e.unread===true))},getMessageFiles:e=>t=>{const i=t;if(!e.collection[i]){return[]}return e.collection[i].files.map((e=>this.store.getters["files/get"](e,true)))},getMessageType:e=>t=>{const i=e.collection[t];if(!i){return null}const s=d.Core.getUserId();if(i.authorId===0){return r.MessageType.system}if(i.authorId===s){return r.MessageType.self}return r.MessageType.opponent},getPreviousMessage:e=>t=>{const{messageId:i,chatId:s}=t;const n=e.collection[i];if(!n){return null}const a=[...e.chatCollection[s]];const o=a.indexOf(i);const r=a[o-1];if(!r){return null}return e.collection[r]}}}getActions(){return{setChatCollection:(e,t)=>{var i,s;let{messages:n,clearCollection:a}=t;a=(i=a)!=null?i:false;if(!Array.isArray(n)&&l.Type.isPlainObject(n)){n=[n]}n=n.map((e=>({...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,_)[_](e)})));const o=(s=n[0])==null?void 0:s.chatId;if(o&&a){e.commit("clearCollection",{chatId:o})}e.commit("store",{messages:n});e.commit("setChatCollection",{messages:n})},store:(e,t)=>{let i=t;if(l.Type.isPlainObject(t)){i=[t]}i=i.map((t=>{const i=e.state.collection[t.id];if(i){return{...i,...babelHelpers.classPrivateFieldLooseBase(this,_)[_](t)}}return{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,_)[_](t)}}));if(i.length===0){return}e.commit("store",{messages:i})},add:(e,t)=>{const i={...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,_)[_](t)};e.commit("store",{messages:[i]});e.commit("setChatCollection",{messages:[i]});return i.id},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:babelHelpers.classPrivateFieldLooseBase(this,_)[_](s)})},update:(e,t)=>{const{id:i,fields:s}=t;const n=e.state.collection[i];if(!n){return}e.commit("update",{id:i,fields:{...n,...babelHelpers.classPrivateFieldLooseBase(this,_)[_](s)}})},readMessages:(e,t)=>{const{chatId:i,messageIds:s}=t;if(!e.state.chatCollection[i]){return 0}const n=[...e.state.chatCollection[i]].map((t=>e.state.collection[t]));let a=0;const o=babelHelpers.classPrivateFieldLooseBase(this,K)[K](s);const r=s;const l=[];n.forEach((e=>{if(!e.unread){return}if(e.id<=o){a++;l.push(e.id)}}));e.commit("readMessages",{messageIdsToRead:l,messageIdsToView:r});return a},setViewedByOthers:(e,t)=>{const{ids:i}=t;e.commit("setViewedByOthers",{ids:i})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}e.commit("delete",{id:i})},clearChatCollection:(e,t)=>{const{chatId:i}=t;e.commit("clearCollection",{chatId:i})},deleteAttach:(e,t)=>{const{messageId:i,attachId:s}=t;const n=e.state.collection[i];if(!n||!l.Type.isArray(n.attach)){return}const a=n.attach.filter((e=>s!==e.id));e.commit("update",{id:i,fields:{...n,...babelHelpers.classPrivateFieldLooseBase(this,_)[_]({attach:a})}})}}}getMutations(){return{setChatCollection:(e,t)=>{n.Logger.warn("Messages model: setChatCollection mutation",t);t.messages.forEach((t=>{if(!e.chatCollection[t.chatId]){e.chatCollection[t.chatId]=new Set}e.chatCollection[t.chatId].add(t.id)}))},store:(e,t)=>{n.Logger.warn("Messages model: store mutation",t);t.messages.forEach((t=>{e.collection[t.id]=t}))},updateWithId:(e,t)=>{n.Logger.warn("Messages model: updateWithId mutation",t);const{id:i,fields:s}=t;const a={...e.collection[i]};delete e.collection[i];e.collection[s.id]={...a,...s,sending:false};if(e.chatCollection[a.chatId].has(i)){e.chatCollection[a.chatId].delete(i);e.chatCollection[a.chatId].add(s.id)}},update:(e,t)=>{n.Logger.warn("Messages model: update mutation",t);const{id:i,fields:s}=t;e.collection[i]={...e.collection[i],...s}},delete:(e,t)=>{n.Logger.warn("Messages model: delete mutation",t);const{id:i}=t;const{chatId:s}=e.collection[i];e.chatCollection[s].delete(i);delete e.collection[i]},clearCollection:(e,t)=>{n.Logger.warn("Messages model: clear collection mutation",t.chatId);e.chatCollection[t.chatId]=new Set},readMessages:(e,t)=>{const{messageIdsToRead:i,messageIdsToView:s}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}i.unread=false}));s.forEach((t=>{const i=e.collection[t];if(!i){return}i.viewed=true}))},setViewedByOthers:(e,t)=>{const{ids:i}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}const s=i.authorId===d.Core.getUserId();if(!s||i.viewedByOthers){return}i.viewedByOthers=true}))}}}}function Q(e){const t=l.Type.isPlainObject(e.params)?e.params:{};const i={...e,...t};const s=a.formatFieldsWithConfig(i,E);if(babelHelpers.classPrivateFieldLooseBase(this,W)[W](s,t)){s.authorId=babelHelpers.classPrivateFieldLooseBase(this,G)[G](s,t)}return s}function Z(e,t){const{NAME:i,USER_ID:s}=t;return Boolean(i&&s&&e.authorId)}function ee(e,t){const{NAME:s,USER_ID:n,AVATAR:a}=t;const o=e.authorId;const l=g(n);const c=new i.UserManager;const d=`${r.UserIdNetworkPrefix}-${o}-${l}`;c.setUsersToModel({networkId:d,name:s,avatar:a!=null?a:""});return d}function te(e){let t=0;e.forEach((e=>{if(t<e){t=e}}));return t}function ie(e,t){let i=null;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(!i){i=s.id}if(o.Utils.text.isTempMessage(s.id)){continue}if(s.id<i){i=s.id}}return i}function se(e,t){let i=0;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(o.Utils.text.isTempMessage(s.id)){continue}if(s.id>i){i=s.id}}return i}function ne(e,t){let i=0;const s=[...e.chatCollection[t]].sort(((e,t)=>t-e));for(const t of s){const s=e.collection[t];if(o.Utils.text.isTempMessage(s.id)){continue}if(s.authorId===d.Core.getUserId()){i=s.id;break}}return i}function ae(e,t){let i=0;for(const s of e.chatCollection[t]){const t=e.collection[s];if(t.unread){i=s;break}}return i}function oe(e,t){if(o.Utils.text.isUuidV4(e.id)&&!o.Utils.text.isUuidV4(t.id)){return 1}if(!o.Utils.text.isUuidV4(e.id)&&o.Utils.text.isUuidV4(t.id)){return-1}if(o.Utils.text.isUuidV4(e.id)&&o.Utils.text.isUuidV4(t.id)){return e.date.getTime()-t.date.getTime()}return e.id-t.id}const re=e=>{const t=[];e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}));return t};const le=e=>l.Text.decode(e.toString());const ce=e=>{let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=d.Core.getHost()+e}if(t){t=encodeURI(t)}return t};const de=e=>{const t=[];e.forEach((e=>{const i={};if(!e.userId){return}i.userId=Number.parseInt(e.userId,10);i.userName=l.Text.decode(e.userName);t.push(i)}));return t};const ue=e=>{const t=[];if(l.Type.isArray(e)){e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}))}else if(l.Type.isPlainObject(e)){Object.entries(e).forEach((([e,i])=>{if(!i){return}const s=Number.parseInt(e,10);if(s>0){t.push(s)}}))}return t};const me=e=>{const{countOfViewers:t,firstViewers:i,messageId:s}=e;let n=null;for(const e of i){if(e.userId===d.Core.getUserId()){continue}n={userId:e.userId,userName:e.userName,date:o.Utils.date.cast(e.date)};break}if(t>0&&!n){throw new Error("Chats model: no first viewer for message")}return{countOfViewers:t,firstViewer:n,messageId:s}};const ge=[{fieldName:"dialogId",targetFieldName:"dialogId",checkFunction:u,formatFunction:m},{fieldName:["id","chatId"],targetFieldName:"chatId",checkFunction:u,formatFunction:g},{fieldName:"type",targetFieldName:"type",checkFunction:l.Type.isString},{fieldName:"quoteId",targetFieldName:"quoteId",checkFunction:l.Type.isNumber},{fieldName:"counter",targetFieldName:"counter",checkFunction:u,formatFunction:g},{fieldName:"userCounter",targetFieldName:"userCounter",checkFunction:u,formatFunction:g},{fieldName:"lastId",targetFieldName:"lastReadId",checkFunction:l.Type.isNumber},{fieldName:"markedId",targetFieldName:"markedId",checkFunction:l.Type.isNumber},{fieldName:"lastMessageId",targetFieldName:"lastMessageId",checkFunction:u,formatFunction:g},{fieldName:"lastMessageViews",targetFieldName:"lastMessageViews",checkFunction:l.Type.isPlainObject,formatFunction:me},{fieldName:"hasPrevPage",targetFieldName:"hasPrevPage",checkFunction:l.Type.isBoolean},{fieldName:"hasNextPage",targetFieldName:"hasNextPage",checkFunction:l.Type.isBoolean},{fieldName:"savedPositionMessageId",targetFieldName:"savedPositionMessageId",checkFunction:l.Type.isNumber},{fieldName:["title","name"],targetFieldName:"name",checkFunction:u,formatFunction:le},{fieldName:["owner","ownerId"],targetFieldName:"ownerId",checkFunction:u,formatFunction:g},{fieldName:"avatar",targetFieldName:"avatar",checkFunction:l.Type.isString,formatFunction:ce},{fieldName:"color",targetFieldName:"color",checkFunction:l.Type.isString},{fieldName:"extranet",targetFieldName:"extranet",checkFunction:l.Type.isBoolean},{fieldName:"entityLink",targetFieldName:"entityLink",checkFunction:l.Type.isPlainObject,formatFunction:e=>a.formatFieldsWithConfig(e,fe)},{fieldName:"dateCreate",targetFieldName:"dateCreate",formatFunction:o.Utils.date.cast},{fieldName:"public",targetFieldName:"public",checkFunction:l.Type.isPlainObject},{fieldName:"writingList",targetFieldName:"writingList",checkFunction:l.Type.isArray,formatFunction:de},{fieldName:"managerList",targetFieldName:"managerList",checkFunction:l.Type.isArray,formatFunction:re},{fieldName:"muteList",targetFieldName:"muteList",checkFunction:[l.Type.isArray,l.Type.isPlainObject],formatFunction:ue},{fieldName:"inited",targetFieldName:"inited",checkFunction:l.Type.isBoolean},{fieldName:"loading",targetFieldName:"loading",checkFunction:l.Type.isBoolean},{fieldName:"description",targetFieldName:"description",checkFunction:l.Type.isString},{fieldName:"diskFolderId",targetFieldName:"diskFolderId",checkFunction:l.Type.isNumber},{fieldName:"role",targetFieldName:"role",checkFunction:l.Type.isString,formatFunction:e=>e.toLowerCase()},{fieldName:"permissions",targetFieldName:"permissions",checkFunction:l.Type.isPlainObject},{fieldName:"parentChatId",targetFieldName:"parentChatId",checkFunction:l.Type.isNumber}];const fe=[{fieldName:"type",targetFieldName:"type",checkFunction:l.Type.isString},{fieldName:"url",targetFieldName:"url",checkFunction:l.Type.isString}];class he extends c.BuilderModel{getName(){return"chats"}getState(){return{collection:{}}}getElementState(){return{dialogId:"0",chatId:0,type:r.ChatType.chat,name:"",description:"",avatar:"",color:r.Color.base,extranet:false,counter:0,userCounter:0,lastReadId:0,markedId:0,lastMessageId:0,lastMessageViews:{countOfViewers:0,firstViewer:null,messageId:0},savedPositionMessageId:0,managerList:[],writingList:[],muteList:[],quoteId:0,ownerId:0,entityLink:{},dateCreate:null,public:{code:"",link:""},inited:false,loading:false,hasPrevPage:false,hasNextPage:false,diskFolderId:0,role:r.UserRole.guest,permissions:{manageUi:r.UserRole.none,manageSettings:r.UserRole.none,manageUsersAdd:r.UserRole.none,manageUsersDelete:r.UserRole.none,manageMessages:r.UserRole.none},parentChatId:0}}getGetters(){return{get:e=>(t,i=false)=>{if(!e.collection[t]&&i){return this.getElementState()}if(!e.collection[t]&&!i){return null}return e.collection[t]},getByChatId:e=>t=>{const i=Number.parseInt(t,10);return Object.values(e.collection).find((e=>e.chatId===i))},getQuoteId:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].quoteId},isUser:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].type===r.ChatType.user},getLastReadId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i}=e.collection[t];const s=d.Core.getStore().getters["messages/getById"](i);if(!s){return 0}return i},getInitialMessageId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i,markedId:s}=e.collection[t];if(s===0){return i}return Math.min(i,s)}}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&l.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(i){e.commit("update",{dialogId:t.dialogId,fields:t})}else{e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{let i=t;if(!Array.isArray(i)&&l.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(!i){e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("update",{dialogId:t.dialogId,fields:this.formatFields(t.fields)})},delete:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("delete",{dialogId:t.dialogId})},clearCounters:e=>{e.commit("clearCounters")},mute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=d.Core.getUserId();if(i.muteList.includes(s)){return}const n=[...i.muteList,s];e.commit("update",{actionName:"mute",dialogId:t.dialogId,fields:this.formatFields({muteList:n})})},unmute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=d.Core.getUserId();const n=i.muteList.filter((e=>e!==s));e.commit("update",{actionName:"unmute",dialogId:t.dialogId,fields:this.formatFields({muteList:n})})},setLastMessageViews:(e,t)=>{const{dialogId:i,fields:{userId:s,userName:n,date:a,messageId:r}}=t;const l=e.state.collection[i];if(!l){return}const c={countOfViewers:1,messageId:r,firstViewer:{userId:s,userName:n,date:o.Utils.date.cast(a)}};e.commit("update",{actionName:"setLastMessageViews",dialogId:i,fields:{lastMessageViews:c}})},clearLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const{lastMessageViews:s}=this.getElementState();e.commit("update",{actionName:"clearLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:s}})},incrementLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=i.lastMessageViews.countOfViewers+1;e.commit("update",{actionName:"incrementLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:{...i.lastMessageViews,countOfViewers:s}}})}}}getMutations(){return{add:(e,t)=>{e.collection[t.dialogId]=t.fields},update:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},delete:(e,t)=>{delete e.collection[t.dialogId]},clearCounters:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].counter=0;e.collection[t].markedId=0}))}}}formatFields(e){return a.formatFieldsWithConfig(e,ge)}}class pe extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{code:"",type:r.BotType.bot,appId:"",isHidden:false,isSupportOpenline:false,isHuman:false}}getGetters(){return{getByUserId:e=>t=>e.collection[t],isNetwork:e=>t=>{var i;return((i=e.collection[t])==null?void 0:i.type)===r.BotType.network},isSupport:e=>t=>{var i;return((i=e.collection[t])==null?void 0:i.type)===r.BotType.support24},getCopilotUserId:e=>{for(const[t,i]of Object.entries(e.collection)){if(i.code===r.BotCode.copilot){return Number.parseInt(t,10)}}return null}}}getActions(){return{set:(e,t)=>{const{userId:i,botData:s}=t;if(!s){return}e.commit("set",{userId:i,botData:{...this.getElementState(),...this.formatFields(s)}})}}}getMutations(){return{set:(e,t)=>{const{userId:i,botData:s}=t;e.collection[i]=s}}}formatFields(e){const t=p(e);if(t.type===r.RawBotType.human){t.type=r.BotType.bot;t.isHuman=true}const i=[r.RawBotType.openline,r.RawBotType.supervisor];if(i.includes(t.type)){t.type=r.BotType.bot}return t}}const ye=e=>{let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=d.Core.getHost()+e}if(t){t=encodeURI(t)}return t};const Ne=e=>{const t=[];e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}));return t};const Ie=e=>{const t={};if(l.Type.isStringFilled(e.workPhone)||l.Type.isNumber(e.workPhone)){t.workPhone=e.workPhone.toString()}if(l.Type.isStringFilled(e.personalMobile)||l.Type.isNumber(e.personalMobile)){t.personalMobile=e.personalMobile.toString()}if(l.Type.isStringFilled(e.personalPhone)||l.Type.isNumber(e.personalPhone)){t.personalPhone=e.personalPhone.toString()}if(l.Type.isStringFilled(e.innerPhone)||l.Type.isNumber(e.innerPhone)){t.innerPhone=e.innerPhone.toString()}return t};const Fe=[{fieldName:"id",targetFieldName:"id",checkFunction:u,formatFunction:g},{fieldName:"networkId",targetFieldName:"id",checkFunction:o.Utils.user.isNetworkUserId},{fieldName:"firstName",targetFieldName:"firstName",checkFunction:l.Type.isString,formatFunction:l.Text.decode},{fieldName:"lastName",targetFieldName:"lastName",checkFunction:l.Type.isString,formatFunction:l.Text.decode},{fieldName:"name",targetFieldName:"name",checkFunction:l.Type.isString,formatFunction:l.Text.decode},{fieldName:"color",targetFieldName:"color",checkFunction:l.Type.isString},{fieldName:"avatar",targetFieldName:"avatar",checkFunction:l.Type.isString,formatFunction:ye},{fieldName:"workPosition",targetFieldName:"workPosition",checkFunction:l.Type.isString,formatFunction:l.Text.decode},{fieldName:"gender",targetFieldName:"gender",checkFunction:l.Type.isString},{fieldName:"birthday",targetFieldName:"birthday",checkFunction:l.Type.isString},{fieldName:"isBirthday",targetFieldName:"isBirthday",checkFunction:l.Type.isBoolean},{fieldName:"isAdmin",targetFieldName:"isAdmin",checkFunction:l.Type.isBoolean},{fieldName:"extranet",targetFieldName:"extranet",checkFunction:l.Type.isBoolean},{fieldName:"network",targetFieldName:"network",checkFunction:l.Type.isBoolean},{fieldName:"bot",targetFieldName:"bot",checkFunction:l.Type.isBoolean},{fieldName:"connector",targetFieldName:"connector",checkFunction:l.Type.isBoolean},{fieldName:"externalAuthId",targetFieldName:"externalAuthId",checkFunction:l.Type.isString},{fieldName:"status",targetFieldName:"status",checkFunction:l.Type.isString},{fieldName:"idle",targetFieldName:"idle",formatFunction:f},{fieldName:"lastActivityDate",targetFieldName:"lastActivityDate",formatFunction:f},{fieldName:"mobileLastDate",targetFieldName:"mobileLastDate",formatFunction:f},{fieldName:"absent",targetFieldName:"absent",formatFunction:f},{fieldName:"isAbsent",targetFieldName:"isAbsent",checkFunction:l.Type.isBoolean},{fieldName:"departments",targetFieldName:"departments",checkFunction:l.Type.isArray,formatFunction:Ne},{fieldName:"phones",targetFieldName:"phones",checkFunction:l.Type.isPlainObject,formatFunction:Ie}];class be extends c.BuilderModel{getName(){return"users"}getNestedModules(){return{bots:pe}}getState(){return{collection:{},absentList:[],absentCheckInterval:null}}getElementState(e={}){const{id:t=0}=e;return{id:t,name:"",firstName:"",lastName:"",avatar:"",color:r.Color.base,workPosition:"",gender:"M",isAdmin:false,extranet:false,network:false,bot:false,connector:false,externalAuthId:"default",status:"",idle:false,lastActivityDate:false,mobileLastDate:false,birthday:false,isBirthday:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""}}}getGetters(){return{get:e=>(t,i=false)=>{const s=e.collection[t];if(!i&&!s){return null}if(i&&!s){return this.getElementState({id:t})}return s},getBlank:()=>e=>this.getElementState(e),getList:e=>t=>{const i=[];if(!Array.isArray(t)){return null}t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}else{i.push(this.getElementState({id:t}))}}));return i},hasBirthday:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return false}return s.isBirthday},hasVacation:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return false}return s.isAbsent},getLastOnline:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return""}return o.Utils.user.getLastDateText(s)},getPosition:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return""}if(s.workPosition){return s.workPosition}if(s.bot===true){return l.Loc.getMessage("IM_MODEL_USERS_CHAT_BOT")}return l.Loc.getMessage("IM_MODEL_USERS_DEFAULT_NAME")}}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&l.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.id];if(i){e.commit("update",{id:t.id,fields:t})}else{e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{let i=t;if(!Array.isArray(i)&&l.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.id];if(!i){e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{const i=t;i.id=Number.parseInt(i.id,10);const s=e.state.collection[i.id];if(!s){return}const n={...i.fields,id:i.id};e.commit("update",{id:i.id,fields:this.formatFields(n)})},delete:(e,t)=>{e.commit("delete",t.id)},setStatus:(e,t)=>{e.commit("update",{id:d.Core.getUserId(),fields:this.formatFields(t)})}}}getMutations(){return{add:(e,t)=>{e.collection[t.id]=t.fields;s.UserStatusManager.getInstance().onUserUpdate(t.fields)},update:(e,t)=>{e.collection[t.id]={...e.collection[t.id],...t.fields};s.UserStatusManager.getInstance().onUserUpdate(t.fields)},delete:(e,t)=>{delete e.collection[t.id]}}}formatFields(e){const t=a.formatFieldsWithConfig(e,Fe);const i=t.bot===true;if(i){d.Core.getStore().dispatch("users/bots/set",{userId:t.id,botData:e.botData||e.bot_data})}return t}addToAbsentList(e){const t=this.store.state.users;if(!t.absentList.includes(e)){t.absentList.push(e)}}startAbsentCheckInterval(){const e=this.store.state.users;if(e.absentCheckInterval){return}const t=1e3*60*60*24;e.absentCheckInterval=setTimeout((()=>{setInterval((()=>{e.absentList.forEach((t=>{const i=e.collection[t];if(!i){return}const s=Date.now();const n=new Date(i.absent).getTime();if(n<=s){e.absentList=e.absentList.filter((e=>e!==t));i.isAbsent=false}}))}),t)}),o.Utils.date.getTimeToNextMidnight())}}class Te extends c.BuilderModel{getName(){return"files"}getState(){return{collection:{}}}getElementState(){return{id:0,chatId:0,name:"File is deleted",date:new Date,type:"file",extension:"",icon:"empty",size:0,image:false,status:r.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",viewerAttrs:null}}getGetters(){return{get:e=>(t,i=false)=>{if(!t){return null}if(!i&&!e.collection[t]){return null}return e.collection[t]},isInCollection:e=>t=>{const{fileId:i}=t;return!!e.collection[i]}}}getActions(){return{add:(e,t)=>{const i={...this.getElementState(),...this.validate(t)};e.commit("add",{files:[i]})},set:(e,t)=>{if(!Array.isArray(t)&&l.Type.isPlainObject(t)){t=[t]}t=t.map((e=>({...this.getElementState(),...this.validate(e)})));e.commit("add",{files:t})},update:(e,t)=>{const{id:i,fields:s}=t;const n=e.state.collection[i];if(!n){return false}e.commit("update",{id:i,fields:this.validate(s)});return true},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:this.validate(s)})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}e.commit("delete",{id:i})}}}getMutations(){return{add:(e,t)=>{t.files.forEach((t=>{e.collection[t.id]=t}))},update:(e,t)=>{Object.entries(t.fields).forEach((([i,s])=>{e.collection[t.id][i]=s}))},updateWithId:(e,t)=>{const{id:i,fields:s}=t;const n={...e.collection[i]};delete e.collection[i];e.collection[s.id]={...n,...s}},delete:(e,t)=>{n.Logger.warn("Files model: delete mutation",t);const{id:i}=t;delete e.collection[i]}}}validate(e){const t={};if(l.Type.isNumber(e.id)||l.Type.isStringFilled(e.id)){t.id=e.id}if(l.Type.isNumber(e.chatId)||l.Type.isString(e.chatId)){t.chatId=Number.parseInt(e.chatId,10)}if(!l.Type.isUndefined(e.date)){t.date=o.Utils.date.cast(e.date)}if(l.Type.isString(e.type)){t.type=e.type}if(l.Type.isString(e.extension)){t.extension=e.extension.toString();if(t.type==="image"){t.icon="img"}else if(t.type==="video"){t.icon="mov"}else{t.icon=o.Utils.file.getIconTypeByExtension(t.extension)}}if(l.Type.isString(e.name)||l.Type.isNumber(e.name)){t.name=e.name.toString()}if(l.Type.isNumber(e.size)||l.Type.isString(e.size)){t.size=Number.parseInt(e.size,10)}if(l.Type.isBoolean(e.image)){t.image=false}else if(l.Type.isPlainObject(e.image)){t.image={width:0,height:0};if(l.Type.isString(e.image.width)||l.Type.isNumber(e.image.width)){t.image.width=Number.parseInt(e.image.width,10)}if(l.Type.isString(e.image.height)||l.Type.isNumber(e.image.height)){t.image.height=Number.parseInt(e.image.height,10)}if(t.image.width<=0||t.image.height<=0){t.image=false}}if(l.Type.isString(e.status)&&!l.Type.isUndefined(r.FileStatus[e.status])){t.status=e.status}if(l.Type.isNumber(e.progress)||l.Type.isString(e.progress)){t.progress=Number.parseInt(e.progress,10)}if(l.Type.isNumber(e.authorId)||l.Type.isString(e.authorId)){t.authorId=Number.parseInt(e.authorId,10)}if(l.Type.isString(e.authorName)||l.Type.isNumber(e.authorName)){t.authorName=e.authorName.toString()}if(l.Type.isString(e.urlPreview)){if(!e.urlPreview||e.urlPreview.startsWith("http")||e.urlPreview.startsWith("bx")||e.urlPreview.startsWith("file")||e.urlPreview.startsWith("blob")){t.urlPreview=e.urlPreview}else{t.urlPreview=d.Core.getHost()+e.urlPreview}}if(l.Type.isString(e.urlDownload)){if(!e.urlDownload||e.urlDownload.startsWith("http")||e.urlDownload.startsWith("bx")||e.urlPreview.startsWith("file")){t.urlDownload=e.urlDownload}else{t.urlDownload=d.Core.getHost()+e.urlDownload}}if(l.Type.isString(e.urlShow)){if(!e.urlShow||e.urlShow.startsWith("http")||e.urlShow.startsWith("bx")||e.urlShow.startsWith("file")||e.urlShow.startsWith("blob")){t.urlShow=e.urlShow}else{t.urlShow=d.Core.getHost()+e.urlShow}}if(l.Type.isPlainObject(e.viewerAttrs)){t.viewerAttrs=this.validateViewerAttributes(e.viewerAttrs)}return t}validateViewerAttributes(e){const t={viewer:true};if(l.Type.isString(e.actions)){t.actions=e.actions}if(l.Type.isString(e.objectId)){t.objectId=e.objectId}if(l.Type.isString(e.src)){t.src=e.src}if(l.Type.isString(e.title)){t.title=e.title}if(l.Type.isString(e.viewerGroupBy)){t.viewerGroupBy=e.viewerGroupBy}if(l.Type.isString(e.viewerType)){t.viewerType=e.viewerType}if(l.Type.isString(e.viewerTypeClass)){t.viewerTypeClass=e.viewerTypeClass}if(l.Type.isBoolean(e.viewerSeparateItem)){t.viewerSeparateItem=e.viewerSeparateItem}if(l.Type.isString(e.viewerExtension)){t.viewerExtension=e.viewerExtension}if(l.Type.isNumber(e.imChatId)){t.imChatId=e.imChatId}return t}}const Ce=e=>{if(!e.text||e.text===""){return{text:"",date:null}}return{text:e.text,date:new Date}};const Se=e=>{if(l.Type.isPlainObject(e)){return{isActive:true,originator:e.originatorId,canResend:e.canResend}}return{isActive:false,originator:0,canResend:false}};const ve=[{fieldName:["id","dialogId"],targetFieldName:"dialogId",checkFunction:u,formatFunction:m},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:u},{fieldName:"draft",targetFieldName:"draft",checkFunction:l.Type.isPlainObject,formatFunction:Ce},{fieldName:"invited",targetFieldName:"invitation",checkFunction:[l.Type.isPlainObject,l.Type.isBoolean],formatFunction:Se},{fieldName:"unread",targetFieldName:"unread",checkFunction:l.Type.isBoolean},{fieldName:"pinned",targetFieldName:"pinned",checkFunction:l.Type.isBoolean},{fieldName:"liked",targetFieldName:"liked",checkFunction:l.Type.isBoolean},{fieldName:["defaultUserRecord","isFakeElement"],targetFieldName:"isFakeElement",checkFunction:l.Type.isBoolean},{fieldName:"isBirthdayPlaceholder",targetFieldName:"isBirthdayPlaceholder",checkFunction:l.Type.isBoolean},{fieldName:["dateLastActivity","lastActivityDate"],targetFieldName:"lastActivityDate",checkFunction:[l.Type.isString,l.Type.isDate],formatFunction:o.Utils.date.cast}];class Pe extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{dialogId:0,name:"",call:{},state:r.RecentCallStatus.waiting}}getGetters(){return{get:e=>Object.values(e.collection),getCallByDialog:e=>t=>e.collection[t],hasActiveCall:e=>t=>{if(l.Type.isUndefined(t)){const t=Object.values(e.collection).find((e=>e.state===r.RecentCallStatus.joined));return Boolean(t)}const i=Object.values(e.collection).find((e=>e.dialogId===t));if(!i){return false}return i.state===r.RecentCallStatus.joined}}}getActions(){return{addActiveCall:(e,t)=>{const i=Object.values(e.state.collection).find((e=>e.dialogId===t.dialogId||e.call.id===t.call.id));if(i){e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t)});return true}e.commit("addActiveCall",this.prepareActiveCall(t))},updateActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t.fields)})},deleteActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("deleteActiveCall",{dialogId:i.dialogId})}}}getMutations(){return{addActiveCall:(e,t)=>{e.collection[t.dialogId]=t},updateActiveCall:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},deleteActiveCall:(e,t)=>{delete e.collection[t.dialogId]}}}prepareActiveCall(e){return{...this.getElementState(),...this.validateActiveCall(e)}}validateActiveCall(e){const t={};if(l.Type.isStringFilled(e.dialogId)||l.Type.isNumber(e.dialogId)){t.dialogId=e.dialogId}if(l.Type.isStringFilled(e.name)){t.name=e.name}if(l.Type.isObjectLike(e.call)){var i,s;t.call=e.call;if(((i=e.call)==null?void 0:(s=i.associatedEntity)==null?void 0:s.avatar)==="/bitrix/js/im/images/blank.gif"){t.call.associatedEntity.avatar=""}}if(r.RecentCallStatus[e.state]){t.state=e.state}return t}}var ke=babelHelpers.classPrivateFieldLooseKey("formatFields");var we=babelHelpers.classPrivateFieldLooseKey("updateUnloadedRecentCounters");var Me=babelHelpers.classPrivateFieldLooseKey("updateUnloadedCopilotCounters");var Le=babelHelpers.classPrivateFieldLooseKey("updateUnloadedCounters");var Be=babelHelpers.classPrivateFieldLooseKey("getMessage");var Ee=babelHelpers.classPrivateFieldLooseKey("getDialog");var xe=babelHelpers.classPrivateFieldLooseKey("hasTodayMessage");var Ae=babelHelpers.classPrivateFieldLooseKey("isChannel");var Ue=babelHelpers.classPrivateFieldLooseKey("canDelete");class Oe extends c.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Ue,{value:Ke});Object.defineProperty(this,Ae,{value:Ge});Object.defineProperty(this,xe,{value:We});Object.defineProperty(this,Ee,{value:_e});Object.defineProperty(this,Be,{value:Ve});Object.defineProperty(this,Le,{value:De});Object.defineProperty(this,Me,{value:He});Object.defineProperty(this,we,{value:Re});Object.defineProperty(this,ke,{value:je})}getName(){return"recent"}getNestedModules(){return{calls:Pe}}getState(){return{collection:{},recentCollection:new Set,unreadCollection:new Set,copilotCollection:new Set,channelCollection:new Set}}getElementState(){return{dialogId:"0",messageId:0,draft:{text:"",date:null},unread:false,pinned:false,liked:false,invitation:{isActive:false,originator:0,canResend:false},isFakeElement:false,isBirthdayPlaceholder:false,lastActivityDate:null}}getGetters(){return{getRecentCollection:e=>[...e.recentCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getUnreadCollection:e=>[...e.unreadCollection].map((t=>e.collection[t])),getCopilotCollection:e=>[...e.copilotCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getChannelCollection:e=>[...e.channelCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getSortedCollection:e=>{const t=[...e.recentCollection].map((t=>e.collection[t]));const i=t.filter((e=>!e.isBirthdayPlaceholder&&!e.isFakeElement&&e.messageId));return[...i].sort(((e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](e.messageId);const s=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](t.messageId);return s.date-i.date}))},get:e=>t=>{if(!e.collection[t]){return null}return e.collection[t]},getMessage:e=>t=>{const i=e.collection[t];if(!i){return null}return babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i.messageId)},needsBirthdayPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=this.store.getters["chats/get"](t);if(!s||s.type!==r.ChatType.user){return false}const n=this.store.getters["users/hasBirthday"](t);if(!n){return false}const a=this.store.getters["application/settings/get"](r.Settings.recent.showBirthday);const o=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](i.messageId);return a&&!o&&s.counter===0},needsVacationPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=this.store.getters["chats/get"](t);if(!s||s.type!==r.ChatType.user){return false}const n=this.store.getters["users/hasVacation"](t);if(!n){return false}const a=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](i.messageId);return!a&&s.counter===0},getSortDate:e=>t=>{const i=e.collection[t];if(!i){return null}const s=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](i.messageId);if(l.Type.isDate(i.draft.date)&&i.draft.date>s.date){return i.draft.date}const n=this.store.getters["recent/needsBirthdayPlaceholder"](i.dialogId);if(n){return o.Utils.date.getStartOfTheDay()}const a=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](i.dialogId);const r=i.lastActivityDate;const c=l.Type.isDate(r)&&r>s.date;if(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](a)&&c){return r}return s.date}}}getActions(){return{setRecent:async(e,t)=>{const i=await d.Core.getStore().dispatch("recent/store",t);e.commit("setRecentCollection",i);babelHelpers.classPrivateFieldLooseBase(this,we)[we](t)},setUnread:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setUnreadCollection",i)},setCopilot:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setCopilotCollection",i);babelHelpers.classPrivateFieldLooseBase(this,Me)[Me](t)},setChannel:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setChannelCollection",i)},store:(e,t)=>{if(!Array.isArray(t)&&l.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];t.map((e=>babelHelpers.classPrivateFieldLooseBase(this,ke)[ke](e))).forEach((t=>{const n={...t};const a=e.state.collection[t.dialogId];if(a){i.push({dialogId:a.dialogId,fields:n})}else{s.push({...this.getElementState(),...n})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}return[...s,...i].map((e=>e.dialogId))},update:(e,t)=>{const{id:i,fields:s}=t;const n=e.state.collection[i];if(!n){return}e.commit("update",{dialogId:n.dialogId,fields:babelHelpers.classPrivateFieldLooseBase(this,ke)[ke](s)})},unread:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{unread:t.action}})},pin:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{pinned:t.action}})},like:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}const s=i.messageId===Number.parseInt(t.messageId,10);const n=!l.Type.isUndefined(t.messageId)&&t.liked===true;if(n&&!s){return}e.commit("update",{dialogId:i.dialogId,fields:{liked:t.liked===true}})},setRecentDraft:(e,t)=>{d.Core.getStore().dispatch("recent/setDraft",{id:t.id,text:t.text,collectionName:"recentCollection",addMethodName:"setRecentCollection"})},setCopilotDraft:(e,t)=>{d.Core.getStore().dispatch("recent/setDraft",{id:t.id,text:t.text,collectionName:"copilotCollection",addMethodName:"setCopilotCollection"})},setDraft:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}const s=e.state[t.collectionName].has(t.id);if(!s){if(t.text===""){return}e.commit(t.addMethodName,[t.id.toString()])}const n=babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]({draft:{text:t.text.toString()}});if(n.draft.text===i.draft.text){return}e.commit("update",{dialogId:i.dialogId,fields:n})},delete:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("deleteFromRecentCollection",i.dialogId);e.commit("deleteFromCopilotCollection",i.dialogId);const s=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue](i.dialogId);if(!s){return}e.commit("delete",{id:i.dialogId})},clearUnread:e=>{e.commit("clearUnread")}}}getMutations(){return{setRecentCollection:(e,t)=>{t.forEach((t=>{e.recentCollection.add(t)}))},deleteFromRecentCollection:(e,t)=>{e.recentCollection.delete(t)},setUnreadCollection:(e,t)=>{t.forEach((t=>{e.unreadCollection.add(t)}))},setCopilotCollection:(e,t)=>{t.forEach((t=>{e.copilotCollection.add(t)}))},deleteFromCopilotCollection:(e,t)=>{e.copilotCollection.delete(t)},setChannelCollection:(e,t)=>{t.forEach((t=>{e.channelCollection.add(t)}))},add:(e,t)=>{if(!Array.isArray(t)&&l.Type.isPlainObject(t)){t=[t]}t.forEach((t=>{e.collection[t.dialogId]=t}))},update:(e,t)=>{if(!Array.isArray(t)&&l.Type.isPlainObject(t)){t=[t]}t.forEach((({dialogId:t,fields:i})=>{const s=e.recentCollection.has(t);const n=i.isFakeElement&&o.Utils.text.isTempMessage(i.messageId);if(s&&n&&!i.invitation){return}const a=e.collection[t];e.collection[t]={...a,...i}}))},delete:(e,t)=>{delete e.collection[t.id]},clearUnread:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].unread=false}))}}}}function je(e){const t=l.Type.isPlainObject(e.options)?e.options:{};const i={...e,...t};return a.formatFieldsWithConfig(i,ve)}function Re(e){babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](e,"counters/setUnloadedChatCounters")}function He(e){babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](e,"counters/setUnloadedCopilotCounters")}function De(e,t){if(!Array.isArray(e)&&l.Type.isPlainObject(e)){e=[e]}const i={};e.forEach((e=>{i[e.chat_id]=0}));void d.Core.getStore().dispatch(t,i)}function Ve(e){return d.Core.getStore().getters["messages/getById"](e)}function _e(e){return d.Core.getStore().getters["chats/get"](e)}function We(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be](e);const i=o.Utils.text.isUuidV4(t.id)||t.id>0;return i&&o.Utils.date.isToday(t.date)}function Ge(e){return[r.ChatType.channel,r.ChatType.openChannel].includes(e.type)}function Ke(e){const t=[r.ChatType.openChannel];const{type:i}=babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](e);return!t.includes(i)}class Xe extends c.BuilderModel{getName(){return"notifications"}getState(){return{collection:new Map,searchCollection:new Map,unreadCounter:0}}getElementState(){return{id:0,authorId:0,date:new Date,title:"",text:"",params:{},replaces:[],notifyButtons:[],sectionCode:r.NotificationTypesCodes.simple,read:false,settingName:"im|default"}}getGetters(){return{getSortedCollection:e=>[...e.collection.values()].sort(this.sortByType),getSearchResultCollection:e=>[...e.searchCollection.values()].sort(this.sortByType),getConfirmsCount:e=>[...e.collection.values()].filter((e=>e.sectionCode===r.NotificationTypesCodes.confirm)).length,getById:e=>t=>{if(l.Type.isString(t)){t=Number.parseInt(t,10)}const i=e.collection.get(t);if(!i){return false}return i},getCounter:e=>e.unreadCounter}}getActions(){return{initialSet:(e,t)=>{if(l.Type.isNumber(t.total_unread_count)){e.commit("setCounter",t.total_unread_count)}if(!l.Type.isArrayFilled(t.notifications)){return}const i=[];const s=[];const n=d.Core.getUserId();t.notifications.map((e=>Xe.validate(e,n))).forEach((t=>{const n=e.state.collection.get(t.id);if(n){i.push({id:n.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}},set:(e,t)=>{if(!Array.isArray(t)&&l.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];const n=d.Core.getUserId();t.map((e=>Xe.validate(e,n))).forEach((t=>{const n=e.state.collection.get(t.id);if(n){i.push({id:n.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s);s.forEach((()=>{e.commit("increaseCounter")}))}if(i.length>0){e.commit("update",i)}},setSearchResult:(e,t)=>{const i=[];const s=[];let{notifications:n}=t;const a=!!t.skipValidation;if(!a){const e=d.Core.getUserId();n=n.map((t=>Xe.validate(t,e)))}n.forEach((t=>{const n=e.state.searchCollection.get(t.id);if(n){i.push({id:n.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("addSearchResult",s)}if(i.length>0){e.commit("updateSearchResult",i)}},read:(e,t)=>{t.ids.forEach((i=>{const s=e.state.collection.get(i);if(!s||s.read===t.read){return false}if(t.read){e.commit("decreaseCounter")}else{e.commit("increaseCounter")}e.commit("read",{id:s.id,read:t.read})}))},readAll:e=>{e.commit("readAll");e.commit("setCounter",0)},delete:(e,t)=>{const i=e.state.collection.get(t.id);if(!i){return}if(i.read===false){e.commit("decreaseCounter")}e.commit("delete",{id:i.id})},deleteFromSearch:(e,t)=>{const i=e.state.searchCollection.get(t.id);if(!i){return}e.commit("delete",{id:i.id})},clearSearchResult:e=>{e.commit("clearSearchResult")},setCounter:(e,t)=>{e.commit("setCounter",t)}}}getMutations(){return{add:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,t)}))},addSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,t)}))},update:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,{...e.collection.get(t.id),...t.fields})}))},updateSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,{...e.searchCollection.get(t.id),...t.fields})}))},delete:(e,t)=>{e.collection.delete(t.id);e.searchCollection.delete(t.id)},read:(e,t)=>{e.collection.set(t.id,{...e.collection.get(t.id),read:t.read});e.searchCollection.set(t.id,{...e.collection.get(t.id),read:t.read})},readAll:e=>{[...e.collection.values()].forEach((e=>{if(!e.read){e.read=true}}))},setCounter:(e,t)=>{e.unreadCounter=Number.parseInt(t,10)},decreaseCounter:e=>{if(e.unreadCounter>0){e.unreadCounter--}},increaseCounter:e=>{e.unreadCounter++},clearSearchResult:e=>{e.searchCollection.clear()}}}static validate(e){const t={};if(l.Type.isString(e.id)||l.Type.isNumber(e.id)){t.id=e.id}if(l.Type.isNumber(e.author_id)){t.authorId=e.author_id}else if(l.Type.isNumber(e.userId)){t.authorId=e.userId}if(!l.Type.isNil(e.date)){t.date=o.Utils.date.cast(e.date)}if(l.Type.isString(e.notify_title)){t.title=e.notify_title}else if(l.Type.isString(e.title)){t.title=e.title}if(l.Type.isString(e.text)||l.Type.isNumber(e.text)){t.text=l.Text.decode(e.text.toString())}if(l.Type.isObjectLike(e.params)){t.params=p(e.params)}if(l.Type.isArray(e.replaces)){t.replaces=e.replaces}if(!l.Type.isNil(e.notify_buttons)){t.notifyButtons=JSON.parse(e.notify_buttons)}else if(!l.Type.isNil(e.buttons)){t.notifyButtons=e.buttons.map((e=>({COMMAND:"notifyConfirm",COMMAND_PARAMS:`${t.id}|${e.VALUE}`,TEXT:`${e.TITLE}`,TYPE:"BUTTON",DISPLAY:"LINE",BG_COLOR:e.VALUE==="Y"?"#8bc84b":"#ef4b57",TEXT_COLOR:"#fff"})))}if(e.notify_type===r.NotificationTypesCodes.confirm||e.type===r.NotificationTypesCodes.confirm){t.sectionCode=r.NotificationTypesCodes.confirm}else{t.sectionCode=r.NotificationTypesCodes.simple}if(!l.Type.isNil(e.notify_read)){t.read=e.notify_read==="Y"}else if(!l.Type.isNil(e.read)){t.read=e.read==="Y"}if(l.Type.isString(e.setting_name)){t.settingName=e.setting_name}else if(l.Type.isString(e.settingName)){t.settingName=e.settingName}return t}sortByType(e,t){if(e.sectionCode===r.NotificationTypesCodes.confirm&&t.sectionCode!==r.NotificationTypesCodes.confirm){return-1}else if(e.sectionCode!==r.NotificationTypesCodes.confirm&&t.sectionCode===r.NotificationTypesCodes.confirm){return 1}else{return t.id-e.id}}}const ze=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:l.Type.isNumber},{fieldName:"url",targetFieldName:"source",checkFunction:l.Type.isPlainObject,formatFunction:e=>{var t;return(t=e.source)!=null?t:""}},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"url",targetFieldName:"richData",checkFunction:l.Type.isPlainObject,formatFunction:e=>C(e.richData,Ye)}];const Ye=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"description",targetFieldName:"description",checkFunction:l.Type.isString},{fieldName:"link",targetFieldName:"link",checkFunction:l.Type.isString},{fieldName:"name",targetFieldName:"name",checkFunction:l.Type.isString},{fieldName:"previewUrl",targetFieldName:"previewUrl",checkFunction:l.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:l.Type.isString}];class $e extends c.BuilderModel{getState(){return{collection:{},counters:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,source:"",date:new Date,richData:{id:null,description:null,link:null,name:null,previewUrl:null,type:null}}}getChatState(){return{items:new Map,hasNextPage:true}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},getCounter:e=>t=>{if(!e.counters[t]){return 0}return e.counters[t]},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage}}}getActions(){return{setCounter:(e,t)=>{if(!l.Type.isNumber(t.counter)||!l.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{const{chatId:i,links:s,hasNextPage:n}=t;if(!l.Type.isArrayFilled(s)||!l.Type.isNumber(i)){return}e.commit("setHasNextPage",{chatId:i,hasNextPage:n});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,link:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!l.Type.isNumber(s)||!l.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].items.has(s)){return}e.commit("delete",{chatId:i,id:s})}}}getMutations(){return{setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},add:(e,t)=>{const{chatId:i,link:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;e.collection[i].items.delete(s);e.counters[i]--}}}formatFields(e){return C(e,ze)}}const qe=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:l.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast}];class Je extends c.BuilderModel{getState(){return{collection:{},counters:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},getCounter:e=>t=>{if(e.counters[t]){return e.counters[t]}return 0},isFavoriteMessage:e=>(t,i)=>{if(!e.collection[t]){return false}const s=Object.fromEntries(e.collection[t].items);const n=Object.values(s).find((e=>e.messageId===i));return Boolean(n)},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId}}}getActions(){return{setCounter:(e,t)=>{if(!l.Type.isNumber(t.counter)||!l.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{if(l.Type.isNumber(t.favorites)){t.favorites=[t.favorites]}const{chatId:i,favorites:s,hasNextPage:n,lastId:a}=t;if(!l.Type.isArrayFilled(s)||!l.Type.isNumber(i)){return}e.commit("setHasNextPage",{chatId:i,hasNextPage:n});e.commit("setLastId",{chatId:i,lastId:a});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,favorite:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!l.Type.isNumber(s)||!l.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].items.has(s)){return}e.commit("delete",{chatId:i,id:s})},deleteByMessageId:(e,t)=>{const{chatId:i,messageId:s}=t;if(!e.state.collection[i]){return}const n=e.state.collection[i].items;let a=null;for(const[e,t]of n){if(t.messageId===s){a=e;break}}if(!a){return}e.commit("delete",{chatId:i,id:a})}}}getMutations(){return{setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].lastId=s},add:(e,t)=>{const{chatId:i,favorite:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;e.collection[i].items.delete(s);e.counters[i]--}}}formatFields(e){return C(e,qe)}}class Qe extends c.BuilderModel{getState(){return{collection:{}}}getChatState(){return{users:new Set,hasNextPage:true,lastId:0,inited:false}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].users]},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].users.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId},getInited:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].inited}}}getActions(){return{set:(e,t)=>{const{chatId:i,users:s,hasNextPage:n,lastId:a}=t;if(!l.Type.isNil(n)){e.commit("setHasNextPage",{chatId:i,hasNextPage:n})}if(!l.Type.isNil(a)){e.commit("setLastId",{chatId:i,lastId:a})}e.commit("setInited",{chatId:i,inited:true});if(s.length>0){e.commit("set",{chatId:i,users:s})}},delete:(e,t)=>{const{chatId:i,userId:s}=t;if(!l.Type.isNumber(i)||!l.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{userId:s,chatId:i})}}}getMutations(){return{set:(e,t)=>{const{chatId:i,users:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}s.forEach((t=>{e.collection[i].users.add(t)}))},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].lastId=s},setInited:(e,t)=>{const{chatId:i,inited:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].inited=s},delete:(e,t)=>{const{chatId:i,userId:s}=t;e.collection[i].users.delete(s)}}}}const Ze=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:l.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"task",targetFieldName:"task",checkFunction:l.Type.isPlainObject,formatFunction:e=>C(e,et)}];const et=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"title",targetFieldName:"title",checkFunction:l.Type.isString},{fieldName:"creatorId",targetFieldName:"creatorId",checkFunction:l.Type.isNumber},{fieldName:"responsibleId",targetFieldName:"responsibleId",checkFunction:l.Type.isNumber},{fieldName:"statusTitle",targetFieldName:"statusTitle",checkFunction:l.Type.isString},{fieldName:"deadline",targetFieldName:"deadline",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"state",targetFieldName:"state",checkFunction:l.Type.isString},{fieldName:"color",targetFieldName:"color",checkFunction:l.Type.isString},{fieldName:"source",targetFieldName:"source",checkFunction:l.Type.isString}];class tt extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,task:{id:0,title:"",creatorId:0,responsibleId:0,status:0,statusTitle:"",deadline:new Date,state:"",color:"",source:""}}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId}}}getActions(){return{set:(e,t)=>{const{chatId:i,tasks:s,hasNextPage:n,lastId:a}=t;if(!l.Type.isArrayFilled(s)||!l.Type.isNumber(i)){return}if(!l.Type.isNil(n)){e.commit("setHasNextPage",{chatId:i,hasNextPage:n})}if(!l.Type.isNil(a)){e.commit("setLastId",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,task:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!l.Type.isNumber(i)||!l.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,task:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;e.collection[s].items.delete(i)},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].lastId=s}}}formatFields(e){return C(e,Ze)}}const it=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:l.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"calendar",targetFieldName:"meeting",checkFunction:l.Type.isPlainObject,formatFunction:e=>C(e,st)}];const st=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"title",targetFieldName:"title",checkFunction:l.Type.isString},{fieldName:"dateFrom",targetFieldName:"dateFrom",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"dateTo",targetFieldName:"dateTo",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:"source",targetFieldName:"source",checkFunction:l.Type.isString}];class nt extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,meeting:{id:0,title:"",dateFrom:new Date,dateTo:new Date,source:""}}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId}}}getActions(){return{set:(e,t)=>{const{chatId:i,meetings:s,hasNextPage:n,lastId:a}=t;if(!l.Type.isArrayFilled(s)||!l.Type.isNumber(i)){return}if(!l.Type.isNil(n)){e.commit("setHasNextPage",{chatId:i,hasNextPage:n})}if(!l.Type.isNil(a)){e.commit("setLastId",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,meeting:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!l.Type.isNumber(i)||!l.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,meeting:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;e.collection[s].items.delete(i)},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const n=!l.Type.isNil(e.collection[i]);if(!n){e.collection[i]=this.getChatState()}e.collection[i].lastId=s}}}formatFields(e){return C(e,it)}}const at=[{fieldName:"id",targetFieldName:"id",checkFunction:l.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:l.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:l.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:l.Type.isNumber},{fieldName:["dateCreate","date"],targetFieldName:"date",checkFunction:l.Type.isString,formatFunction:o.Utils.date.cast},{fieldName:["fileId","id"],targetFieldName:"fileId",checkFunction:l.Type.isNumber}];class ot extends c.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,fileId:0}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return[]}return[...e.collection[t][i].items.values()].sort(((e,t)=>t.id-e.id))},getLatest:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];let n=[];let a=[];let o=[];let l=[];if(e.collection[t][r.SidebarFileTypes.media]){i=[...e.collection[t][r.SidebarFileTypes.media].items.values()]}if(e.collection[t][r.SidebarFileTypes.audio]){n=[...e.collection[t][r.SidebarFileTypes.audio].items.values()]}if(e.collection[t][r.SidebarFileTypes.document]){a=[...e.collection[t][r.SidebarFileTypes.document].items.values()]}if(e.collection[t][r.SidebarFileTypes.brief]){l=[...e.collection[t][r.SidebarFileTypes.brief].items.values()]}if(e.collection[t][r.SidebarFileTypes.other]){o=[...e.collection[t][r.SidebarFileTypes.other].items.values()]}const c=[i,n,a,l,o].flat().sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(c,s)},getLatestUnsorted:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];if(e.collection[t][r.SidebarFileTypes.fileUnsorted]){i=[...e.collection[t][r.SidebarFileTypes.fileUnsorted].items.values()]}const n=i.sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(n,s)},getSize:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return 0}return e.collection[t][i].items.size},hasNextPage:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return false}return e.collection[t][i].hasNextPage},getLastId:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return false}return e.collection[t][i].lastId}}}getActions(){return{set:(e,t)=>{const{chatId:i,files:s,subType:n}=t;if(!l.Type.isArrayFilled(s)||!l.Type.isNumber(i)){return}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,subType:n,file:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!l.Type.isNumber(s)||!l.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("delete",{chatId:i,id:s})},setHasNextPage:(e,t)=>{const{chatId:i,subType:s,hasNextPage:n}=t;if(!l.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("setHasNextPage",{chatId:i,subType:s,hasNextPage:n})},setLastId:(e,t)=>{const{chatId:i,subType:s,lastId:n}=t;if(!l.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("setLastId",{chatId:i,subType:s,lastId:n})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,file:s,subType:n}=t;if(!e.collection[i]){e.collection[i]={}}if(!e.collection[i][n]){e.collection[i][n]=this.getChatState()}e.collection[i][n].items.set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;Object.values(r.SidebarFileTypes).forEach((t=>{if(e.collection[i][t]&&e.collection[i][t].items.has(s)){e.collection[i][t].items.delete(s)}}))},setHasNextPage:(e,t)=>{const{chatId:i,subType:s,hasNextPage:n}=t;if(!e.collection[i]){e.collection[i]={}}const a=!l.Type.isNil(e.collection[i][s]);if(!a){e.collection[i][s]=this.getChatState()}e.collection[i][s].hasNextPage=n},setLastId:(e,t)=>{const{chatId:i,subType:s,lastId:n}=t;if(!e.collection[i]){e.collection[i]={}}const a=!l.Type.isNil(e.collection[i][s]);if(!a){e.collection[i][s]=this.getChatState()}e.collection[i][s].lastId=n}}}formatFields(e){return C(e,at)}getTopThreeCompletedFiles(e,t){return e.filter((e=>{const i=t["files/get"](e.fileId,true);return i.progress===100})).slice(0,3)}}class rt extends c.BuilderModel{getName(){return"sidebar"}getNestedModules(){return{members:Qe,links:$e,favorites:Je,tasks:tt,meetings:nt,files:ot}}getState(){return{initedList:new Set,isFilesMigrated:false,isLinksMigrated:false}}getGetters(){return{isInited:e=>t=>e.initedList.has(t)}}getActions(){return{setInited:(e,t)=>{if(!l.Type.isNumber(t)){return}e.commit("setInited",t)},setFilesMigrated:(e,t)=>{if(!l.Type.isBoolean(t)){return}e.commit("setFilesMigrated",t)},setLinksMigrated:(e,t)=>{if(!l.Type.isBoolean(t)){return}e.commit("setLinksMigrated",t)}}}getMutations(){return{setInited:(e,t)=>{e.initedList.add(t)},setFilesMigrated:(e,t)=>{e.isFilesMigrated=t},setLinksMigrated:(e,t)=>{e.isLinksMigrated=t}}}}var lt=babelHelpers.classPrivateFieldLooseKey("validate");var ct=babelHelpers.classPrivateFieldLooseKey("validateOptions");var dt=babelHelpers.classPrivateFieldLooseKey("validateLoadConfiguration");class ut extends c.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,dt,{value:ft});Object.defineProperty(this,ct,{value:gt});Object.defineProperty(this,lt,{value:mt})}getName(){return"market"}getState(){return{collection:new Map,placementCollection:{[r.PlacementType.contextMenu]:new Set,[r.PlacementType.navigation]:new Set,[r.PlacementType.textarea]:new Set,[r.PlacementType.sidebar]:new Set,[r.PlacementType.smilesSelector]:new Set}}}getElementState(){return{id:0,title:"",options:{role:"",extranet:"",context:null,width:null,height:null,color:null,iconName:null},placement:"",order:0,loadConfiguration:{ID:0,PLACEMENT:"",PLACEMENT_ID:0}}}getGetters(){return{getByPlacement:e=>t=>{const i=[...e.placementCollection[t].values()];return i.map((t=>e.collection.get(t)))},getById:e=>t=>e.collection.get(t)}}getActions(){return{set:(e,t)=>{const{items:i}=t;i.forEach((t=>{e.commit("setPlacementCollection",{placement:t.placement,id:t.id});e.commit("setCollection",t)}))}}}getMutations(){return{setPlacementCollection:(e,t)=>{e.placementCollection[t.placement].add(t.id)},setCollection:(e,t)=>{e.collection.set(t.id,{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](t)})}}}}function mt(e){const t={};if(l.Type.isNumber(e.id)||l.Type.isStringFilled(e.id)){t.id=e.id.toString()}if(l.Type.isString(e.title)){t.title=e.title}t.options=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](e.options);if(l.Type.isString(e.placement)){t.placement=e.placement}if(l.Type.isNumber(e.order)){t.order=e.order}t.loadConfiguration=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e.loadConfiguration);return t}function gt(e){const t={context:null,width:null,height:null,color:null,iconName:null};if(!l.Type.isPlainObject(e)){return t}if(l.Type.isArrayFilled(e.context)){t.context=e.context}if(l.Type.isNumber(e.width)){t.width=e.width}if(l.Type.isNumber(e.height)){t.height=e.height}if(l.Type.isStringFilled(e.color)){t.color=e.color}if(l.Type.isStringFilled(e.iconName)){t.iconName=e.iconName}return t}function ft(e){const t={ID:0,PLACEMENT:"",PLACEMENT_ID:0};if(!l.Type.isPlainObject(e)){return t}if(l.Type.isNumber(e.ID)){t.ID=e.ID}if(l.Type.isStringFilled(e.PLACEMENT)){t.PLACEMENT=e.PLACEMENT}if(l.Type.isNumber(e.PLACEMENT_ID)){t.PLACEMENT_ID=e.PLACEMENT_ID}return t}class ht extends c.BuilderModel{getName(){return"counters"}getState(){return{unloadedChatCounters:{},unloadedLinesCounters:{},unloadedCopilotCounters:{},commentCounters:{}}}getGetters(){return{getTotalChatCounter:e=>{let t=0;const i=d.Core.getStore().getters["recent/getRecentCollection"];i.forEach((e=>{const i=this.store.getters["chats/get"](e.dialogId,true);const s=i.muteList.includes(d.Core.getUserId());if(s){return}const n=e.unread;if(i.counter===0&&n){t++;return}t+=i.counter}));let s=0;Object.values(e.unloadedChatCounters).forEach((e=>{s+=e}));const n=d.Core.getStore().getters["counters/getTotalCommentsCounter"];return t+s+n},getTotalCopilotCounter:e=>{let t=0;const i=d.Core.getStore().getters["recent/getCopilotCollection"];i.forEach((e=>{const i=this.store.getters["chats/get"](e.dialogId,true);const s=i.muteList.includes(d.Core.getUserId());if(s){return}t+=i.counter}));let s=0;Object.values(e.unloadedCopilotCounters).forEach((e=>{s+=e}));return t+s},getTotalLinesCounter:e=>{let t=0;Object.values(e.unloadedLinesCounters).forEach((e=>{t+=e}));return t},getSpecificLinesCounter:e=>t=>{if(!e.unloadedLinesCounters[t]){return 0}return e.unloadedLinesCounters[t]},getTotalCommentsCounter:e=>{let t=0;Object.values(e.commentCounters).forEach((e=>{Object.values(e).forEach((e=>{t+=e}))}));return t},getCommentsWithCounter:e=>t=>{if(!e.commentCounters[t]){return[]}return Object.keys(e.commentCounters[t]).map((e=>Number.parseInt(e,10)))},getChannelCommentsCounter:e=>t=>{if(!e.commentCounters[t]){return 0}let i=0;Object.values(e.commentCounters[t]).forEach((e=>{i+=e}));return i},getSpecificCommentsCounter:e=>t=>{var i;const{channelId:s,commentChatId:n}=t;if(!e.commentCounters[s]){return 0}return(i=e.commentCounters[s][n])!=null?i:0}}}getActions(){return{setUnloadedChatCounters:(e,t)=>{if(!l.Type.isPlainObject(t)){return}e.commit("setUnloadedChatCounters",t)},setUnloadedLinesCounters:(e,t)=>{if(!l.Type.isPlainObject(t)){return}e.commit("setUnloadedLinesCounters",t)},setUnloadedCopilotCounters:(e,t)=>{if(!l.Type.isPlainObject(t)){return}e.commit("setUnloadedCopilotCounters",t)},setCommentCounters:(e,t)=>{if(!l.Type.isPlainObject(t)){return}e.commit("setCommentCounters",t)}}}getMutations(){return{setUnloadedChatCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedChatCounters[t];return}e.unloadedChatCounters[t]=i}))},setUnloadedLinesCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedLinesCounters[t];return}e.unloadedLinesCounters[t]=i}))},setUnloadedCopilotCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedCopilotCounters[t];return}e.unloadedCopilotCounters[t]=i}))},setCommentCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(!e.commentCounters[t]){e.commentCounters[t]={}}const s=e.commentCounters[t];Object.entries(i).forEach((([e,t])=>{if(t===0){delete s[e];return}s[e]=t}))}))}}}}e.ApplicationModel=w;e.MessagesModel=J;e.ChatsModel=he;e.UsersModel=be;e.FilesModel=Te;e.RecentModel=Oe;e.NotificationsModel=Xe;e.SidebarModel=rt;e.MarketModel=ut;e.CountersModel=ht;e.formatFieldsWithConfig=C})(this.BX.Messenger.v2.Model=this.BX.Messenger.v2.Model||{},BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Model,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX,BX.Vue3.Vuex,BX.Messenger.v2.Application);
//# sourceMappingURL=registry.bundle.map.js