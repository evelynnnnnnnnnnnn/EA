this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Provider=this.BX.Messenger.v2.Provider||{};(function(e,s,a,t,i,l,r,d,o,n,c,h,g,u,b,p,v,I,P,f,L){"use strict";var C=babelHelpers.classPrivateFieldLooseKey("store");var H=babelHelpers.classPrivateFieldLooseKey("messageViews");var m=babelHelpers.classPrivateFieldLooseKey("setMessageChat");var F=babelHelpers.classPrivateFieldLooseKey("setUsers");var M=babelHelpers.classPrivateFieldLooseKey("setFiles");var B=babelHelpers.classPrivateFieldLooseKey("setAdditionalEntities");var y=babelHelpers.classPrivateFieldLooseKey("setCommentInfo");var w=babelHelpers.classPrivateFieldLooseKey("handleAddingMessageToModel");var U=babelHelpers.classPrivateFieldLooseKey("addMessageToModel");var S=babelHelpers.classPrivateFieldLooseKey("updateDialog");var O=babelHelpers.classPrivateFieldLooseKey("updateMessageViewedByOthers");var k=babelHelpers.classPrivateFieldLooseKey("updateChatLastMessageViews");var D=babelHelpers.classPrivateFieldLooseKey("checkMessageViewsRegistry");var R=babelHelpers.classPrivateFieldLooseKey("updateMessageViewsRegistry");var T=babelHelpers.classPrivateFieldLooseKey("sendScrollEvent");var j=babelHelpers.classPrivateFieldLooseKey("getDialog");class A{constructor(){Object.defineProperty(this,j,{value:Q});Object.defineProperty(this,T,{value:J});Object.defineProperty(this,R,{value:G});Object.defineProperty(this,D,{value:z});Object.defineProperty(this,k,{value:q});Object.defineProperty(this,O,{value:Y});Object.defineProperty(this,S,{value:x});Object.defineProperty(this,U,{value:V});Object.defineProperty(this,w,{value:_});Object.defineProperty(this,y,{value:W});Object.defineProperty(this,B,{value:E});Object.defineProperty(this,M,{value:X});Object.defineProperty(this,F,{value:K});Object.defineProperty(this,m,{value:N});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:{}});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=L.Core.getStore()}handleMessageAdd(e){P.Logger.warn("MessagePullHandler: handleMessageAdd",e);babelHelpers.classPrivateFieldLooseBase(this,m)[m](e);babelHelpers.classPrivateFieldLooseBase(this,F)[F](e);babelHelpers.classPrivateFieldLooseBase(this,M)[M](e);babelHelpers.classPrivateFieldLooseBase(this,B)[B](e);babelHelpers.classPrivateFieldLooseBase(this,y)[y](e);const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["messages/isInChatCollection"]({messageId:e.message.templateId});const a=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["messages/isInChatCollection"]({messageId:e.message.id});if(a){P.Logger.warn("New message pull handler: we already have this message",e.message);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/update",{id:e.message.id,fields:{...e.message,error:false}});babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.chatId)}else if(!a&&s){P.Logger.warn("New message pull handler: we already have the TEMPORARY message",e.message);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/updateWithId",{id:e.message.templateId,fields:{...e.message,error:false}})}else if(!a&&!s){P.Logger.warn("New message pull handler: we dont have this message",e.message);babelHelpers.classPrivateFieldLooseBase(this,w)[w](e)}l.WritingManager.getInstance().stopWriting({dialogId:e.dialogId,userId:e.message.senderId});babelHelpers.classPrivateFieldLooseBase(this,S)[S](e)}handleMessageUpdate(e){P.Logger.warn("MessagePullHandler: handleMessageUpdate",e);l.WritingManager.getInstance().stopWriting({dialogId:e.dialogId,userId:e.senderId});babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/update",{id:e.id,fields:{text:e.text,params:e.params}});babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.chatId)}handleMessageDelete(e){P.Logger.warn("MessagePullHandler: handleMessageDelete",e);l.WritingManager.getInstance().stopWriting({dialogId:e.dialogId,userId:e.senderId});babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/update",{id:e.id,fields:{text:"",isDeleted:true,files:[],attach:[],replyId:0}})}handleMessageDeleteComplete(e){P.Logger.warn("MessagePullHandler: handleMessageDeleteComplete",e);l.WritingManager.getInstance().stopWriting({dialogId:e.dialogId,userId:e.senderId});babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/delete",{id:e.id});const s={counter:e.counter};const a=Boolean(e.newLastMessage);if(a){s.lastMessageId=e.newLastMessage.id;s.lastMessageViews=e.lastMessageViews;babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/store",e.newLastMessage)}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/update",{dialogId:e.dialogId,fields:s})}handleAddReaction(e){P.Logger.warn("MessagePullHandler: handleAddReaction",e);const{actualReactions:{reaction:s,usersShort:a},userId:t,reaction:i}=e;if(L.Core.getUserId()===t){s.ownReactions=[i]}const l=new c.UserManager;l.addUsersToModel(a);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/reactions/set",[s])}handleDeleteReaction(e){P.Logger.warn("MessagePullHandler: handleDeleteReaction",e);const{actualReactions:{reaction:s}}=e;babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/reactions/set",[s])}handleMessageParamsUpdate(e){P.Logger.warn("MessagePullHandler: handleMessageParamsUpdate",e);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/update",{id:e.id,chatId:e.chatId,fields:{params:e.params}})}handleReadMessage(e,s){P.Logger.warn("MessagePullHandler: handleReadMessage",e);const t=a.UuidManager.getInstance();if(t.hasActionUuid(s.action_uuid)){P.Logger.warn("MessagePullHandler: handleReadMessage: we have this uuid, skip");t.removeActionUuid(s.action_uuid);return}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/readMessages",{chatId:e.chatId,messageIds:e.viewedMessages}).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/update",{dialogId:e.dialogId,fields:{counter:e.counter,lastId:e.lastId}})})).catch((e=>{console.error("MessagePullHandler: error handling readMessage",e)}))}handleReadMessageOpponent(e){if(e.userId===L.Core.getUserId()){return}P.Logger.warn("MessagePullHandler: handleReadMessageOpponent",e);babelHelpers.classPrivateFieldLooseBase(this,O)[O](e);babelHelpers.classPrivateFieldLooseBase(this,k)[k](e)}handlePinAdd(e){P.Logger.warn("MessagePullHandler: handlePinAdd",e);babelHelpers.classPrivateFieldLooseBase(this,M)[M](e);babelHelpers.classPrivateFieldLooseBase(this,F)[F](e);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/store",e.additionalMessages);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/pin/add",{chatId:e.pin.chatId,messageId:e.pin.messageId});if(L.Core.getUserId()!==e.pin.authorId);}handlePinDelete(e){P.Logger.warn("MessagePullHandler: handlePinDelete",e);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/pin/delete",{chatId:e.chatId,messageId:e.messageId})}}function N(e){var s,a,t;const i=(s=e.chat)==null?void 0:s[e.chatId];if(!i){return}const l={...e.chat[e.chatId],dialogId:e.dialogId};const r=Boolean(babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.dialogId));const d=!e.notify||((a=e.message)==null?void 0:(t=a.params)==null?void 0:t.NOTIFY)==="N";if(!r&&!d&&!l.role){l.role=g.UserRole.member}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/set",l)}function K(e){if(!e.users){return}const s=new c.UserManager;s.setUsersToModel(Object.values(e.users))}function X(e){if(!e.files){return}const s=Object.values(e.files);s.forEach((s=>{var a;const t=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["files/isInCollection"]({fileId:(a=e.message)==null?void 0:a.templateFileId});if(t){var i;babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("files/updateWithId",{id:(i=e.message)==null?void 0:i.templateFileId,fields:s})}else{babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("files/set",s)}}))}function E(e){if(!e.message.additionalEntities){return}const{additionalMessages:s,messages:a,files:t,users:i}=e.message.additionalEntities;const l=[...a,...s];babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/store",l);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("files/set",t);babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("users/set",i)}function W(e){var s;const a=(s=e.chat)==null?void 0:s[e.chatId];if(!a||a.type!==g.ChatType.comment){return}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/comments/set",{messageId:a.parent_message_id,chatId:e.chatId,messageCount:a.message_count});babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/comments/setLastUser",{messageId:a.parent_message_id,newUserId:e.message.senderId})}function _(e){const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.dialogId,true);if(s.inited&&s.hasNextPage){babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/store",e.message);return}const a=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["application/isChatOpen"](e.dialogId);const i=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["messages/getChatUnreadMessages"](e.chatId);if(!a&&i.length>t.MessageService.getMessageRequestLimit()){babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/store",e.message);const s=new t.MessageService({chatId:e.chatId});s.reloadMessageList();return}babelHelpers.classPrivateFieldLooseBase(this,U)[U](e.message);babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.chatId)}function V(e){const s={...e};if(e.senderId===L.Core.getUserId()){s.unread=false}else{s.unread=true;s.viewed=false}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/setChatCollection",{messages:[s]})}function x(e){const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.dialogId,true);const a={};if(e.message.id>s.lastMessageId){a.lastMessageId=e.message.id}if(e.message.senderId===L.Core.getUserId()&&e.message.id>s.lastReadId){a.lastId=e.message.id}a.counter=e.counter;babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/update",{dialogId:e.dialogId,fields:a});babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/clearLastMessageViews",{dialogId:e.dialogId})}function Y(e){babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("messages/setViewedByOthers",{ids:e.viewedMessages})}function q(e){const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j](e.dialogId);if(!s){return}const a=e.viewedMessages.includes(s.lastMessageId);if(!a){return}if(babelHelpers.classPrivateFieldLooseBase(this,D)[D](e.userId,s.lastMessageId)){return}const t=Boolean(s.lastMessageViews.firstViewer);if(t){babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/incrementLastMessageViews",{dialogId:e.dialogId});babelHelpers.classPrivateFieldLooseBase(this,R)[R](e.userId,s.lastMessageId);return}babelHelpers.classPrivateFieldLooseBase(this,C)[C].dispatch("chats/setLastMessageViews",{dialogId:e.dialogId,fields:{userId:e.userId,userName:e.userName,date:e.date,messageId:s.lastMessageId}});babelHelpers.classPrivateFieldLooseBase(this,R)[R](e.userId,s.lastMessageId)}function z(e,s){var a;return Boolean((a=babelHelpers.classPrivateFieldLooseBase(this,H)[H][s])==null?void 0:a.has(e))}function G(e,s){if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H][s]){babelHelpers.classPrivateFieldLooseBase(this,H)[H][s]=new Set}babelHelpers.classPrivateFieldLooseBase(this,H)[H][s].add(e)}function J(e){s.EventEmitter.emit(g.EventType.dialog.scrollToBottom,{chatId:e,threshold:g.DialogScrollThreshold.nearTheBottom})}function Q(e,s=false){return babelHelpers.classPrivateFieldLooseBase(this,C)[C].getters["chats/get"](e,s)}var Z=babelHelpers.classPrivateFieldLooseKey("store");var $=babelHelpers.classPrivateFieldLooseKey("updateChatUsers");class ee{constructor(){Object.defineProperty(this,$,{value:se});Object.defineProperty(this,Z,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=L.Core.getStore()}handleChatOwner(e){P.Logger.warn("ChatPullHandler: handleChatOwner",e);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{ownerId:e.userId}})}handleChatManagers(e){P.Logger.warn("ChatPullHandler: handleChatManagers",e);babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{managerList:e.list}});const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getters["chats/get"](e.dialogId);if(!s){return}const a=e.list.includes(L.Core.getUserId());if(s.role===g.UserRole.member&&a){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{role:g.UserRole.manager}})}if(s.role===g.UserRole.manager&&!a){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{role:g.UserRole.member}})}}handleChatUserAdd(e){P.Logger.warn("ChatPullHandler: handleChatUserAdd",e);const s=L.Core.getUserId();if(e.newUsers.includes(s)){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{role:g.UserRole.member}})}babelHelpers.classPrivateFieldLooseBase(this,$)[$](e)}handleChatUserLeave(e){P.Logger.warn("ChatPullHandler: handleChatUserLeave",e);const s=e.userId===L.Core.getUserId();if(s){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{inited:false}});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("messages/clearChatCollection",{chatId:e.chatId})}const a=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getters["application/isChatOpen"](e.dialogId);if(s&&a){i.Messenger.openChat()}const t=p.CallManager.getInstance().getCurrentCallDialogId()===e.dialogId;if(s&&t){p.CallManager.getInstance().leaveCurrentCall()}babelHelpers.classPrivateFieldLooseBase(this,$)[$](e)}handleStartWriting(e){if(e.userId===L.Core.getUserId()){return}P.Logger.warn("ChatPullHandler: handleStartWriting",e);const{dialogId:s,userId:a,userName:t}=e;l.WritingManager.getInstance().startWriting({dialogId:s,userId:a,userName:t});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("users/update",{id:a,fields:{lastActivityDate:new Date}})}handleChatUnread(e){P.Logger.warn("ChatPullHandler: handleChatUnread",e);let s=0;if(e.active===true){s=e.markedId}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{markedId:s}})}handleChatMuteNotify(e){if(e.muted){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/mute",{dialogId:e.dialogId});return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/unmute",{dialogId:e.dialogId})}handleChatRename(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getters["chats/getByChatId"](e.chatId);if(!s){return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:s.dialogId,fields:{name:e.name}})}handleChatAvatar(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getters["chats/getByChatId"](e.chatId);if(!s){return}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:s.dialogId,fields:{avatar:e.avatar}})}handleReadAllChats(){P.Logger.warn("ChatPullHandler: handleReadAllChats");babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/clearCounters");babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("recent/clearUnread")}handleChatConvert(e){P.Logger.warn("ChatPullHandler: handleChatConvert",e);const{dialogId:s,newType:a,newPermissions:t}=e;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:s,fields:{type:a,permissions:t}})}}function se(e){if(e.users){const s=new c.UserManager;s.setUsersToModel(Object.values(e.users))}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].dispatch("chats/update",{dialogId:e.dialogId,fields:{userCounter:e.userCount}})}var ae=babelHelpers.classPrivateFieldLooseKey("store");class te{constructor(){Object.defineProperty(this,ae,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=L.Core.getStore()}handleUserInvite(e){if(e.invited){const s=new c.UserManager;s.setUsersToModel([e.user]);return}babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].dispatch("users/update",{id:e.userId,fields:e.user})}}class ie{handleDesktopOnline(e){P.Logger.warn("DesktopPullHandler: handleDesktopOnline",e);const s=b.DesktopManager.getInstance();s.setDesktopActive(true);d.CounterManager.getInstance().removeBrowserTitleCounter()}handleDesktopOffline(){P.Logger.warn("DesktopPullHandler: handleDesktopOffline");b.DesktopManager.getInstance().setDesktopActive(false)}}class le{handleSettingsUpdate(e){P.Logger.warn("SettingsPullHandler: handleSettingsUpdate",e);Object.entries(e).forEach((([e,s])=>{L.Core.getStore().dispatch("application/settings/set",{[e]:s})}))}}class re{handleCommentSubscribe(e){P.Logger.warn("CommentsPullHandler: handleCommentSubscribe",e);if(e.subscribe){L.Core.getStore().dispatch("chats/unmute",{dialogId:e.dialogId});return}L.Core.getStore().dispatch("chats/mute",{dialogId:e.dialogId})}}var de=babelHelpers.classPrivateFieldLooseKey("messageHandler");var oe=babelHelpers.classPrivateFieldLooseKey("chatHandler");var ne=babelHelpers.classPrivateFieldLooseKey("userHandler");var ce=babelHelpers.classPrivateFieldLooseKey("desktopHandler");var he=babelHelpers.classPrivateFieldLooseKey("settingsHandler");var ge=babelHelpers.classPrivateFieldLooseKey("commentsHandler");class ue{constructor(){Object.defineProperty(this,de,{writable:true,value:void 0});Object.defineProperty(this,oe,{writable:true,value:void 0});Object.defineProperty(this,ne,{writable:true,value:void 0});Object.defineProperty(this,ce,{writable:true,value:void 0});Object.defineProperty(this,he,{writable:true,value:void 0});Object.defineProperty(this,ge,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,de)[de]=new A;babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=new ee;babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=new te;babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=new ie;babelHelpers.classPrivateFieldLooseBase(this,he)[he]=new le;babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=new re}getModuleId(){return"im"}handleMessage(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageAdd(e)}handleMessageChat(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageAdd(e)}handleMessageUpdate(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageUpdate(e)}handleMessageDelete(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageDelete(e)}handleMessageDeleteComplete(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageDeleteComplete(e)}handleAddReaction(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleAddReaction(e)}handleDeleteReaction(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleDeleteReaction(e)}handleMessageParamsUpdate(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleMessageParamsUpdate(e)}handleReadMessage(e,s){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleReadMessage(e,s)}handleReadMessageChat(e,s){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleReadMessage(e,s)}handleReadMessageOpponent(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleReadMessageOpponent(e)}handleReadMessageChatOpponent(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handleReadMessageOpponent(e)}handlePinAdd(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handlePinAdd(e)}handlePinDelete(e){babelHelpers.classPrivateFieldLooseBase(this,de)[de].handlePinDelete(e)}handleChatOwner(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatOwner(e)}handleChatManagers(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatManagers(e)}handleChatUserAdd(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatUserAdd(e)}handleChatUserLeave(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatUserLeave(e)}handleStartWriting(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleStartWriting(e)}handleChatUnread(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatUnread(e)}handleReadAllChats(){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleReadAllChats()}handleChatMuteNotify(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatMuteNotify(e)}handleChatRename(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatRename(e)}handleChatAvatar(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatAvatar(e)}handleChatConvert(e){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].handleChatConvert(e)}handleUserInvite(e){babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].handleUserInvite(e)}handleDesktopOnline(e){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].handleDesktopOnline(e)}handleDesktopOffline(){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].handleDesktopOffline()}handleSettingsUpdate(e){babelHelpers.classPrivateFieldLooseBase(this,he)[he].handleSettingsUpdate(e)}handleCommentSubscribe(e){babelHelpers.classPrivateFieldLooseBase(this,ge)[ge].handleCommentSubscribe(e)}}const be={[g.ChatType.copilot]:"recent/setCopilot",[g.ChatType.channel]:"recent/setChannel",[g.ChatType.openChannel]:"recent/setChannel",default:"recent/setRecent"};var pe=babelHelpers.classPrivateFieldLooseKey("params");var ve=babelHelpers.classPrivateFieldLooseKey("extra");class Ie{constructor(e,s={}){Object.defineProperty(this,pe,{writable:true,value:void 0});Object.defineProperty(this,ve,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]=e;babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=s}getChatId(){return babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].chatId}getParentChatId(){var e;return((e=this.getChat())==null?void 0:e.parent_chat_id)||0}getChat(){var e;const s=this.getChatId();return(e=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].chat)==null?void 0:e[s]}getChatType(){var e;const s=this.getChat();return(e=s==null?void 0:s.type)!=null?e:""}isLinesChat(){return Boolean(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].lines)}isCommentChat(){return this.getChatType()===g.ChatType.comment}isChannelChat(){return[g.ChatType.channel,g.ChatType.openChannel].includes(this.getChatType())}isUserInChat(){const e=babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].userInChat[this.getChatId()];if(!e||this.isChannelListEvent()){return true}return e.includes(L.Core.getUserId())}isChannelListEvent(){return this.isChannelChat()&&babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].is_shared_event}needToSkipMessageEvent(){return this.isLinesChat()||this.isCommentChat()||!this.isUserInChat()}getActionName(){var e;if(this.isChannelChat()&&!this.isChannelListEvent()){return be.default}const s=this.getChatType();return(e=be[s])!=null?e:be.default}}var Pe=babelHelpers.classPrivateFieldLooseKey("params");var fe=babelHelpers.classPrivateFieldLooseKey("setUsers");var Le=babelHelpers.classPrivateFieldLooseKey("setFiles");var Ce=babelHelpers.classPrivateFieldLooseKey("setMessageChat");var He=babelHelpers.classPrivateFieldLooseKey("setMessage");class me{constructor(e){Object.defineProperty(this,He,{value:ye});Object.defineProperty(this,Ce,{value:Be});Object.defineProperty(this,Le,{value:Me});Object.defineProperty(this,fe,{value:Fe});Object.defineProperty(this,Pe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=e}setLastMessageInfo(){babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]();babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();babelHelpers.classPrivateFieldLooseBase(this,He)[He]()}getDialogId(){return babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].chat.dialogId}getLastMessageId(){const[e]=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].messages;return e.id}}function Fe(){const e=new c.UserManager;e.setUsersToModel(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].users)}function Me(){L.Core.getStore().dispatch("files/set",babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].files)}function Be(){const e={...babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].chat,counter:babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].counter,dialogId:this.getDialogId()};L.Core.getStore().dispatch("chats/set",e)}function ye(){const[e]=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe].messages;L.Core.getStore().dispatch("messages/store",e)}var we=babelHelpers.classPrivateFieldLooseKey("updateUnloadedChatCounter");var Ue=babelHelpers.classPrivateFieldLooseKey("updateCommentCounter");class Se{constructor(){Object.defineProperty(this,Ue,{value:ke});Object.defineProperty(this,we,{value:Oe})}getModuleId(){return"im"}handleMessage(e,s){this.handleMessageAdd(e,s)}handleMessageChat(e,s){this.handleMessageAdd(e,s)}handleMessageAdd(e,s){const a=new Ie(e,s);if(a.isCommentChat()){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]({channelChatId:a.getParentChatId(),commentChatId:a.getChatId(),commentCounter:e.counter})}if(a.needToSkipMessageEvent(e)){return}P.Logger.warn("RecentPullHandler: handleMessageAdd",e);const t={id:e.dialogId,messageId:e.message.id};const i=L.Core.getStore().getters["recent/get"](e.dialogId);if(i){t.isFakeElement=false;t.isBirthdayPlaceholder=false;t.liked=false}const l=a.getActionName();L.Core.getStore().dispatch(l,t)}handleMessageDeleteComplete(e){const s=Boolean(e.newLastMessage);if(s){this.updateRecentForMessageDelete(e.dialogId,e.newLastMessage.id)}babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleReadMessage(e){babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleReadMessageChat(e){if(e.type===g.ChatType.comment){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]({channelChatId:e.parentChatId,commentChatId:e.chatId,commentCounter:e.counter});return}babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleUnreadMessage(e){babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleUnreadMessageChat(e){babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleChatMuteNotify(e){babelHelpers.classPrivateFieldLooseBase(this,we)[we](e)}handleChatUnread(e){P.Logger.warn("RecentPullHandler: handleChatUnread",e);babelHelpers.classPrivateFieldLooseBase(this,we)[we]({dialogId:e.dialogId,chatId:e.chatId,counter:e.counter,muted:e.muted,unread:e.active});L.Core.getStore().dispatch("recent/unread",{id:e.dialogId,action:e.active})}handleAddReaction(e){P.Logger.warn("RecentPullHandler: handleAddReaction",e);const s=L.Core.getStore().getters["recent/get"](e.dialogId);if(!s){return}const a=L.Core.getStore().getters["application/isChatOpen"](e.dialogId);if(a){return}const t=L.Core.getStore().getters["recent/getMessage"](e.dialogId);const i=L.Core.getUserId()===e.userId;const l=L.Core.getUserId()===t.authorId;if(i||!l){return}L.Core.getStore().dispatch("recent/like",{id:e.dialogId,messageId:e.actualReactions.reaction.messageId,liked:true})}handleChatPin(e){P.Logger.warn("RecentPullHandler: handleChatPin",e);const s=L.Core.getStore().getters["recent/get"](e.dialogId);if(!s){return}L.Core.getStore().dispatch("recent/pin",{id:e.dialogId,action:e.active})}handleChatHide(e){P.Logger.warn("RecentPullHandler: handleChatHide",e);const s=L.Core.getStore().getters["recent/get"](e.dialogId);if(!s){return}L.Core.getStore().dispatch("recent/delete",{id:e.dialogId})}handleChatUserLeave(e){P.Logger.warn("RecentPullHandler: handleChatUserLeave",e);const s=L.Core.getStore().getters["recent/get"](e.dialogId);if(!s||e.userId!==L.Core.getUserId()){return}L.Core.getStore().dispatch("recent/delete",{id:e.dialogId})}handleUserInvite(e){var s;P.Logger.warn("RecentPullHandler: handleUserInvite",e);const a=o.Utils.text.getUuidV4();L.Core.getStore().dispatch("messages/store",{id:a,date:e.date});L.Core.getStore().dispatch("recent/setRecent",{id:e.user.id,invited:(s=e.invited)!=null?s:false,isFakeElement:true,messageId:a})}handleRecentUpdate(e){P.Logger.warn("RecentPullHandler: handleRecentUpdate",e);const s=new me(e);s.setLastMessageInfo();const a={id:s.getDialogId(),messageId:s.getLastMessageId(),lastActivityDate:e.lastActivityDate};L.Core.getStore().dispatch("recent/setRecent",a)}updateRecentForMessageDelete(e,s){if(!s){L.Core.getStore().dispatch("recent/delete",{id:e});return}L.Core.getStore().dispatch("recent/update",{id:e,fields:{messageId:s}})}}function Oe(e){const{dialogId:s,chatId:a,counter:t,muted:i,unread:l,lines:r=false}=e;if(r){return}const d=L.Core.getStore().getters["recent/get"](s);if(d){return}P.Logger.warn("RecentPullHandler: updateUnloadedChatCounter:",{dialogId:s,chatId:a,counter:t,muted:i,unread:l});let o=0;if(i){o=0}else if(l&&t===0){o=1}else if(l&&t>0){o=t}else if(!l){o=t}L.Core.getStore().dispatch("counters/setUnloadedChatCounters",{[a]:o})}function ke(e){const{channelChatId:s,commentChatId:a,commentCounter:t}=e;if(f.Type.isUndefined(t)){return}const i={[s]:{[a]:t}};L.Core.getStore().dispatch("counters/setCommentCounters",i)}class De{constructor(){this.store=L.Core.getStore();this.userManager=new c.UserManager;this.updateCounterDebounced=f.Runtime.debounce(this.updateCounter,1500,this)}getModuleId(){return"im"}getSubscriptionType(){return"server"}handleNotifyAdd(e){if(e.onlyFlash===true){return}this.userManager.setUsersToModel(e.users);this.store.dispatch("notifications/set",e);this.updateCounterDebounced(e.counter)}handleNotifyConfirm(e){this.store.dispatch("notifications/delete",{id:e.id});this.updateCounterDebounced(e.counter)}handleNotifyRead(e){e.list.forEach((e=>{this.store.dispatch("notifications/read",{ids:[e],read:true})}));this.updateCounterDebounced(e.counter)}handleNotifyUnread(e){e.list.forEach((e=>{this.store.dispatch("notifications/read",{ids:[e],read:false})}));this.updateCounterDebounced(e.counter)}handleNotifyDelete(e){const s=Object.keys(e.id).map((e=>Number.parseInt(e,10)));s.forEach((e=>{this.store.dispatch("notifications/delete",{id:e})}));this.updateCounterDebounced(e.counter)}updateCounter(e){this.store.dispatch("notifications/setCounter",e)}}class Re{constructor(){this.store=L.Core.getStore();this.userManager=new c.UserManager}getModuleId(){return"im"}handleChatUserAdd(e){if(this.getMembersCountFromStore(e.chatId)===0){return}void this.userManager.setUsersToModel(Object.values(e.users));void this.store.dispatch("sidebar/members/set",{chatId:e.chatId,users:e.newUsers})}handleChatUserLeave(e){if(this.getMembersCountFromStore(e.chatId)===0){return}void this.store.dispatch("sidebar/members/delete",{chatId:e.chatId,userId:e.userId})}handleTaskAdd(e){if(!this.isSidebarInited(e.link.chatId)){return}void this.userManager.setUsersToModel(e.users);void this.store.dispatch("sidebar/tasks/set",{chatId:e.link.chatId,tasks:[e.link]})}handleTaskUpdate(e,s){this.handleTaskAdd(e,s)}handleTaskDelete(e){if(!this.isSidebarInited(e.chatId)){return}void this.store.dispatch("sidebar/tasks/delete",{chatId:e.chatId,id:e.linkId})}handleCalendarAdd(e){if(!this.isSidebarInited(e.link.chatId)){return}void this.userManager.setUsersToModel(e.users);void this.store.dispatch("sidebar/meetings/set",{chatId:e.link.chatId,meetings:[e.link]})}handleCalendarUpdate(e,s){this.handleCalendarAdd(e,s)}handleCalendarDelete(e){if(!this.isSidebarInited(e.chatId)){return}void this.store.dispatch("sidebar/meetings/delete",{chatId:e.chatId,id:e.linkId})}handleUrlAdd(e){if(!this.isSidebarInited(e.link.chatId)){return}void this.userManager.setUsersToModel(e.users);void this.store.dispatch("sidebar/links/set",{chatId:e.link.chatId,links:[e.link]});const s=this.store.getters["sidebar/links/getCounter"](e.link.chatId);void this.store.dispatch("sidebar/links/setCounter",{chatId:e.link.chatId,counter:s+1})}handleUrlDelete(e){if(!this.isSidebarInited(e.chatId)){return}void this.store.dispatch("sidebar/links/delete",{chatId:e.chatId,id:e.linkId})}handleMessageFavoriteAdd(e){if(!this.isSidebarInited(e.link.chatId)){return}void this.userManager.setUsersToModel(e.users);void this.store.dispatch("files/set",e.files);void this.store.dispatch("messages/store",[e.link.message]);void this.store.dispatch("sidebar/favorites/set",{chatId:e.link.chatId,favorites:[e.link]});const s=this.store.getters["sidebar/favorites/getCounter"](e.link.chatId);void this.store.dispatch("sidebar/favorites/setCounter",{chatId:e.link.chatId,counter:s+1})}handleMessageFavoriteDelete(e){if(!this.isSidebarInited(e.chatId)){return}void this.store.dispatch("sidebar/favorites/delete",{chatId:e.chatId,id:e.linkId})}handleFileAdd(e){var s;if(!this.isSidebarInited(e.link.chatId)){return}void this.userManager.setUsersToModel(e.users);void this.store.dispatch("files/set",e.files);const a=(s=e.link.subType)!=null?s:g.SidebarDetailBlock.fileUnsorted;void this.store.dispatch("sidebar/files/set",{chatId:e.link.chatId,files:[e.link],subType:a})}handleFileDelete(e){var s;const a=f.Type.isNumber(e.chatId)?e.chatId:Number.parseInt(e.chatId,10);if(!this.isSidebarInited(a)){return}const t=(s=e.linkId)!=null?s:e.fileId;void this.store.dispatch("sidebar/files/delete",{chatId:a,id:t})}handleMessageChat(e){if(!this.isSidebarInited(e.chatId)||this.isFilesMigrated()){return}void this.userManager.setUsersToModel(Object.values(e.users));void this.store.dispatch("files/set",Object.values(e.files));Object.values(e.files).forEach((e=>{void this.store.dispatch("sidebar/files/set",{chatId:e.chatId,files:[e],subType:g.SidebarDetailBlock.fileUnsorted})}))}isSidebarInited(e){return this.store.getters["sidebar/isInited"](e)}isFilesMigrated(){return this.store.state.sidebar.isFilesMigrated}getMembersCountFromStore(e){return this.store.getters["sidebar/members/getSize"](e)}}var Te=babelHelpers.classPrivateFieldLooseKey("shouldShowNotification");var je=babelHelpers.classPrivateFieldLooseKey("shouldShowLinesNotification");var Ae=babelHelpers.classPrivateFieldLooseKey("isChatOpened");var Ne=babelHelpers.classPrivateFieldLooseKey("isLinesChatOpened");var Ke=babelHelpers.classPrivateFieldLooseKey("isImportantMessage");var Xe=babelHelpers.classPrivateFieldLooseKey("shouldShowToUser");var Ee=babelHelpers.classPrivateFieldLooseKey("isUserDnd");var We=babelHelpers.classPrivateFieldLooseKey("desktopWillShowNotification");var _e=babelHelpers.classPrivateFieldLooseKey("flashDesktopIcon");var Ve=babelHelpers.classPrivateFieldLooseKey("playOpenedChatMessageSound");var xe=babelHelpers.classPrivateFieldLooseKey("playMessageSound");var Ye=babelHelpers.classPrivateFieldLooseKey("restoreLastNotificationId");var qe=babelHelpers.classPrivateFieldLooseKey("updateLastNotificationId");var ze=babelHelpers.classPrivateFieldLooseKey("setCurrentUserStatus");class Ge{constructor(){Object.defineProperty(this,ze,{value:ns});Object.defineProperty(this,qe,{value:os});Object.defineProperty(this,Ye,{value:ds});Object.defineProperty(this,xe,{value:rs});Object.defineProperty(this,Ve,{value:ls});Object.defineProperty(this,_e,{value:is});Object.defineProperty(this,We,{value:ts});Object.defineProperty(this,Ee,{value:as});Object.defineProperty(this,Xe,{value:ss});Object.defineProperty(this,Ke,{value:es});Object.defineProperty(this,Ne,{value:$e});Object.defineProperty(this,Ae,{value:Ze});Object.defineProperty(this,je,{value:Qe});Object.defineProperty(this,Te,{value:Je});this.lastNotificationId=0;this.store=L.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]();babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]()}getModuleId(){return"im"}handleMessage(e,s){this.handleMessageAdd(e,s)}handleMessageChat(e,s){this.handleMessageAdd(e,s)}handleMessageAdd(e,s){if(!babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e,s)){return}if(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](e.dialogId)){babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve](e);return}babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](e);babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]();const a=this.store.getters["messages/getById"](e.message.id);const t=this.store.getters["chats/get"](e.dialogId,true);const i=this.store.getters["users/get"](a.authorId);u.NotifierManager.getInstance().showMessage({message:a,dialog:t,user:i,lines:Boolean(e.lines)});babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e.message.id)}handleNotifyAdd(e,s){if(s.server_time_ago>10){P.Logger.warn("NotifierPullHandler: notification arrived to the user 30 seconds after it was actually sent, ignore notification");return}if(e.id<=this.lastNotificationId){P.Logger.warn("NotifierPullHandler: new notification id is smaller than lastNotificationId");return}if(e.onlyFlash===true||babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()||babelHelpers.classPrivateFieldLooseBase(this,We)[We]()||p.CallManager.getInstance().hasCurrentCall()){return}if(document.hasFocus()){const e=this.store.getters["application/areNotificationsOpen"];if(e){return}}const a=this.store.getters["notifications/getById"](e.id);const t=this.store.getters["users/get"](e.userId);if(e.silent!=="Y"){I.SoundNotificationManager.getInstance().playOnce(g.SoundType.reminder)}babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]();u.NotifierManager.getInstance().showNotification(a,t);babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e.id)}}function Je(e,s){var a,t;if(s.server_time_ago>10){P.Logger.warn("NotifierPullHandler: message arrived to the user 30 seconds after it was actually sent, ignore message");return false}if(e.message.id<=this.lastNotificationId){P.Logger.warn("NotifierPullHandler: new message id is smaller than lastNotificationId");return false}if(L.Core.getUserId()===e.message.senderId){return false}if(e.lines&&!babelHelpers.classPrivateFieldLooseBase(this,je)[je](e)){return false}const i=!e.notify||((a=e.message)==null?void 0:(t=a.params)==null?void 0:t.NOTIFY)==="N";if(i||!babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe](e)||babelHelpers.classPrivateFieldLooseBase(this,We)[We]()){return false}const l=p.CallManager.getInstance().hasCurrentCall();if(l&&p.CallManager.getInstance().getCurrentCallDialogId()!==e.dialogId.toString()){return false}const r=p.CallManager.getInstance().hasCurrentScreenSharing();if(r){return false}return true}function Qe(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e.dialogId)){return false}const s=e.message.senderId;if(s>0&&e.users[s].extranet===false){return true}const a=this.store.getters["counters/getSpecificLinesCounter"](e.chatId);return a===0}function Ze(e){const s=this.store.getters["application/isChatOpen"](e);return Boolean(document.hasFocus()&&s)}function $e(e){const s=this.store.getters["application/isLinesChatOpen"](e);return Boolean(document.hasFocus()&&s)}function es(e){const{message:s}=e;return s.isImportant||s.importantFor.includes(L.Core.getUserId())}function ss(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](e)){return true}const s=this.store.getters["chats/get"](e.dialogId,true);const a=s.muteList.includes(L.Core.getUserId());return!babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]()&&!a}function as(){const e=this.store.getters["application/settings/get"](g.Settings.user.status);return e===g.UserStatus.dnd}function ts(){const e=b.DesktopManager.isChatWindow();return!e&&b.DesktopManager.getInstance().isDesktopActive()}function is(){if(!b.DesktopManager.isDesktop()){return}h.DesktopApi.flashIcon()}function ls(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](e)){I.SoundNotificationManager.getInstance().forcePlayOnce(g.SoundType.newMessage2);return}I.SoundNotificationManager.getInstance().playOnce(g.SoundType.newMessage2)}function rs(e){if(babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](e)){I.SoundNotificationManager.getInstance().forcePlayOnce(g.SoundType.newMessage1);return}I.SoundNotificationManager.getInstance().playOnce(g.SoundType.newMessage1)}function ds(){const e=v.LocalStorageManager.getInstance().get(g.LocalStorageKey.lastNotificationId,0);this.lastNotificationId=Number.parseInt(e,10)}function os(e){const s=2e3;this.lastNotificationId=e;clearTimeout(this.writeToStorageTimeout);this.writeToStorageTimeout=setTimeout((()=>{v.LocalStorageManager.getInstance().set(g.LocalStorageKey.lastNotificationId,e)}),s)}function ns(){var e;const s=L.Core.getApplicationData();if(!((e=s.settings)!=null&&e.status)){return}L.Core.getStore().dispatch("application/settings/set",{[g.Settings.user.status]:s.settings.status})}class cs{constructor(){this.store=L.Core.getStore()}getModuleId(){return"im"}handleMessageChat(e){this.updateUnloadedLinesCounter(e)}handleReadMessageChat(e){this.updateUnloadedLinesCounter(e)}handleUnreadMessageChat(e){this.updateUnloadedLinesCounter(e)}handleChatHide(e){this.updateUnloadedLinesCounter({dialogId:e.dialogId,chatId:e.chatId,lines:e.lines,counter:0})}updateUnloadedLinesCounter(e){const{dialogId:s,chatId:a,counter:t,lines:i}=e;if(!i||f.Type.isUndefined(t)){return}P.Logger.warn("LinesPullHandler: updateUnloadedLinesCounter:",{dialogId:s,chatId:a,counter:t});this.store.dispatch("counters/setUnloadedLinesCounters",{[a]:t})}}class hs{constructor(){this.store=L.Core.getStore()}getModuleId(){return"online"}getSubscriptionType(){return"online"}handleUserStatus(e){const s=L.Core.getUserId();if(f.Type.isPlainObject(e.users[s])){const{status:a}=e.users[s];this.store.dispatch("application/settings/set",{status:a})}Object.values(e.users).forEach((e=>{this.store.dispatch("users/update",{id:e.id,fields:{lastActivityDate:e.last_activity_date}})}))}}e.BasePullHandler=ue;e.RecentPullHandler=Se;e.NotificationPullHandler=De;e.SidebarPullHandler=Re;e.NotifierPullHandler=Ge;e.LinesPullHandler=cs;e.OnlinePullHandler=hs})(this.BX.Messenger.v2.Provider.Pull=this.BX.Messenger.v2.Provider.Pull||{},BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Vue3.Vuex,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Model,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Application);
//# sourceMappingURL=registry.bundle.map.js